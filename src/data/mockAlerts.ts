import { AlertPlaybook, AlertCategory } from "@/types/alert";

export const mockAlerts: AlertPlaybook[] = [
  // --- 1. Authentication & Access Alerts (Total: 21) ---
  {
    id: 'brute-force',
    name: 'Brute Force Attack Detected',
    category: 'Authentication & Access',
    description: 'A high volume of failed login attempts targeting a single or multiple accounts over a short period.',
    causes: [
      'Weak passwords being targeted.',
      'Automated scripts or bots attempting credential stuffing.',
      'Misconfigured rate limiting or account lockout policies.',
    ],
    actions: [
      'Step 1: **Verify the Alert.** Confirm the volume and rate of failed logins in the SIEM/Log Analytics tool.',
      'Step 2: **Identify Targets.** Determine the source IP address(es) and the specific user account(s) being targeted.',
      'Step 3: **Check for Success.** Search logs immediately to see if any login attempts from the source IP were successful during the attack window.',
      'Step 4: **Containment (Source).** If the source IP is external and malicious, block it temporarily at the perimeter firewall or WAF.',
      'Step 5: **Containment (Account).** If a specific user account was successfully compromised, immediately disable or suspend the account.',
      'Step 6: **Mitigation.** Force a password reset for all targeted user accounts, successful or not, and enforce Multi-Factor Authentication (MFA).',
    ],
    queries: [
      { tool: 'SIEM', query: 'index=auth status=failure | stats count by src_ip, user | where count > 50 | sort -count' },
    ],
    tools: ['SIEM/Log Analytics', 'Firewall/WAF', 'Identity Provider (IdP) Management Console'],
    escalation: 'Escalate if successful login is confirmed, or if the attack source cannot be blocked and persists.',
  },
  {
    id: 'impossible-travel',
    name: 'Impossible Travel Detected',
    category: 'Authentication & Access',
    description: 'A single user successfully logging in from two geographically distant locations within an impossible time frame, strongly indicating a compromised account.',
    causes: [
      'Stolen credentials used by an attacker in a different region.',
      'VPN usage or proxy hopping (False Positive).',
    ],
    actions: [
      'Step 1: **Immediate Suspension.** Immediately suspend the user account and invalidate all active sessions.',
      'Step 2: **Contact User.** Contact the user via an out-of-band method (phone, internal chat) to verify the recent login activity.',
      'Step 3: **Analyze Login Chain.** Review the full login history for the user, noting IPs, devices, and MFA status for both suspicious logins.',
      'Step 4: **Check for Post-Login Activity.** Review logs for immediate actions taken after the second (malicious) login (e.g., mailbox rule changes, data access).',
      'Step 5: **Remediation.** If confirmed malicious, force a password reset, ensure MFA is enabled, and perform a full endpoint scan on the user\'s primary device.',
    ],
    queries: [
      { tool: 'Cloud Identity Logs', query: 'LoginEvents | where TimeDifference < 1 hour and Distance > 5000 km' },
    ],
    tools: ['Identity Provider Logs', 'Communication Tools', 'EDR'],
    escalation: 'Escalate if the account is high-privilege or if data access/modification occurred after the second login.',
  },
  {
    id: 'suspicious-admin-creation',
    name: 'Suspicious Admin Account Creation',
    category: 'Authentication & Access',
    description: 'A new administrative or highly privileged account was created outside of standard change control procedures.',
    causes: [
      'Compromised administrator account used to create a backdoor account.',
      'Misconfigured automation script.',
    ],
    actions: [
      'Step 1: **Identify Creator.** Determine the user or service account that created the new administrative account.',
      'Step 2: **Verify Change Control.** Check the change management system for an approved ticket corresponding to this creation time.',
      'Step 3: **Containment.** If unauthorized, immediately disable the newly created administrative account.',
      'Step 4: **Investigate Creator.** If the creator account was compromised, immediately suspend it and follow the Compromised Account playbook.',
      'Step 5: **Audit Permissions.** Review the permissions granted to the new account and ensure no other unauthorized changes were made to IAM policies.',
    ],
    queries: [
      { tool: 'AD/IAM Logs', query: 'EventID=4720 AND TargetUserName="*Admin*" AND CallerUserName!="Approved_Admins"' },
    ],
    tools: ['Active Directory/IAM Console', 'Change Management System', 'SIEM'],
    escalation: 'High priority. Escalate immediately if the creator account was compromised.',
  },
  {
    id: 'failed-mfa-login',
    name: 'Failed MFA Login in Cloud Console',
    category: 'Authentication & Access',
    description: 'Multiple failed attempts to satisfy the Multi-Factor Authentication requirement, often following a successful password entry, indicating an MFA bypass attempt (e.g., push bombing).',
    causes: [
      'Attacker possessing valid credentials attempting to bypass MFA.',
      'User error or device malfunction (False Positive).',
      'MFA push bombing attack.',
    ],
    actions: [
      'Step 1: **Identify User and Source.** Determine the user account and the source IP address attempting the login.',
      'Step 2: **Contact User.** Contact the user out-of-band to verify if they are currently attempting to log in and receiving MFA prompts.',
      'Step 3: **Containment.** If unauthorized, immediately block the source IP and temporarily disable the user\'s MFA method (e.g., revoke session tokens).',
      'Step 4: **Review MFA Logs.** Check the MFA provider logs for the type of failure (e.g., denied push, incorrect code).',
      'Step 5: **Remediation.** If confirmed malicious, force a password reset and enroll the user in a stronger MFA method (e.g., FIDO2 key instead of push notification).',
    ],
    queries: [
      { tool: 'Cloud Identity Logs', query: 'LoginEvents | where ResultType == 500121 and FailureReason contains "MFA"' },
    ],
    tools: ['Identity Provider Logs', 'MFA Management Console', 'Communication Tools'],
    escalation: 'Escalate if the targeted user is high-privilege or if the attack persists after initial containment.',
  },
  {
    id: 'successful-login-new-location',
    name: 'Successful Login from New Location',
    category: 'Authentication & Access',
    description: 'A user successfully logged in from a geographic location or network segment never before seen for that account.',
    causes: [
      'User traveling or working remotely (False Positive).',
      'Compromised credentials used by an attacker.',
      'New VPN endpoint or proxy usage.',
    ],
    actions: [
      'Step 1: **Verify Location.** Check the geolocation data for the new IP address.',
      'Step 2: **Contact User.** Contact the user out-of-band to confirm if they initiated the login from that location.',
      'Step 3: **Check Device/Agent Health.** If the login is confirmed, ensure the endpoint security agent is healthy and running.',
      'Step 4: **Containment (If Malicious).** If unauthorized, immediately suspend the account, invalidate the session, and force a password reset.',
      'Step 5: **Audit Activity.** Review post-login activity (e.g., file access, email forwarding rules) for signs of compromise.',
    ],
    queries: [
      { tool: 'Identity Logs', query: 'LoginEvents | where user="[USER]" and geo_location NOT IN (baseline_locations)' },
    ],
    tools: ['Identity Provider Logs', 'Communication Tools', 'GeoIP Database'],
    escalation: 'Escalate if the user cannot be reached or if post-login malicious activity is detected.',
  },
  {
    id: 'account-lockout-storm',
    name: 'Account Lockout Storm',
    category: 'Authentication & Access',
    description: 'A large number of user accounts are being locked out simultaneously or in rapid succession, often indicating a password spray attack or misconfigured service.',
    causes: [
      'Password spray attack targeting many users with common passwords.',
      'Misconfigured service account attempting to authenticate with an expired password.',
      'Internal network issue causing authentication failures.',
    ],
    actions: [
      'Step 1: **Identify Source.** Determine the source IP address(es) causing the lockouts.',
      'Step 2: **Containment (Source).** Block the source IP at the firewall/NAC if external and malicious.',
      'Step 3: **Check Service Accounts.** If the source is internal, check if a service account is involved and temporarily disable it if necessary.',
      'Step 4: **Analyze Password Attempts.** Review logs for the password being used in the failed attempts to confirm a spray attack.',
      'Step 5: **Remediation.** If a spray attack is confirmed, force password resets for all targeted accounts and review password policies.',
    ],
    queries: [
      { tool: 'AD/IAM Logs', query: 'EventID=4740 | stats count by src_ip, user | where count > 100' },
    ],
    tools: ['Active Directory/IAM Console', 'SIEM', 'Firewall/NAC'],
    escalation: 'Escalate if the lockout storm impacts critical business functions or if the source cannot be contained.',
  },
  {
    id: 'credential-dumping-attempt',
    name: 'Credential Dumping Attempt',
    category: 'Authentication & Access',
    description: 'Detection of tools or processes (e.g., Mimikatz, LSASS access) attempting to extract credentials from memory or local storage on an endpoint.',
    causes: [
      'Post-exploitation activity by an attacker who has gained initial access.',
      'Malware attempting to harvest credentials for lateral movement.',
    ],
    actions: [
      'Step 1: **Immediate Isolation.** Immediately isolate the affected host from the network.',
      'Step 2: **Identify Process.** Determine the process name and command line arguments used for the dumping attempt.',
      'Step 3: **Capture Memory.** Capture a memory dump of the host for forensic analysis.',
      'Step 4: **Check for Lateral Movement.** Search logs for the compromised user account attempting to log into other systems immediately after the dump attempt.',
      'Step 5: **Remediation.** Force a password reset for the logged-in user and re-image the host.',
    ],
    queries: [
      { tool: 'EDR', query: 'process_name="lsass.exe" AND access_type="Read_Memory" AND caller_process NOT IN (approved_list)' },
    ],
    tools: ['EDR Console', 'Memory Forensic Tools', 'SIEM'],
    escalation: 'High priority. Escalate if the attempt was successful and lateral movement is detected.',
  },
  {
    id: 'suspicious-login-tor',
    name: 'Suspicious Login from Tor/VPN Exit Node',
    category: 'Authentication & Access',
    description: 'A successful login originating from a known high-risk IP address associated with Tor, public VPN exit nodes, or known malicious proxies.',
    causes: [
      'Attacker masking their true location using anonymity services.',
      'User legitimately using a VPN (False Positive).',
    ],
    actions: [
      'Step 1: **Verify Source.** Confirm the source IP is listed on a high-risk threat intelligence feed.',
      'Step 2: **Immediate Suspension.** Immediately suspend the user account and invalidate the session.',
      'Step 3: **Contact User.** Contact the user out-of-band to verify if they initiated the login.',
      'Step 4: **Audit Activity.** Review all activity performed during the suspicious session (e.g., data access, configuration changes).',
      'Step 5: **Remediation.** If malicious, force a password reset and ensure MFA is enforced. Block the source IP at the perimeter.',
    ],
    queries: [
      { tool: 'Identity Logs', query: 'LoginEvents | where geo_ip IN (Tor_Exit_Nodes)' },
    ],
    tools: ['Identity Provider Logs', 'Threat Intelligence Feeds', 'Communication Tools'],
    escalation: 'Escalate if the user is high-privilege or if unauthorized activity occurred.',
  },
  {
    id: 'privilege-escalation',
    name: 'Privilege Escalation Detected',
    category: 'Authentication & Access',
    description: 'A standard user account successfully gained administrative or system-level privileges on an endpoint or server.',
    causes: [
      'Exploitation of a local vulnerability (e.g., kernel bug, misconfigured service).',
      'Misconfigured system permissions allowing unauthorized privilege changes.',
    ],
    actions: [
      'Step 1: **Identify Host and User.** Determine the host and the user account that escalated privileges.',
      'Step 2: **Immediate Isolation.** Isolate the affected host from the network.',
      'Step 3: **Analyze Method.** Determine the exact method or tool used for the escalation (e.g., specific exploit, system utility).',
      'Step 4: **Check for Follow-up.** Review logs for immediate post-escalation activity (e.g., lateral movement, credential dumping).',
      'Step 5: **Remediation.** Revert the privilege change, patch the vulnerability, and re-image the host.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="Privilege_Change" AND new_privilege="System" AND old_privilege="User"' },
    ],
    tools: ['EDR Console', 'Vulnerability Scanner', 'Patch Management'],
    escalation: 'High priority. Escalate if the host is critical or if the escalation was successful.',
  },
  {
    id: 'new-user-high-privilege-group',
    name: 'New User Added to High-Privilege Group',
    category: 'Authentication & Access',
    description: 'A user account was added to a sensitive group (e.g., Domain Admins, Global Administrators) without proper change control.',
    causes: [
      'Compromised administrator account making unauthorized changes.',
      'Misconfigured automation or provisioning system.',
    ],
    actions: [
      'Step 1: **Identify Changer and Target.** Determine the user who made the change and the user who was added to the group.',
      'Step 2: **Verify Change Control.** Check the change management system for an approved ticket.',
      'Step 3: **Containment.** If unauthorized, immediately remove the user from the high-privilege group.',
      'Step 4: **Investigate Changer.** If the changer account was compromised, suspend it and follow the Compromised Account playbook.',
      'Step 5: **Audit Activity.** Review all activity of the newly privileged user since the change occurred.',
    ],
    queries: [
      { tool: 'AD/IAM Logs', query: 'EventID=4728 AND TargetGroupName="Domain Admins"' },
    ],
    tools: ['Active Directory/IAM Console', 'Change Management System', 'SIEM'],
    escalation: 'High priority. Escalate immediately if the change was unauthorized.',
  },
  {
    id: 'password-spray-detected',
    name: 'Password Spray Attack Detected',
    category: 'Authentication & Access',
    description: 'An attacker is attempting a small number of common passwords against a large number of user accounts to avoid lockout thresholds.',
    causes: [
      'Attacker targeting weak passwords across the organization.',
      'Insufficient lockout policies or monitoring across multiple systems.',
    ],
    actions: [
      'Step 1: **Identify Source and Targets.** Determine the source IP(s) and the list of targeted users.',
      'Step 2: **Containment (Source).** Block the source IP(s) at the perimeter.',
      'Step 3: **Analyze Password.** Identify the common password(s) being used in the attack.',
      'Step 4: **Mitigation.** Force password resets for all targeted users who use the identified password(s).',
      'Step 5: **Review Policies.** Ensure MFA is enforced and password complexity requirements are strong.',
    ],
    queries: [
      { tool: 'SIEM', query: 'index=auth status=failure | bucket span=1h | stats count(user) as unique_users by src_ip | where unique_users > 50' },
    ],
    tools: ['SIEM/Log Analytics', 'Firewall/WAF', 'Identity Provider (IdP) Management Console'],
    escalation: 'Escalate if the attack persists or if a successful login is detected.',
  },
  {
    id: 'token-theft-session-hijack',
    name: 'Session Token Theft / Hijack Detected',
    category: 'Authentication & Access',
    description: 'Detection of a session token being used from a new, unusual device or location without a corresponding login event, indicating token theft.',
    causes: [
      'Malware (e.g., infostealer) stealing session cookies/tokens.',
      'Cross-Site Scripting (XSS) attack.',
    ],
    actions: [
      'Step 1: **Immediate Invalidation.** Immediately invalidate the compromised session token and all associated refresh tokens.',
      'Step 2: **Identify Source.** Determine the source IP and device using the stolen token.',
      'Step 3: **Containment.** Isolate the original user\'s endpoint and force a full malware scan.',
      'Step 4: **User Notification.** Contact the user out-of-band and force a password reset and MFA re-enrollment.',
      'Step 5: **Audit Activity.** Review all actions performed during the hijacked session.',
    ],
    queries: [
      { tool: 'Identity Logs', query: 'SessionEvents | where session_id="[ID]" AND device_id != "[BASELINE_DEVICE]"' },
    ],
    tools: ['Identity Provider Logs', 'EDR', 'Communication Tools'],
    escalation: 'CRITICAL. Escalate immediately if the token belongs to a privileged user.',
  },
  {
    id: 'new-mfa-device-enrollment',
    name: 'New MFA Device Enrollment',
    category: 'Authentication & Access',
    description: 'A new Multi-Factor Authentication device or method was successfully enrolled on a user account, potentially by an attacker who has compromised the password.',
    causes: [
      'Attacker successfully bypassed password protection and is establishing persistence via MFA.',
      'Legitimate user replacing a lost device (False Positive).',
    ],
    actions: [
      'Step 1: **Verify Enrollment.** Check the enrollment logs for the source IP and device details.',
      'Step 2: **Contact User.** Contact the user out-of-band to verify if they initiated the enrollment.',
      'Step 3: **Containment.** If unauthorized, immediately delete the newly enrolled MFA device and suspend the account.',
      'Step 4: **Audit Activity.** Review all activity on the account immediately preceding the enrollment (e.g., password change, suspicious login).',
      'Step 5: **Remediation.** Force a password reset and re-enroll the user using a secure, verified process.',
    ],
    queries: [
      { tool: 'MFA Logs', query: 'event_type="MFA_Enrollment" AND user="[USER]" AND enrollment_source NOT IN (approved_sources)' },
    ],
    tools: ['MFA Management Console', 'Identity Provider Logs', 'Communication Tools'],
    escalation: 'High priority. Escalate if the user is high-privilege or if the enrollment was unauthorized.',
  },
  {
    id: 'service-account-login-workstation',
    name: 'Service Account Login on Workstation',
    category: 'Authentication & Access',
    description: 'A non-interactive service account (designed for automated tasks) was used to log into a standard user workstation or server console.',
    causes: [
      'Compromised service account being used for lateral movement or reconnaissance.',
      'Misconfigured application or script running under the wrong context (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Host and Account.** Determine the workstation IP and the service account used.',
      'Step 2: **Immediate Suspension.** Immediately suspend the service account and isolate the workstation.',
      'Step 3: **Analyze Activity.** Review the workstation logs for commands executed or files accessed by the service account.',
      'Step 4: **Remediation.** If malicious, force a password rotation for the service account and re-image the host. If misconfiguration, correct the application context.',
    ],
    queries: [
      { tool: 'AD/IAM Logs', query: 'EventID=4624 AND AccountType="Service" AND LogonType IN (2, 10)' },
    ],
    tools: ['Active Directory/IAM Console', 'EDR', 'SIEM'],
    escalation: 'High priority. Service account compromise can lead to widespread network access.',
  },
  {
    id: 'ad-replication-failure',
    name: 'Active Directory Replication Failure',
    category: 'Authentication & Access',
    description: 'A critical failure in Active Directory replication, potentially indicating a domain controller is offline, compromised, or experiencing a denial of service.',
    causes: [
      'Network connectivity issues between Domain Controllers (DCs).',
      'Attacker tampering with DC services or logs.',
      'Hardware failure on a DC.',
    ],
    actions: [
      'Step 1: **Verify Health.** Check the health and connectivity of the affected Domain Controller(s).',
      'Step 2: **Check Logs.** Review DC security logs for signs of tampering (e.g., service stops, log clearing) prior to the failure.',
      'Step 3: **Restore Replication.** Initiate manual replication or troubleshoot network issues.',
      'Step 4: **Audit Changes.** Review recent changes made to AD objects (users, groups) that may not have replicated.',
    ],
    queries: [
      { tool: 'AD Logs', query: 'EventID IN (2042, 1865) AND Source="NTDS Replication"' },
    ],
    tools: ['Active Directory Management Tools', 'Network Monitoring', 'SIEM'],
    escalation: 'CRITICAL. Escalate immediately if multiple DCs are affected or if tampering is suspected.',
  },
  {
    id: 'excessive-failed-logins-single-user',
    name: 'Excessive Failed Logins (Single User)',
    category: 'Authentication & Access',
    description: 'A high volume of failed login attempts targeting a single user account, indicating a targeted brute force attack against that specific user.',
    causes: [
      'Targeted brute force attack (e.g., after obtaining a list of valid usernames).',
      'User error (e.g., stuck keyboard, misconfigured application).',
    ],
    actions: [
      'Step 1: **Immediate Suspension.** If the threshold is exceeded, immediately suspend the user account.',
      'Step 2: **Identify Source.** Determine the source IP address(es) of the failed attempts.',
      'Step 3: **Contact User.** Contact the user out-of-band to verify if they are attempting to log in.',
      'Step 4: **Containment (Source).** Block the source IP at the perimeter if external and malicious.',
      'Step 5: **Remediation.** Force a password reset and ensure MFA is enabled before re-enabling the account.',
    ],
    queries: [
      { tool: 'SIEM', query: 'index=auth status=failure | stats count by src_ip, user | where user="[TARGET_USER]" AND count > 10' },
    ],
    tools: ['Identity Provider Logs', 'Firewall/WAF', 'Communication Tools'],
    escalation: 'Escalate if the targeted user is high-value or if the attack source is internal.',
  },
  {
    id: 'disabled-account-activity',
    name: 'Activity Detected from Disabled Account',
    category: 'Authentication & Access',
    description: 'A successful or failed authentication attempt originating from an account that is officially disabled or marked as dormant.',
    causes: [
      'Attacker using a previously compromised account that was disabled but not fully purged.',
      'Misconfigured application or service attempting to use cached credentials.',
    ],
    actions: [
      'Step 1: **Verify Status.** Confirm the account is disabled in the Identity Provider (IdP).',
      'Step 2: **Identify Activity.** Determine the type of activity (login, file access, API call) and the source IP.',
      'Step 3: **Immediate Containment.** If successful, immediately invalidate all sessions and ensure the account is fully locked/suspended.',
      'Step 4: **Root Cause Analysis.** Investigate how the disabled account was able to generate activity (e.g., token not revoked, service bypass).',
      'Step 5: **Remediation.** If malicious, perform forensic analysis on the source host and review account decommissioning procedures.',
    ],
    queries: [
      { tool: 'Identity Logs', query: 'LoginEvents | where user="[DISABLED_USER]" AND status="Success"' },
    ],
    tools: ['Identity Provider Logs', 'SIEM', 'EDR'],
    escalation: 'High priority. Indicates a severe gap in account lifecycle management.',
  },
  {
    id: 'ad-golden-ticket-attempt',
    name: 'AD Golden Ticket Attempt Detected',
    category: 'Authentication & Access',
    description: 'Detection of suspicious Kerberos ticket requests (TGT) that bypass normal authentication, often indicating a Golden Ticket attack or similar Kerberos abuse.',
    causes: [
      'Attacker has compromised the KRBTGT account hash.',
      'Post-exploitation activity after Domain Controller compromise.',
    ],
    actions: [
      'Step 1: **CRITICAL ISOLATION.** Immediately isolate the Domain Controller(s) showing suspicious Kerberos activity.',
      'Step 2: **Analyze Ticket.** Review the Kerberos logs for unusual ticket lifetimes, encryption types, or user fields.',
      'Step 3: **Engage IR.** Notify the Incident Response Team and management immediately.',
      'Step 4: **Remediation.** Initiate the KRBTGT password reset procedure (requires two resets) and audit all privileged accounts.',
    ],
    queries: [
      { tool: 'AD Logs', query: 'EventID=4769 AND TicketOptions CONTAINS "Forwardable" AND TargetUserName="krbtgt"' },
    ],
    tools: ['Active Directory Management Tools', 'SIEM', 'Forensic Toolkit'],
    escalation: 'CRITICAL. This indicates Domain Admin level compromise.',
  },
  // --- NEW CRITICAL ALERT ---
  {
    id: 'ad-silver-ticket',
    name: 'Kerberos Service Ticket Request Anomaly (Potential Silver Ticket)',
    category: 'Authentication & Access',
    description: 'A Kerberos Service Ticket (ST) was requested for a service (e.g., CIFS, HTTP) without a corresponding successful Kerberos Ticket Granting Ticket (TGT) request, suggesting a Silver Ticket attack.',
    causes: [
      'Attacker has compromised a service account hash (NTLM hash) and is forging service tickets for lateral movement.',
      'Misconfigured service principal name (SPN) or Kerberos delegation.',
    ],
    actions: [
      'Step 1: **CRITICAL ISOLATION.** Immediately isolate the host where the suspicious service ticket was used.',
      'Step 2: **Identify Service Account.** Determine the service account whose hash was likely compromised (the target of the ST).',
      'Step 3: **Audit Service Account.** Review the service account\'s permissions and recent activity for signs of compromise.',
      'Step 4: **Remediation.** Immediately reset the password for the compromised service account (twice, if possible) and audit all systems the account has access to.',
      'Step 5: **Forensic Analysis.** Perform deep forensic analysis on the isolated host to identify the attacker\'s tools and methods.',
    ],
    queries: [
      { tool: 'AD Logs', query: 'EventID=4769 AND TargetUserName="[SERVICE_ACCOUNT]" AND NOT EXISTS (EventID=4768 within 5 minutes)' },
    ],
    tools: ['Active Directory Management Tools', 'SIEM', 'Forensic Toolkit'],
    escalation: 'CRITICAL. Indicates deep internal network compromise and lateral movement capability.',
  },
  // --- NEW HIGH ALERT ---
  {
    id: 'vpn-failed-logins',
    name: 'Excessive Failed Logins to VPN (Targeted)',
    category: 'Authentication & Access',
    description: 'A single user account is experiencing a high volume of failed VPN login attempts from various external IP addresses, indicating a targeted brute force or credential testing attack.',
    causes: [
      'Targeted brute force attack against a high-value user.',
      'Credential stuffing using leaked credentials.',
    ],
    actions: [
      'Step 1: **Immediate Suspension.** Immediately suspend the targeted user account and invalidate all VPN sessions.',
      'Step 2: **Identify Source IPs.** Determine the source IP addresses involved in the failed attempts.',
      'Step 3: **Containment (Source).** Block the source IP range(s) at the VPN concentrator or perimeter firewall.',
      'Step 4: **Contact User.** Contact the user out-of-band to confirm they are not attempting to log in.',
      'Step 5: **Remediation.** Force a password reset and ensure MFA is mandatory and enforced for VPN access.',
    ],
    queries: [
      { tool: 'VPN Logs', query: 'user="[TARGET_USER]" AND status="Failure" | stats count by src_ip | where count > 10' },
    ],
    tools: ['VPN Concentrator Logs', 'Firewall/WAF', 'Identity Provider'],
    escalation: 'Escalate if the targeted user is high-privilege or if the attack source is internal.',
  },
  // --- NEW MEDIUM ALERT ---
  {
    id: 'unusual-login-time',
    name: 'Successful Login Outside Business Hours',
    category: 'Authentication & Access',
    description: 'A successful login occurred for a standard user account significantly outside of defined business hours (e.g., 3 AM local time).',
    causes: [
      'Compromised account being used by an attacker in a different time zone.',
      'Legitimate remote work or travel (False Positive).',
    ],
    actions: [
      'Step 1: **Identify User and Time.** Determine the user, source IP, and exact time of the login.',
      'Step 2: **Contact User.** Contact the user out-of-band to verify the activity and location.',
      'Step 3: **Audit Activity.** Review all activity performed during the session (e.g., file access, email activity).',
      'Step 4: **Containment (If Malicious).** If unauthorized, immediately suspend the account and force a password reset.',
      'Step 5: **Mitigation.** Implement conditional access policies to restrict access outside of normal hours for non-traveling users.',
    ],
    queries: [
      { tool: 'Identity Logs', query: 'LoginEvents | where status="Success" AND hour_of_day NOT IN (8, 9, ..., 17)' },
    ],
    tools: ['Identity Provider Logs', 'Communication Tools', 'SIEM'],
    escalation: 'Escalate if the user cannot be reached or if sensitive data was accessed.',
  },

  // --- 2. Network & Firewall Alerts (Total: 20) ---
  {
    id: 'dns-tunneling',
    name: 'DNS Tunneling Detected',
    category: 'Network & Firewall',
    description: 'Detection of data being covertly transmitted over the DNS protocol, often characterized by unusually large or frequent DNS queries to a specific external server.',
    causes: [
      'Compromised internal host.',
      'Use of a DNS tunneling tool (e.g., Iodine, Dnscat2).',
      'Attacker bypassing traditional firewall rules.',
    ],
    actions: [
      'Step 1: **Verify Alert.** Confirm the alert by checking the volume and rate of DNS queries from the source IP. Look for non-standard characters (high entropy) in the query names.',
      'Step 2: **Identify Source.** Determine the hostname and user associated with the source IP address.',
      'Step 3: **Containment.** Immediately isolate the source host from the network to stop data exfiltration.',
      'Step 4: **Perimeter Block.** Block the external destination DNS server IP and domain at the firewall and DNS filter.',
      'Step 5: **Forensic Analysis.** Analyze the isolated host for the presence of DNS tunneling software or malware that initiated the connection.',
      'Step 6: **Remediation.** If malware is found, follow the Malware Eradication playbook. If a legitimate tool was misused, enforce policy.',
    ],
    queries: [
      { tool: 'DNS Logs', query: 'query_length > 100 AND query_count > 500 | group by src_ip, query_domain' },
    ],
    tools: ['DNS Server Logs', 'SIEM/Log Analytics', 'EDR', 'Firewall/IPS'],
    escalation: 'Escalate if the host is a critical server or if confirmed sensitive data was exfiltrated.',
  },
  {
    id: 'data-exfiltration-attempt',
    name: 'Data Exfiltration Attempt',
    category: 'Network & Firewall',
    description: 'Detection of unusually large outbound data transfers to an external, non-corporate destination, often using encrypted or non-standard protocols.',
    causes: [
      'Insider threat attempting to steal data.',
      'Malware communicating with a C2 server to upload stolen data.',
      'Misconfigured backup or synchronization service (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Destination.** Determine the source host, user, and the external destination IP/domain receiving the data.',
      'Step 2: **Containment.** Immediately isolate the source host from the network.',
      'Step 3: **Verify Legitimacy.** Contact the user/owner out-of-band to verify the transfer. Check change management for approved large transfers.',
      'Step 4: **DLP Review.** Check DLP logs to see if the transferred data was tagged as sensitive (PII, IP).',
      'Step 5: **Perimeter Block.** Block the destination IP/domain at the firewall/proxy.',
      'Step 6: **Forensic Analysis.** If malicious, perform a forensic analysis on the source host to identify the method and scope of data collection.',
    ],
    queries: [
      { tool: 'NetFlow/Firewall', query: 'traffic_outbound > 1GB AND dest_ip NOT IN (corporate_destinations) | top src_ip' },
    ],
    tools: ['NetFlow Analyzer', 'DLP System', 'Firewall Logs', 'EDR'],
    escalation: 'CRITICAL. Escalate immediately if sensitive data exfiltration is confirmed.',
  },
  {
    id: 'port-scan-detected',
    name: 'Port Scan Detected',
    category: 'Network & Firewall',
    description: 'A host is rapidly scanning a range of IP addresses or ports on the network, indicating reconnaissance activity.',
    causes: [
      'Attacker mapping the internal network.',
      'Vulnerability scanner or penetration testing tool (False Positive).',
      'Misconfigured network monitoring tool.',
    ],
    actions: [
      'Step 1: **Identify Scanner and Target.** Determine the source IP performing the scan and the target IP range.',
      'Step 2: **Verify Legitimacy.** Check if the source IP belongs to an approved security tool or team (e.g., vulnerability scanner).',
      'Step 3: **Containment.** If unauthorized, block the source IP at the internal firewall or network access control (NAC) layer.',
      'Step 4: **Check for Follow-up Activity.** Review logs for any immediate connection attempts or exploitation attempts following the scan.',
      'Step 5: **Forensic Analysis.** If the source is an internal host, isolate it and check for malware or unauthorized tools.',
    ],
    queries: [
      { tool: 'IPS/Firewall Logs', query: 'event_type="Port_Scan" | group by src_ip, dest_ip_range' },
    ],
    tools: ['IPS/Firewall Console', 'NAC', 'Asset Inventory'],
    escalation: 'Escalate if the scan is followed by successful exploitation attempts.',
  },
  {
    id: 'connection-to-malicious-ip',
    name: 'Connection to Known Malicious IP',
    category: 'Network & Firewall',
    description: 'An internal host initiated a connection to an external IP address identified as malicious (e.g., C2, malware distribution) by threat intelligence.',
    causes: [
      'Active malware infection on the internal host.',
      'User accidentally browsing a malicious website.',
    ],
    actions: [
      'Step 1: **Validate IOC.** Confirm the external IP is still listed as malicious in threat feeds.',
      'Step 2: **Identify Source Host.** Determine the internal source IP, hostname, and the process that initiated the connection.',
      'Step 3: **Containment.** Immediately isolate the source host from the network.',
      'Step 4: **Perimeter Block.** Block the malicious external IP at the firewall/proxy.',
      'Step 5: **Forensic Analysis.** Perform a deep scan on the isolated host to identify the malware or root cause of the connection.',
      'Step 6: **IOC Search.** Search the entire environment (SIEM, EDR) for the malicious IP and any associated file hashes.',
    ],
    queries: [
      { tool: 'Proxy/Firewall Logs', query: 'dest_ip="[MALICIOUS_IP]" AND action="Allowed"' },
    ],
    tools: ['Threat Intelligence Platform', 'Firewall/Proxy', 'EDR'],
    escalation: 'High priority. Escalate if the connection resulted in a successful data transfer or payload download.',
  },
  {
    id: 'large-outbound-icmp',
    name: 'Large Volume of Outbound ICMP Traffic',
    category: 'Network & Firewall',
    description: 'Detection of unusually high ICMP (ping) traffic volume originating from an internal host, potentially indicating network mapping or data exfiltration (ICMP tunneling).',
    causes: [
      'Attacker performing network reconnaissance.',
      'ICMP tunneling malware attempting to exfiltrate data.',
      'Misconfigured network monitoring tool (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Destination.** Determine the source host and the destination IP(s) receiving the ICMP traffic.',
      'Step 2: **Containment.** Immediately isolate the source host from the network.',
      'Step 3: **Analyze Payload.** If possible, inspect the ICMP packets for non-standard data payloads (indicative of tunneling).',
      'Step 4: **Forensic Analysis.** Analyze the isolated host for ICMP tunneling tools or malware.',
      'Step 5: **Remediation.** Block outbound ICMP traffic to external networks unless explicitly required.',
    ],
    queries: [
      { tool: 'NetFlow/Firewall', query: 'protocol="ICMP" AND traffic_outbound > 10000 | top src_ip' },
    ],
    tools: ['NetFlow Analyzer', 'Firewall/IPS', 'EDR'],
    escalation: 'Escalate if ICMP tunneling is confirmed or if the source is a critical server.',
  },
  {
    id: 'internal-host-scanning',
    name: 'Internal Host Scanning Internal Network',
    category: 'Network & Firewall',
    description: 'An internal host is performing rapid port scanning against other internal hosts, indicating potential compromise and lateral movement reconnaissance.',
    causes: [
      'Compromised host running a network scanner (e.g., Nmap).',
      'Worm or self-propagating malware.',
      'Legitimate vulnerability scanner running outside of schedule (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Scanner and Targets.** Determine the source IP and the range of internal IPs being scanned.',
      'Step 2: **Immediate Isolation.** Isolate the source host from the network.',
      'Step 3: **Verify Legitimacy.** Check the asset inventory to confirm if the host is an approved scanner.',
      'Step 4: **Forensic Analysis.** Analyze the isolated host for unauthorized scanning tools or malware.',
      'Step 5: **Check for Exploitation.** Review logs on the target hosts for any immediate connection attempts or exploitation attempts following the scan.',
    ],
    queries: [
      { tool: 'IPS/Firewall Logs', query: 'event_type="Internal_Port_Scan" | group by src_ip' },
    ],
    tools: ['IPS/Firewall Console', 'EDR', 'Asset Inventory'],
    escalation: 'Escalate if the scanning host is a user endpoint or if exploitation attempts follow the scan.',
  },
  {
    id: 'unauthorized-external-rdp',
    name: 'Unauthorized External RDP/SSH Connection',
    category: 'Network & Firewall',
    description: 'A successful inbound RDP (3389) or SSH (22) connection from an external IP address that is not on the approved access list.',
    causes: [
      'Attacker exploiting a weak password or vulnerability on an exposed service.',
      'Misconfigured firewall rule allowing external access.',
    ],
    actions: [
      'Step 1: **Identify Source and Target.** Determine the external source IP and the internal server/host accessed.',
      'Step 2: **Immediate Block.** Block the source IP at the perimeter firewall.',
      'Step 3: **Terminate Session.** Immediately terminate the RDP/SSH session on the target host.',
      'Step 4: **Audit Activity.** Review the session logs on the target host for commands executed or files accessed.',
      'Step 5: **Remediation.** Disable external RDP/SSH access unless absolutely necessary and enforce strong MFA for all remote access.',
    ],
    queries: [
      { tool: 'Firewall Logs', query: 'dest_port IN (22, 3389) AND src_ip NOT IN (approved_external_ips)' },
    ],
    tools: ['Firewall Console', 'Server Logs', 'Identity Provider'],
    escalation: 'CRITICAL. Escalate immediately, especially if the target is a domain controller or critical server.',
  },
  {
    id: 'high-bandwidth-uncategorized',
    name: 'High Bandwidth Usage to Uncategorized Domain',
    category: 'Network & Firewall',
    description: 'A host is sending or receiving a large volume of data to a domain that is not classified by the web proxy or DNS filter, often used by new C2 infrastructure.',
    causes: [
      'Malware communicating with a newly registered C2 server.',
      'User accessing a legitimate, but new, cloud service (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Domain.** Determine the source host and the uncategorized domain/IP.',
      'Step 2: **Containment.** Temporarily block the domain/IP at the proxy/firewall.',
      'Step 3: **Analyze Domain.** Use external tools (e.g., VirusTotal, WHOIS) to analyze the domain reputation and registration date.',
      'Step 4: **Forensic Analysis.** Analyze the source host to determine the process initiating the connection.',
      'Step 5: **Remediation.** If malicious, follow the Malware Eradication playbook and add the domain to the threat intelligence feed.',
    ],
    queries: [
      { tool: 'Proxy Logs', query: 'category="Uncategorized" AND bytes_sent > 100MB | top src_ip' },
    ],
    tools: ['Web Proxy Logs', 'Threat Intelligence Tools', 'EDR'],
    escalation: 'Escalate if the domain is confirmed malicious or if data exfiltration is suspected.',
  },
  {
    id: 'smb-traffic-external',
    name: 'Outbound SMB Traffic Detected',
    category: 'Network & Firewall',
    description: 'Detection of Server Message Block (SMB) traffic attempting to connect to an external IP address, which is highly unusual and often indicates data exfiltration or C2 communication.',
    causes: [
      'Malware attempting to communicate with an external C2 server over SMB.',
      'Misconfigured internal application attempting to reach an external resource.',
    ],
    actions: [
      'Step 1: **Identify Source and Destination.** Determine the internal source host and the external destination IP (port 445/139).',
      'Step 2: **Containment.** Immediately isolate the source host and block the external destination IP at the perimeter.',
      'Step 3: **Forensic Analysis.** Analyze the isolated host to determine the process initiating the SMB connection.',
      'Step 4: **Remediation.** If malicious, follow the Malware Eradication playbook. Review firewall rules to ensure outbound SMB is strictly denied.',
    ],
    queries: [
      { tool: 'Firewall Logs', query: 'dest_port IN (139, 445) AND dest_ip NOT IN (internal_ranges)' },
    ],
    tools: ['Firewall/IPS', 'EDR', 'NetFlow Analyzer'],
    escalation: 'High priority. SMB should almost never be outbound to the internet.',
  },
  {
    id: 'lateral-movement-smb',
    name: 'High Volume Internal SMB Connections',
    category: 'Network & Firewall',
    description: 'An internal host is initiating an unusually high number of successful SMB connections to other internal hosts, often indicating lateral movement or reconnaissance.',
    causes: [
      'Attacker using stolen credentials to map and move across the network.',
      'Worm or self-propagating malware spreading.',
    ],
    actions: [
      'Step 1: **Identify Source.** Determine the source host initiating the high volume of connections.',
      'Step 2: **Immediate Isolation.** Isolate the source host from the network.',
      'Step 3: **Analyze Targets.** Review the list of target hosts and check their logs for successful logins or file access from the source.',
      'Step 4: **Forensic Analysis.** Analyze the isolated host for lateral movement tools (e.g., PsExec, Mimikatz) or malware.',
    ],
    queries: [
      { tool: 'NetFlow/Firewall', query: 'protocol="SMB" AND src_ip="[INTERNAL_IP]" | stats count by dest_ip | where count > 50' },
    ],
    tools: ['NetFlow Analyzer', 'EDR', 'SIEM'],
    escalation: 'CRITICAL. Strong indicator of an active network compromise.',
  },
  {
    id: 'unusual-protocol-port',
    name: 'Unusual Protocol/Port Combination',
    category: 'Network & Firewall',
    description: 'Traffic detected using a known protocol on a non-standard port (e.g., HTTP traffic on port 53), often used for covert communication or tunneling.',
    causes: [
      'Attacker attempting to bypass firewall rules by using non-standard ports.',
      'Misconfigured application (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Protocol.** Determine the source host and the actual protocol being used (e.g., HTTP) versus the port (e.g., 53).',
      'Step 2: **Containment.** Temporarily block the traffic flow at the firewall.',
      'Step 3: **Analyze Payload.** Inspect the packet payload to confirm the nature of the traffic.',
      'Step 4: **Forensic Analysis.** Analyze the source host for malware or tunneling tools.',
    ],
    queries: [
      { tool: 'IPS/Firewall Logs', query: 'protocol="HTTP" AND dest_port NOT IN (80, 443, 8080)' },
    ],
    tools: ['Firewall/IPS', 'Packet Analyzer', 'EDR'],
    escalation: 'Escalate if covert communication is confirmed.',
  },
  {
    id: 'large-inbound-transfer',
    name: 'Unusually Large Inbound Data Transfer',
    category: 'Network & Firewall',
    description: 'Detection of an unusually large volume of data being transferred inbound from an external source to an internal host, potentially indicating a large malware payload or data staging.',
    causes: [
      'Attacker downloading a large toolset or payload.',
      'Legitimate large file download by a user (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Destination.** Determine the external source IP and the internal destination host.',
      'Step 2: **Containment.** Immediately isolate the destination host.',
      'Step 3: **Verify Legitimacy.** Contact the user/owner out-of-band to verify the transfer.',
      'Step 4: **Forensic Analysis.** Analyze the isolated host for the downloaded file and its execution status.',
    ],
    queries: [
      { tool: 'NetFlow/Firewall', query: 'traffic_inbound > 500MB AND src_ip NOT IN (approved_sources)' },
    ],
    tools: ['NetFlow Analyzer', 'Firewall Logs', 'EDR'],
    escalation: 'Escalate if the transfer was unauthorized and the file is suspicious.',
  },
  {
    id: 'ip-reputation-hit',
    name: 'Internal Host Communicating with Bad Reputation IP',
    category: 'Network & Firewall',
    description: 'An internal host initiated a connection to an external IP address flagged by threat intelligence as a high-confidence malicious indicator (e.g., botnet member, spam source).',
    causes: [
      'Active malware infection on the internal host.',
      'User accidentally browsing a malicious website.',
    ],
    actions: [
      'Step 1: **Validate IOC.** Confirm the external IP is still listed as malicious in threat feeds.',
      'Step 2: **Identify Source Host.** Determine the internal source IP, hostname, and the process that initiated the connection.',
      'Step 3: **Containment.** Immediately isolate the source host from the network.',
      'Step 4: **Perimeter Block.** Block the malicious external IP at the firewall/proxy.',
      'Step 5: **Forensic Analysis.** Perform a deep scan on the isolated host to identify the malware or root cause of the connection.',
      'Step 6: **IOC Search.** Search the entire environment (SIEM, EDR) for the malicious IP and any associated file hashes.',
    ],
    queries: [
      { tool: 'Proxy/Firewall Logs', query: 'dest_ip IN (Threat_Feed_List) AND action="Allowed"' },
    ],
    tools: ['Threat Intelligence Platform', 'Firewall/Proxy', 'EDR'],
    escalation: 'High priority. Escalate if the connection resulted in a successful data transfer or payload download.',
  },
  {
    id: 'web-shell-traffic',
    name: 'Web Shell Traffic Detected',
    category: 'Network & Firewall',
    description: 'Detection of network traffic patterns consistent with a web shell connection, typically involving high entropy POST requests or unusual command execution over HTTP/S.',
    causes: [
      'Successful exploitation of a web application vulnerability (e.g., file upload, deserialization).',
      'Attacker using the web shell for reconnaissance or lateral movement.',
    ],
    actions: [
      'Step 1: **Identify Source and Target.** Determine the source IP and the web server hosting the shell.',
      'Step 2: **Immediate Isolation.** Isolate the affected web server from the network and take a forensic image.',
      'Step 3: **Identify Shell Location.** Locate and remove the web shell file(s) from the server.',
      'Step 4: **Root Cause Analysis.** Determine the vulnerability exploited to upload the shell and patch the application immediately.',
      'Step 5: **Audit Activity.** Review server logs for commands executed via the shell.',
    ],
    queries: [
      { tool: 'WAF/Proxy Logs', query: 'uri_path CONTAINS ("cmd.php", "shell.aspx") OR http_post_body CONTAINS ("base64", "system(") AND entropy > 6.0' },
    ],
    tools: ['WAF/IPS', 'Server Logs', 'Application Security Scanner'],
    escalation: 'CRITICAL. Web shells grant persistent remote access to the server.',
  },
  {
    id: 'vpn-login-multiple-countries',
    name: 'VPN Login from Multiple Countries',
    category: 'Network & Firewall',
    description: 'A single VPN user account successfully logged in from two or more geographically distant countries within a short, impossible time frame.',
    causes: [
      'Compromised VPN credentials being shared or sold.',
      'Attacker using proxy services to mask location.',
    ],
    actions: [
      'Step 1: **Immediate Suspension.** Immediately suspend the VPN account and invalidate all active sessions.',
      'Step 2: **Contact User.** Contact the user out-of-band to verify the activity.',
      'Step 3: **Analyze Login Chain.** Review the full login history, noting IPs, devices, and MFA status for both suspicious logins.',
      'Step 4: **Remediation.** If malicious, force a password reset and ensure strong MFA is enforced for VPN access.',
    ],
    queries: [
      { tool: 'VPN Logs', query: 'LoginEvents | where TimeDifference < 1 hour and CountryCount > 1' },
    ],
    tools: ['VPN Concentrator Logs', 'Identity Provider Logs', 'GeoIP Database'],
    escalation: 'High priority. Indicates compromised remote access credentials.',
  },
  {
    id: 'internal-dns-exfiltration',
    name: 'Internal DNS Exfiltration Attempt',
    category: 'Network & Firewall',
    description: 'An internal DNS server is receiving an unusually high volume of queries from a single host, often with high-entropy subdomains, indicating data exfiltration via DNS.',
    causes: [
      'Malware or attacker using DNS tunneling to covertly send data out of the network.',
    ],
    actions: [
      'Step 1: **Identify Source.** Determine the internal host generating the excessive DNS queries.',
      'Step 2: **Containment.** Immediately isolate the source host.',
      'Step 3: **Analyze Queries.** Inspect the query names for high entropy or encoded data patterns.',
      'Step 4: **Perimeter Block.** Block the external destination DNS server IP and domain.',
      'Step 5: **Forensic Analysis.** Analyze the isolated host for DNS tunneling tools.',
    ],
    queries: [
      { tool: 'DNS Logs', query: 'query_count > 1000 AND query_entropy > 5.0 | group by src_ip' },
    ],
    tools: ['DNS Server Logs', 'NetFlow Analyzer', 'EDR'],
    escalation: 'Escalate if confirmed data exfiltration is occurring.',
  },
  {
    id: 'icmp-flood-detected',
    name: 'ICMP Flood Detected',
    category: 'Network & Firewall',
    description: 'A high volume of ICMP (ping) packets targeting a single internal host or network segment, potentially indicating a denial of service (DoS) or reconnaissance activity.',
    causes: [
      'Attacker performing network mapping or DoS attack.',
      'Misconfigured monitoring tool (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Target.** Determine the source IP(s) and the target host(s).',
      'Step 2: **Containment.** Implement rate limiting or block the source IP(s) at the firewall/IPS.',
      'Step 3: **Verify Legitimacy.** Check if the source IP belongs to an approved monitoring system.',
      'Step 4: **Monitor Target.** Monitor the target host\'s resource utilization (CPU, network) for impact.',
    ],
    queries: [
      { tool: 'IPS/Firewall Logs', query: 'protocol="ICMP" AND packet_count > 5000 | top dest_ip' },
    ],
    tools: ['IPS/Firewall Console', 'Network Monitoring Tools'],
    escalation: 'Escalate if the attack causes service disruption.',
  },
  {
    id: 'unauthorized-nat-change',
    name: 'Unauthorized Firewall NAT Rule Change',
    category: 'Network & Firewall',
    description: 'A Network Address Translation (NAT) rule on a perimeter firewall was modified or created without proper change control, potentially exposing internal services.',
    causes: [
      'Compromised firewall administrator account.',
      'Insider threat attempting to create a backdoor.',
      'Misconfigured automation (False Positive).',
    ],
    actions: [
      'Step 1: **Immediate Reversal.** Immediately revert the NAT rule change to its previous state.',
      'Step 2: **Identify Changer.** Determine the user or account that made the unauthorized change.',
      'Step 3: **Audit Exposure.** Determine which internal service was exposed and check its logs for external access during the exposure window.',
      'Step 4: **Investigate Changer.** If the changer account was compromised, suspend it and force a password rotation.',
    ],
    queries: [
      { tool: 'Firewall Audit Logs', query: 'event_type="NAT_Rule_Modification" AND user NOT IN (approved_admins)' },
    ],
    tools: ['Firewall Management Console', 'Change Management System'],
    escalation: 'CRITICAL. Unauthorized firewall changes are a major security breach.',
  },
  // --- NEW CRITICAL ALERT ---
  {
    id: 'geo-blocked-traffic',
    name: 'High Volume Outbound Traffic to Geo-Blocked Country',
    category: 'Network & Firewall',
    description: 'An internal host is attempting to establish a high volume of connections to an external country or region explicitly blocked by policy, often indicating C2 communication or data staging.',
    causes: [
      'Active malware infection attempting to beacon to a C2 server located in a restricted region.',
      'Misconfigured application attempting to reach a cloud service endpoint in the wrong region.',
    ],
    actions: [
      'Step 1: **Identify Source and Destination.** Determine the source host and the destination country/IP.',
      'Step 2: **Immediate Isolation.** Isolate the source host from the network.',
      'Step 3: **Perimeter Block.** Ensure the destination IP/country is permanently blocked at the firewall.',
      'Step 4: **Forensic Analysis.** Analyze the isolated host to determine the process initiating the connection and search for malware.',
      'Step 5: **Audit Data.** Check network logs for any successful data transfer before the block was enforced.',
    ],
    queries: [
      { tool: 'Firewall Logs', query: 'dest_country IN (Geo_Blocked_List) AND traffic_outbound > 10MB' },
    ],
    tools: ['Firewall/IPS', 'GeoIP Database', 'EDR'],
    escalation: 'CRITICAL. Strong indicator of active C2 communication or data exfiltration.',
  },
  // --- NEW HIGH ALERT ---
  {
    id: 'new-external-port',
    name: 'New External Port Opened on Firewall',
    category: 'Network & Firewall',
    description: 'A new inbound firewall rule was created allowing external access to an internal port without proper change control, potentially exposing a service.',
    causes: [
      'Compromised administrator account modifying firewall rules.',
      'Misconfigured automation or manual error.',
    ],
    actions: [
      'Step 1: **Identify Change and Port.** Determine the user/account that made the change and the newly opened port/protocol.',
      'Step 2: **Immediate Reversal.** Immediately delete or disable the unauthorized firewall rule.',
      'Step 3: **Audit Exposure.** Check the internal host exposed by the rule for any inbound connections during the exposure window.',
      'Step 4: **Investigate Changer.** If unauthorized, suspend the changer account and force a password rotation.',
    ],
    queries: [
      { tool: 'Firewall Audit Logs', query: 'event_type="Rule_Creation" AND direction="Inbound" AND src_ip="0.0.0.0/0"' },
    ],
    tools: ['Firewall Management Console', 'Change Management System', 'SIEM'],
    escalation: 'High priority. Unauthorized exposure of internal services.',
  },

  // --- 3. Endpoint & Malware Alerts (Total: 22) ---
  {
    id: 'ransomware-behavior',
    name: 'Ransomware Behavior Detected',
    category: 'Endpoint & Malware',
    description: 'Detection of suspicious file encryption, mass file renaming, or deletion activity characteristic of ransomware.',
    causes: [
      'Successful execution of a ransomware payload.',
      'User opening a malicious document or clicking a link.',
    ],
    actions: [
      'Step 1: **Immediate Isolation.** Immediately isolate the affected host(s) from the network. Do NOT shut down the machine.',
      'Step 2: **Identify Scope.** Determine the initial point of infection and how many files/shares have been accessed or encrypted.',
      'Step 3: **Process Termination.** Use EDR to terminate the malicious encryption process across all affected hosts.',
      'Step 4: **IOC Extraction.** Extract file hashes, process names, and any ransom notes for threat intelligence.',
      'Step 5: **Engage IR.** Notify the Incident Response Team and management immediately due to the high impact.',
      'Step 6: **Backup Verification.** Verify the integrity and availability of recent backups for recovery.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="File_Modification" AND file_extension IN (".lock", ".encrypted") | top hostname' },
    ],
    tools: ['EDR Console', 'Backup Management System', 'Forensic Toolkit'],
    escalation: 'CRITICAL. Engage Crisis Management Team immediately.',
  },
  {
    id: 'fileless-malware',
    name: 'Fileless Malware Activity',
    category: 'Endpoint & Malware',
    description: 'Detection of malicious activity executed entirely in memory or via legitimate system tools (e.g., PowerShell, WMI) without dropping a traditional executable file.',
    causes: [
      'Exploitation of a vulnerability leading to in-memory payload execution.',
      'Use of living-off-the-land binaries (LOLBAS) by an attacker.',
    ],
    actions: [
      'Step 1: **Capture Memory.** Immediately capture a memory dump of the affected host before isolation (if possible) to preserve volatile data.',
      'Step 2: **Isolate Host.** Isolate the affected endpoint from the network.',
      'Step 3: **Analyze Process Tree.** Review the process tree in the EDR to identify the parent process that launched the suspicious script (e.g., PowerShell, wmic).',
      'Step 4: **Identify Persistence.** Check registry keys (Run keys), WMI event subscriptions, and scheduled tasks for persistence mechanisms.',
      'Step 5: **IOC Extraction.** Extract any encoded commands or scripts found in the process arguments for decoding and analysis.',
      'Step 6: **Remediation.** Re-image the host, as fileless malware can be difficult to fully eradicate without a clean OS install.',
    ],
    queries: [
      { tool: 'EDR', query: 'process_name="powershell.exe" AND command_line CONTAINS "EncodedCommand"' },
    ],
    tools: ['EDR Console', 'Memory Forensic Tools', 'SIEM'],
    escalation: 'Escalate immediately, as fileless attacks indicate a sophisticated and active threat actor.',
  },
  {
    id: 'suspicious-process-lolbas',
    name: 'Suspicious Process Execution (LOLBAS)',
    category: 'Endpoint & Malware',
    description: 'Detection of a legitimate system utility (e.g., certutil, bitsadmin, mshta) being executed with suspicious command-line arguments, often used for downloading malware or persistence.',
    causes: [
      'Attacker using Living Off the Land Binaries (LOLBAS) to evade detection.',
      'Malware payload executing via a trusted process.',
    ],
    actions: [
      'Step 1: **Identify Process and Arguments.** Determine the exact utility used (e.g., `certutil.exe`) and the full command line arguments, looking for external URLs or unusual file paths.',
      'Step 2: **Isolate Host.** Immediately isolate the affected endpoint from the network.',
      'Step 3: **Check Parent Process.** Review the process tree to identify the parent process that launched the suspicious utility (e.g., a browser, a document reader).',
      'Step 4: **Analyze Network Connections.** Check network logs for connections made by the utility to external IPs/domains mentioned in the arguments.',
      'Step 5: **IOC Extraction.** Extract any downloaded files or scripts for sandbox analysis.',
      'Step 6: **Remediation.** If malicious, follow the Malware Eradication playbook, focusing on persistence removal and re-imaging.',
    ],
    queries: [
      { tool: 'EDR', query: 'process_name IN ("certutil.exe", "bitsadmin.exe") AND command_line CONTAINS "urlcache"' },
    ],
    tools: ['EDR Console', 'Network Logs', 'Sandbox Analysis'],
    escalation: 'Escalate if the process was used to download and execute a secondary payload.',
  },
  {
    id: 'persistence-mechanism-detected',
    name: 'Persistence Mechanism Detected',
    category: 'Endpoint & Malware',
    description: 'Detection of unauthorized modifications to system startup locations, such as new registry Run keys, WMI event subscriptions, or scheduled tasks.',
    causes: [
      'Malware attempting to survive a reboot.',
      'Attacker establishing long-term access.',
      'Misconfigured legitimate application (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Mechanism.** Determine the exact persistence method (e.g., specific registry key, scheduled task name, WMI filter).',
      'Step 2: **Isolate Host.** Immediately isolate the affected endpoint.',
      'Step 3: **Remove Persistence.** Delete the unauthorized registry key, scheduled task, or WMI subscription.',
      'Step 4: **Identify Payload.** Determine the file or command being executed by the persistence mechanism and analyze it for malicious intent.',
      'Step 5: **Root Cause Analysis.** Investigate how the persistence was created (e.g., which process, user, or vulnerability was exploited).',
      'Step 6: **Remediation.** If malicious, follow the Malware Eradication playbook and re-image the host.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="Registry_Modification" AND key_path CONTAINS "Run" AND process_name NOT IN (approved_list)' },
    ],
    tools: ['EDR Console', 'Registry Editor (Forensic)', 'SIEM'],
    escalation: 'Escalate if the persistence mechanism is tied to a high-privilege account or critical server.',
  },
  {
    id: 'unauthorized-powershell',
    name: 'Unauthorized PowerShell Command',
    category: 'Endpoint & Malware',
    description: 'Execution of a highly suspicious or encoded PowerShell command, often used for reconnaissance, downloading payloads, or lateral movement.',
    causes: [
      'Attacker using PowerShell for post-exploitation.',
      'Malware executing via a script.',
      'Legitimate administrative script running outside of approved parameters (False Positive).',
    ],
    actions: [
      'Step 1: **Capture Command Line.** Capture the full, decoded command line arguments.',
      'Step 2: **Isolate Host.** Immediately isolate the affected endpoint.',
      'Step 3: **Analyze Script.** Decode and analyze the script content for malicious functions (e.g., network connections, credential dumping).',
      'Step 4: **Check Parent Process.** Determine the parent process that launched PowerShell (e.g., a browser, a document).',
      'Step 5: **IOC Extraction.** Extract any external IPs, domains, or file hashes mentioned in the script.',
      'Step 6: **Remediation.** If malicious, follow the Malware Eradication playbook and enforce stricter PowerShell logging policies.',
    ],
    queries: [
      { tool: 'EDR', query: 'process_name="powershell.exe" AND command_line CONTAINS ("-EncodedCommand" OR "IEX")' },
    ],
    tools: ['EDR Console', 'PowerShell Transcription Logs', 'Sandbox Analysis'],
    escalation: 'Escalate if the command was used for credential theft or lateral movement.',
  },
  {
    id: 'suspicious-child-office',
    name: 'Suspicious Child Process of Office Application',
    category: 'Endpoint & Malware',
    description: 'A Microsoft Office application (Word, Excel) spawned an unusual child process like PowerShell, cmd.exe, or a browser, often indicating a macro-based attack.',
    causes: [
      'Malicious macro execution in a document.',
      'Exploitation of an Office vulnerability.',
    ],
    actions: [
      'Step 1: **Identify Host and User.** Determine the host and user who opened the document.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Analyze Document.** Retrieve the original document (if possible) and analyze the macro code or embedded objects.',
      'Step 4: **Process Termination.** Terminate the suspicious child process and the parent Office application.',
      'Step 5: **IOC Search.** Search the environment for the document hash and any downloaded files.',
      'Step 6: **Remediation.** Delete the malicious document and re-image the host.',
    ],
    queries: [
      { tool: 'EDR', query: 'parent_process IN ("winword.exe", "excel.exe") AND child_process IN ("powershell.exe", "cmd.exe")' },
    ],
    tools: ['EDR Console', 'Email Security Gateway', 'Sandbox Analysis'],
    escalation: 'Escalate if the child process successfully downloaded and executed a payload.',
  },
  {
    id: 'wmi-persistence',
    name: 'WMI Persistence Mechanism',
    category: 'Endpoint & Malware',
    description: 'Detection of a new WMI Event Filter or Consumer being created, a common technique for fileless persistence and execution.',
    causes: [
      'Attacker establishing a hidden persistence mechanism.',
      'Advanced fileless malware.',
    ],
    actions: [
      'Step 1: **Identify Host and Mechanism.** Determine the host and the specific WMI filter/consumer created.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Remove Persistence.** Use WMI tools to immediately delete the unauthorized filter and consumer.',
      'Step 4: **Analyze Payload.** Determine the command or script that the WMI mechanism was set to execute.',
      'Step 5: **Root Cause Analysis.** Investigate the process that created the WMI object.',
      'Step 6: **Remediation.** Re-image the host to ensure complete removal of the threat.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="WMI_Modification" AND operation="Create" AND user NOT IN (approved_admins)' },
    ],
    tools: ['EDR Console', 'WMI Management Tools', 'SIEM'],
    escalation: 'High priority. WMI persistence is a strong indicator of a skilled attacker.',
  },
  {
    id: 'antivirus-service-stopped',
    name: 'Antivirus/EDR Service Stopped',
    category: 'Endpoint & Malware',
    description: 'A critical security service (Antivirus, EDR agent) was stopped, disabled, or tampered with on an endpoint.',
    causes: [
      'Attacker attempting to disable security controls before executing malware.',
      'Malware payload specifically targeting security software.',
      'System instability (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Host and User.** Determine the host and the user/process that stopped the service.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Restart Service.** Attempt to remotely restart the security service. If it fails, proceed with caution.',
      'Step 4: **Forensic Analysis.** Analyze the host for tools used to tamper with the service (e.g., `sc.exe`, registry changes).',
      'Step 5: **IOC Search.** Search the environment for any malware executed during the window the service was down.',
      'Step 6: **Remediation.** Re-image the host if tampering is confirmed.',
    ],
    queries: [
      { tool: 'EDR/SIEM', query: 'event_type="Service_Stop" AND service_name IN ("EDR_Agent", "AV_Service")' },
    ],
    tools: ['EDR Console', 'SIEM', 'Service Management Console'],
    escalation: 'CRITICAL. Escalate immediately, as the host is currently unprotected.',
  },
  {
    id: 'new-executable-temp-dir',
    name: 'New Executable in Temp Directory',
    category: 'Endpoint & Malware',
    description: 'A new executable file (.exe, .dll) was created and executed from a temporary or user profile directory (e.g., AppData, Temp).',
    causes: [
      'Malware dropping a payload after initial infection.',
      'Browser download or legitimate installer (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Host and File.** Determine the host, file path, and file hash.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Analyze File.** Submit the file hash to a sandbox or threat intelligence platform for analysis.',
      'Step 4: **Check Parent Process.** Determine the parent process that created and executed the file (e.g., a browser, an email client).',
      'Step 5: **Remediation.** Delete the malicious file and re-image the host if confirmed malicious.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="File_Creation" AND file_path CONTAINS ("AppData", "Temp") AND file_extension IN (".exe", ".dll")' },
    ],
    tools: ['EDR Console', 'Sandbox Analysis', 'Threat Intelligence'],
    escalation: 'Escalate if the file is confirmed malicious and executed successfully.',
  },
  {
    id: 'lateral-movement-attempt',
    name: 'Lateral Movement Attempt (PsExec/WMI)',
    category: 'Endpoint & Malware',
    description: 'Detection of tools like PsExec, WMI, or RDP being used to execute commands or establish sessions on a remote internal host from a non-administrative source.',
    causes: [
      'Attacker using stolen credentials to move across the network.',
      'Compromised user account attempting to access unauthorized resources.',
    ],
    actions: [
      'Step 1: **Identify Source and Target.** Determine the source host initiating the connection and the target host.',
      'Step 2: **Immediate Isolation.** Isolate both the source and target hosts.',
      'Step 3: **Analyze Credentials.** Determine which user credentials were used for the lateral movement attempt.',
      'Step 4: **Remediation.** Force a password reset for the compromised user account and perform forensic analysis on both hosts.',
      'Step 5: **Mitigation.** Restrict the use of administrative tools like PsExec to approved administrative jump boxes.',
    ],
    queries: [
      { tool: 'EDR/SIEM', query: 'process_name="psexec.exe" OR process_name="wmic.exe" AND remote_connection="True"' },
    ],
    tools: ['EDR Console', 'SIEM', 'Identity Provider'],
    escalation: 'CRITICAL. Escalate immediately, as this indicates network compromise.',
  },
  {
    id: 'process-injection-detected',
    name: 'Process Injection Detected',
    category: 'Endpoint & Malware',
    description: 'Detection of malicious code being injected into a legitimate, running process (e.g., explorer.exe, svchost.exe) to evade detection and execute payloads.',
    causes: [
      'Advanced malware or rootkit activity.',
      'Attacker attempting to hide C2 communication.',
    ],
    actions: [
      'Step 1: **Identify Host and Target Process.** Determine the host and the process being injected into.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Capture Memory.** Capture a memory dump of the host for forensic analysis of the injected code.',
      'Step 4: **Process Termination.** Terminate the injected process and the injecting process.',
      'Step 5: **Remediation.** Re-image the host, as injection often indicates deep system compromise.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="Process_Injection" AND target_process IN ("explorer.exe", "svchost.exe")' },
    ],
    tools: ['EDR Console', 'Memory Forensic Tools'],
    escalation: 'CRITICAL. Strong indicator of a sophisticated, active threat.',
  },
  {
    id: 'browser-credential-access',
    name: 'Browser Credential Access Attempt',
    category: 'Endpoint & Malware',
    description: 'Detection of a suspicious process attempting to access local browser credential stores (e.g., Chrome, Firefox password databases).',
    causes: [
      'Infostealer malware attempting to harvest stored credentials.',
      'Post-exploitation reconnaissance.',
    ],
    actions: [
      'Step 1: **Identify Host and Process.** Determine the host and the process attempting the access.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Analyze Process.** Determine the origin and intent of the suspicious process.',
      'Step 4: **Remediation.** Force password resets for all accounts used by the affected user, especially those with stored credentials. Re-image the host.',
    ],
    queries: [
      { tool: 'EDR', query: 'process_access_target CONTAINS ("Chrome/User Data/Default/Login Data", "Firefox/Profiles")' },
    ],
    tools: ['EDR Console', 'Password Management System'],
    escalation: 'High priority. Credential theft enables lateral movement.',
  },
  {
    id: 'suspicious-scheduled-task',
    name: 'Suspicious Scheduled Task Creation',
    category: 'Endpoint & Malware',
    description: 'Creation of a new scheduled task with hidden properties, high frequency, or executing a suspicious command/script, used for persistence.',
    causes: [
      'Attacker establishing persistence after initial access.',
      'Malware attempting to re-execute after reboot.',
    ],
    actions: [
      'Step 1: **Identify Host and Task.** Determine the host and the name/command of the suspicious task.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Remove Task.** Immediately delete the unauthorized scheduled task.',
      'Step 4: **Analyze Payload.** Analyze the file or command executed by the task for malicious intent.',
      'Step 5: **Root Cause Analysis.** Investigate the process that created the scheduled task.',
    ],
    queries: [
      { tool: 'EDR/SIEM', query: 'event_type="Scheduled_Task_Creation" AND task_name NOT IN (approved_list)' },
    ],
    tools: ['EDR Console', 'Task Scheduler (Forensic)'],
    escalation: 'Escalate if the task executes a high-privilege command.',
  },
  {
    id: 'system-file-modification',
    name: 'Critical System File Modification',
    category: 'Endpoint & Malware',
    description: 'Unauthorized modification or deletion of critical operating system files (e.g., hosts file, system DLLs, boot configuration).',
    causes: [
      'Malware attempting to disable security features or redirect traffic.',
      'Attacker tampering with system integrity.',
    ],
    actions: [
      'Step 1: **Identify Host and File.** Determine the host and the specific file modified.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Restore File.** Restore the modified file from a known good backup or system snapshot.',
      'Step 4: **Forensic Analysis.** Determine the process that performed the modification.',
      'Step 5: **Remediation.** Re-image the host if system integrity cannot be guaranteed.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="File_Modification" AND file_path CONTAINS ("system32", "hosts")' },
    ],
    tools: ['EDR Console', 'System Restore Tools'],
    escalation: 'CRITICAL. Indicates deep system compromise.',
  },
  {
    id: 'unusual-network-share-access',
    name: 'Unusual Network Share Access',
    category: 'Endpoint & Malware',
    description: 'An endpoint accessed an unusually high number of network shares or shares that are irrelevant to the user\'s role, indicating reconnaissance.',
    causes: [
      'Attacker performing internal reconnaissance after gaining a foothold.',
      'Misconfigured backup or indexing service (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Host and User.** Determine the source host and the user account performing the access.',
      'Step 2: **Containment.** Isolate the source host and suspend the user account.',
      'Step 3: **Audit Access.** Review the list of accessed shares and the files accessed within them.',
      'Step 4: **Remediation.** If malicious, follow the Compromised Account playbook and re-image the host.',
    ],
    queries: [
      { tool: 'File/Share Audit Logs', query: 'user="[USER]" | stats count(share_name) as unique_shares | where unique_shares > 10' },
    ],
    tools: ['File Audit Logs', 'EDR', 'Identity Provider'],
    escalation: 'Escalate if sensitive shares were accessed.',
  },
  {
    id: 'powershell-download-cradle',
    name: 'PowerShell Download Cradle Detected',
    category: 'Endpoint & Malware',
    description: 'Detection of a PowerShell command containing a common download cradle pattern (e.g., `(New-Object Net.WebClient).DownloadString`), used to fetch and execute remote payloads.',
    causes: [
      'Malware attempting to download a secondary stage payload.',
      'Attacker using fileless techniques.',
    ],
    actions: [
      'Step 1: **Capture Command Line.** Capture the full command line and the URL being accessed.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Analyze URL.** Check the URL reputation and attempt to retrieve the payload for analysis.',
      'Step 4: **Perimeter Block.** Block the external URL/IP at the firewall/proxy.',
      'Step 5: **Remediation.** Re-image the host and enforce PowerShell logging/script block logging.',
    ],
    queries: [
      { tool: 'EDR', query: 'process_name="powershell.exe" AND command_line CONTAINS "DownloadString"' },
    ],
    tools: ['EDR Console', 'Sandbox Analysis', 'Firewall/Proxy'],
    escalation: 'High priority. Indicates imminent payload execution.',
  },
  {
    id: 'boot-sector-modification',
    name: 'Boot Sector Modification Detected',
    category: 'Endpoint & Malware',
    description: 'Unauthorized modification of the Master Boot Record (MBR) or Boot Sector, often associated with bootkits or destructive malware.',
    causes: [
      'Bootkit malware infection.',
      'Attacker attempting to render the system unbootable.',
    ],
    actions: [
      'Step 1: **Immediate Isolation.** Isolate the affected host.',
      'Step 2: **Forensic Image.** Take a full forensic image of the disk, including the boot sector.',
      'Step 3: **Engage IR.** Notify the Incident Response Team immediately.',
      'Step 4: **Remediation.** Restore the MBR/Boot Sector from a clean backup or re-image the host.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="MBR_Modification" OR event_type="Boot_Sector_Write"' },
    ],
    tools: ['EDR Console', 'Forensic Toolkit'],
    escalation: 'CRITICAL. Indicates a highly destructive or persistent threat.',
  },
  {
    id: 'unusual-process-parent',
    name: 'Unusual Process Parent/Child Relationship',
    category: 'Endpoint & Malware',
    description: 'A critical system process (e.g., `svchost.exe`, `cmd.exe`) was spawned by an unusual or non-standard parent process (e.g., a browser or document reader).',
    causes: [
      'Exploitation of a vulnerability leading to unexpected process execution.',
      'Malware attempting to hide execution under a legitimate process tree.',
    ],
    actions: [
      'Step 1: **Identify Host and Processes.** Determine the host, the child process, and the suspicious parent process.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Analyze Process Tree.** Review the full process lineage to identify the root cause.',
      'Step 4: **Remediation.** Terminate the suspicious processes and re-image the host.',
    ],
    queries: [
      { tool: 'EDR', query: 'child_process="cmd.exe" AND parent_process IN ("chrome.exe", "acrobat.exe")' },
    ],
    tools: ['EDR Console', 'Process Explorer (Forensic)'],
    escalation: 'High priority. Often indicates successful initial access exploitation.',
  },
  {
    id: 'macro-execution-blocked',
    name: 'Malicious Macro Execution Blocked',
    category: 'Endpoint & Malware',
    description: 'An attempt to execute a malicious macro embedded in a document was successfully blocked by the endpoint security solution.',
    causes: [
      'User opened a malicious document (e.g., from a phishing email).',
      'Security controls successfully prevented execution.',
    ],
    actions: [
      'Step 1: **Verify Block.** Confirm the macro execution was fully blocked and no child processes were spawned.',
      'Step 2: **Identify Document.** Retrieve the document hash and file path.',
      'Step 3: **Containment (Email).** Search the Email Security Gateway (ESG) and remove the document from all other inboxes.',
      'Step 4: **User Notification.** Notify the user and provide immediate security awareness training.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="Macro_Execution" AND status="Blocked"' },
    ],
    tools: ['EDR Console', 'Email Security Gateway (ESG)'],
    escalation: 'Low/Medium. Focus on containment and user education, as the threat was mitigated.',
  },
  {
    id: 'data-staging-detected',
    name: 'Data Staging Detected (Compression/Archive)',
    category: 'Endpoint & Malware',
    description: 'Detection of a large volume of files being copied to a temporary directory and compressed into an archive format (e.g., .zip, .rar), often a precursor to data exfiltration.',
    causes: [
      'Insider threat preparing data for removal.',
      'Malware collecting data before sending it to a C2 server.',
    ],
    actions: [
      'Step 1: **Identify Host and Archive.** Determine the host and the path/name of the archive file.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Analyze Contents.** Inspect the contents of the archive to determine the sensitivity of the staged data.',
      'Step 4: **Containment.** Delete the archive file and suspend the user account if insider threat is suspected.',
      'Step 5: **Forensic Analysis.** Investigate the host for tools used for compression and exfiltration attempts.',
    ],
    queries: [
      { tool: 'EDR', query: 'process_name IN ("winrar.exe", "7z.exe") AND file_count > 100 AND file_path CONTAINS "Temp"' },
    ],
    tools: ['EDR Console', 'DLP System', 'Forensic Toolkit'],
    escalation: 'High priority. Indicates imminent data loss.',
  },
  // --- NEW CRITICAL ALERT ---
  {
    id: 'kernel-driver-load',
    name: 'Kernel Driver Load from Unusual Path',
    category: 'Endpoint & Malware',
    description: 'A new kernel driver (.sys file) was loaded from a non-standard or temporary directory, often indicating a rootkit or highly persistent malware installation.',
    causes: [
      'Attacker attempting to gain kernel-level persistence and evade EDR/AV.',
      'Malware using a vulnerable, signed driver (Bring Your Own Vulnerable Driver - BYOVD).',
    ],
    actions: [
      'Step 1: **CRITICAL ISOLATION.** Immediately isolate the affected host and prevent shutdown/reboot.',
      'Step 2: **Capture Memory.** Capture a full memory dump to analyze the loaded driver and associated processes.',
      'Step 3: **Identify Driver.** Determine the file path, hash, and digital signature of the loaded driver.',
      'Step 4: **IOC Search.** Search the environment for the driver hash and file path across all endpoints.',
      'Step 5: **Remediation.** Re-image the host immediately. If BYOVD is suspected, block the vulnerable driver hash across the environment.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="Driver_Load" AND file_path NOT IN (System32_Drivers, Approved_Paths)' },
    ],
    tools: ['EDR Console', 'Memory Forensic Tools', 'Threat Intelligence'],
    escalation: 'CRITICAL. Indicates kernel-level compromise and requires immediate IR engagement.',
  },
  // --- NEW HIGH ALERT ---
  {
    id: 'dll-sideloading',
    name: 'Suspicious DLL Sideloading Attempt',
    category: 'Endpoint & Malware',
    description: 'A legitimate, signed application loaded an unsigned or suspicious Dynamic Link Library (DLL) from an unusual path, indicating a DLL sideloading attack to execute malicious code.',
    causes: [
      'Attacker placing a malicious DLL in a search path expected by a legitimate application.',
      'Post-exploitation technique to maintain persistence and evade detection.',
    ],
    actions: [
      'Step 1: **Identify Host and DLL.** Determine the host, the legitimate application, and the malicious DLL file path/hash.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Analyze DLL.** Submit the DLL hash for sandbox analysis.',
      'Step 4: **Containment.** Delete the malicious DLL file and terminate the parent process.',
      'Step 5: **Remediation.** Re-image the host, as the initial compromise vector is unknown.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="DLL_Load" AND parent_process="[LEGIT_APP]" AND dll_path CONTAINS ("Temp", "Downloads")' },
    ],
    tools: ['EDR Console', 'Sandbox Analysis', 'Forensic Toolkit'],
    escalation: 'High priority. Indicates an active attempt to bypass security controls.',
  },

  // --- 4. Email & Phishing Alerts (Total: 13) ---
  {
    id: 'malicious-attachment',
    name: 'Malicious Attachment Detected',
    category: 'Email & Phishing',
    description: 'An email containing an attachment identified as malware (e.g., executable, macro-enabled document) was delivered to a user inbox.',
    causes: [
      'Email gateway failed to detect the malicious payload.',
      'Zero-day malware variant.',
    ],
    actions: [
      'Step 1: **Identify IOCs.** Extract the file hash and file name of the malicious attachment.',
      'Step 2: **Containment (Email).** Use the Email Security Gateway (ESG) to search for and immediately remove the email from all user inboxes.',
      'Step 3: **Check Execution.** Search EDR/SIEM logs for the file hash to see if the attachment was downloaded or executed by any user.',
      'Step 4: **Containment (Endpoint).** If execution is confirmed, immediately isolate the affected endpoint and follow the Malware playbook.',
      'Step 5: **Block Indicators.** Add the file hash and sender domain to perimeter block lists.',
      'Step 6: **User Notification.** Notify the affected user(s) and provide targeted training.',
    ],
    queries: [
      { tool: 'ESG', query: 'attachment_hash="[MALICIOUS_HASH]" AND delivery_status="Delivered"' },
      { tool: 'EDR', query: 'file_hash="[MALICIOUS_HASH]" AND event_type="Process_Creation"' },
    ],
    tools: ['Email Security Gateway (ESG)', 'EDR', 'SIEM'],
    escalation: 'Escalate if execution is confirmed or if the attachment bypassed multiple security layers.',
  },
  {
    id: 'phishing-email-detected',
    name: 'Phishing Email Detected',
    category: 'Email & Phishing',
    description: 'An email reported by a user or flagged by the system containing suspicious links, requests for credentials, or social engineering tactics.',
    causes: [
      'Targeted spear phishing campaign.',
      'Mass phishing attempt.',
      'User error in reporting (False Positive).',
    ],
    actions: [
      'Step 1: **Analyze Headers.** Review email headers to verify the true sender and origin IP.',
      'Step 2: **Containment (Email).** Immediately remove the email from all user inboxes using the ESG.',
      'Step 3: **Analyze Links/Attachments.** Sandbox any links or attachments to determine malicious intent and extract IOCs.',
      'Step 4: **Check for User Interaction.** Determine if the recipient clicked the link, opened the attachment, or replied with sensitive information.',
      'Step 5: **Remediation.** If credentials were entered, force an immediate password reset and check for signs of account compromise (Impossible Travel, mailbox rules).',
      'Step 6: **Block Indicators.** Block the sender domain, sender IP, and any malicious URLs at the perimeter.',
    ],
    queries: [
      { tool: 'ESG', query: 'subject="[PHISHING_SUBJECT]" OR sender_ip="[PHISHING_IP]"' },
    ],
    tools: ['Email Security Gateway (ESG)', 'Sandbox Analysis', 'Identity Provider'],
    escalation: 'Escalate if the email is part of a targeted campaign or if a high-privilege user interacted with it.',
  },
  {
    id: 'compromised-mailbox-detected',
    name: 'Compromised Mailbox Detected',
    category: 'Email & Phishing',
    description: 'Detection of suspicious activity within a user\'s mailbox, such as mass email sending, creation of forwarding rules, or unusual access patterns.',
    causes: [
      'Stolen credentials used by an attacker.',
      'Session token theft.',
      'Internal user abusing access.',
    ],
    actions: [
      'Step 1: **Immediate Suspension.** Immediately suspend the user account and invalidate all active sessions.',
      'Step 2: **Identify Malicious Rules.** Check the mailbox for unauthorized forwarding rules, delegation changes, or retention policy modifications and remove them.',
      'Step 3: **Audit Sent Items.** Review the Sent Items folder for unauthorized emails, especially those sent internally or containing sensitive data.',
      'Step 4: **Identify Source.** Determine the source IP and client used for the malicious access.',
      'Step 5: **Remediation.** Force a password reset, ensure MFA is enabled, and notify all recipients of the malicious emails.',
    ],
    queries: [
      { tool: 'Mail Audit Logs', query: 'operation="New-InboxRule" AND rule_name NOT IN (approved_rules)' },
    ],
    tools: ['Mail Server Audit Logs', 'Identity Provider', 'SIEM'],
    escalation: 'Escalate if the mailbox belongs to an executive or if the account was used to launch a widespread internal phishing campaign.',
  },
  {
    id: 'ceo-fraud-bec',
    name: 'CEO Fraud / Business Email Compromise (BEC)',
    category: 'Email & Phishing',
    description: 'An email impersonating an executive (CEO, CFO) requesting an urgent wire transfer, gift card purchase, or sensitive data transfer.',
    causes: [
      'Social engineering attack targeting finance or HR personnel.',
      'Compromised external vendor email account.',
    ],
    actions: [
      'Step 1: **Verify Transaction.** Immediately contact the finance/target team via phone or internal chat to halt any requested transaction.',
      'Step 2: **Containment (Email).** Remove the email from all user inboxes using the ESG.',
      'Step 3: **Analyze Headers.** Review headers to confirm the spoofing technique (e.g., display name spoofing, lookalike domain).',
      'Step 4: **User Interview.** Interview the recipient to understand their interaction and if any funds were transferred.',
      'Step 5: **Remediation.** If funds were transferred, immediately contact the bank for recall procedures. Block the sender domain/IP.',
    ],
    queries: [
      { tool: 'ESG', query: 'sender_name IN ("CEO Name", "CFO Name") AND keywords IN ("wire transfer", "urgent payment")' },
    ],
    tools: ['Email Security Gateway (ESG)', 'Finance Team', 'Communication Tools'],
    escalation: 'CRITICAL. Escalate immediately to management and legal if financial loss is involved.',
  },
  {
    id: 'mass-email-deletion',
    name: 'Mass Email Deletion by User',
    category: 'Email & Phishing',
    description: 'A user account is deleting a large volume of emails from their inbox or sent items in a short period, often indicating a compromise or cover-up attempt.',
    causes: [
      'Attacker attempting to hide malicious activity (e.g., C2 communication, phishing emails).',
      'User attempting to destroy evidence (Insider Threat).',
    ],
    actions: [
      'Step 1: **Immediate Suspension.** Immediately suspend the user account and invalidate all active sessions.',
      'Step 2: **Restore Emails.** Use mail server tools to restore the deleted emails from backup or retention archives.',
      'Step 3: **Audit Activity.** Review the restored emails and the user\'s login history for signs of compromise (Impossible Travel, new IPs).',
      'Step 4: **Forensic Analysis.** If insider threat is suspected, preserve the endpoint and mailbox for forensic review.',
      'Step 5: **Remediation.** Force a password reset and ensure MFA is enabled.',
    ],
    queries: [
      { tool: 'Mail Audit Logs', query: 'operation="HardDelete" AND item_count > 50' },
    ],
    tools: ['Mail Server Audit Logs', 'Identity Provider', 'Forensic Toolkit'],
    escalation: 'Escalate if the user is high-privilege or if the deleted emails contain evidence of a larger breach.',
  },
  {
    id: 'suspicious-mailbox-delegation',
    name: 'Suspicious Mailbox Delegation Change',
    category: 'Email & Phishing',
    description: 'A user granted delegate access or full access permissions to their mailbox to another user or external address without authorization.',
    causes: [
      'Compromised account granting access to an attacker.',
      'Insider threat setting up a monitoring mechanism.',
    ],
    actions: [
      'Step 1: **Identify Changer and Delegate.** Determine the user who made the change and the delegate recipient.',
      'Step 2: **Immediate Reversal.** Immediately remove the unauthorized delegation/access rights.',
      'Step 3: **Contact User.** Contact the mailbox owner out-of-band to verify the change.',
      'Step 4: **Audit Delegate Activity.** Review the delegate\'s access logs for any unauthorized reading or sending of emails.',
      'Step 5: **Remediation.** If unauthorized, force a password reset for the mailbox owner and investigate the changer account.',
    ],
    queries: [
      { tool: 'Mail Audit Logs', query: 'operation IN ("Add-MailboxPermission", "Add-RecipientPermission") AND delegate_user NOT IN (approved_list)' },
    ],
    tools: ['Mail Server Audit Logs', 'Identity Provider'],
    escalation: 'Escalate if the mailbox belongs to an executive or legal team member.',
  },
  {
    id: 'impersonation-internal',
    name: 'Internal Impersonation Detected',
    category: 'Email & Phishing',
    description: 'An email was sent internally impersonating another employee (not an executive) to request sensitive information or action.',
    causes: [
      'Compromised internal account used for phishing.',
      'Display name spoofing targeting internal users.',
    ],
    actions: [
      'Step 1: **Identify Sender and Recipient.** Determine the true sender IP and the impersonated user.',
      'Step 2: **Containment (Email).** Remove the email from all user inboxes.',
      'Step 3: **Contact Impersonated User.** Contact the legitimate user out-of-band to check if their account is compromised.',
      'Step 4: **User Interview.** Interview the recipient to see if they complied with the request.',
      'Step 5: **Remediation.** If the impersonated account is compromised, follow the Compromised Mailbox playbook.',
    ],
    queries: [
      { tool: 'ESG', query: 'sender_display_name="[IMPERSONATED_NAME]" AND sender_address != "[IMPERSONATED_EMAIL]"' },
    ],
    tools: ['Email Security Gateway (ESG)', 'Mail Audit Logs'],
    escalation: 'Escalate if the impersonated user is high-privilege or if the request was fulfilled.',
  },
  {
    id: 'credential-harvesting-link',
    name: 'User Clicked Credential Harvesting Link',
    category: 'Email & Phishing',
    description: 'A user clicked on a link within a phishing email that leads to a known credential harvesting site (e.g., fake login page).',
    causes: [
      'Successful social engineering attack.',
      'User failed to identify the phishing attempt.',
    ],
    actions: [
      'Step 1: **Identify User and Link.** Determine the user and the malicious URL.',
      'Step 2: **Check for Submission.** Immediately check proxy/network logs to see if the user submitted credentials to the site.',
      'Step 3: **Immediate Suspension.** If credentials were submitted, immediately suspend the user account.',
      'Step 4: **Remediation.** Force a password reset for the user and all accounts sharing that password. Check for signs of compromise.',
      'Step 5: **User Training.** Provide mandatory, immediate security awareness training to the user.',
    ],
    queries: [
      { tool: 'Proxy Logs', query: 'url IN (Phishing_IOC_List) AND user="[USER]"' },
    ],
    tools: ['Web Proxy Logs', 'Identity Provider', 'Communication Tools'],
    escalation: 'High priority if credentials were submitted.',
  },
  {
    id: 'new-external-forwarding-rule',
    name: 'New External Forwarding Rule Created',
    category: 'Email & Phishing',
    description: 'A new mailbox rule was created to automatically forward emails to an external, non-corporate email address.',
    causes: [
      'Compromised account setting up a data exfiltration channel.',
      'Insider threat preparing to leave the organization.',
    ],
    actions: [
      'Step 1: **Identify User and Destination.** Determine the user and the external forwarding address.',
      'Step 2: **Immediate Reversal.** Immediately delete the unauthorized forwarding rule.',
      'Step 3: **Audit Activity.** Review the user\'s login history and recent activity for signs of compromise.',
      'Step 4: **Containment.** If unauthorized, suspend the user account and force a password reset.',
      'Step 5: **Scope Assessment.** Determine if any sensitive emails were forwarded before detection.',
    ],
    queries: [
      { tool: 'Mail Audit Logs', query: 'operation="New-InboxRule" AND destination_address NOT IN (internal_domains)' },
    ],
    tools: ['Mail Server Audit Logs', 'DLP System'],
    escalation: 'High priority. Indicates potential data loss.',
  },
  {
    id: 'high-volume-outbound-email',
    name: 'High Volume Outbound Email from Single User',
    category: 'Email & Phishing',
    description: 'A single user account is sending an unusually high volume of external emails, often indicating a spam campaign or data exfiltration attempt.',
    causes: [
      'Compromised account being used as a spam relay.',
      'Insider threat attempting to exfiltrate data via email attachments.',
    ],
    actions: [
      'Step 1: **Identify User and Volume.** Determine the user and the volume of emails sent.',
      'Step 2: **Immediate Suspension.** Immediately suspend the user account\'s sending ability.',
      'Step 3: **Audit Sent Items.** Review the content and recipients of the outbound emails.',
      'Step 4: **Remediation.** If malicious, force a password reset and check for signs of compromise. If spam, clean the account and notify recipients.',
    ],
    queries: [
      { tool: 'ESG', query: 'sender="[USER]" AND outbound_count > 500 | bucket span=1h' },
    ],
    tools: ['Email Security Gateway (ESG)', 'Mail Audit Logs'],
    escalation: 'Escalate if the emails contain sensitive data or are part of a widespread spam campaign.',
  },
  {
    id: 'spoofed-domain-detected',
    name: 'Inbound Email Failed DMARC/SPF/DKIM',
    category: 'Email & Phishing',
    description: 'An inbound email claiming to be from a trusted external partner or vendor failed critical email authentication checks (DMARC, SPF, DKIM).',
    causes: [
      'Attacker spoofing a trusted domain.',
      'Misconfigured legitimate sender (False Positive).',
    ],
    actions: [
      'Step 1: **Analyze Headers.** Review the authentication results (DMARC/SPF/DKIM) to confirm failure.',
      'Step 2: **Containment (Email).** Remove the email from all user inboxes.',
      'Step 3: **Contact Partner.** Contact the legitimate external partner via an out-of-band method to notify them of the spoofing.',
      'Step 4: **Block Indicators.** Block the sender IP if it is not the legitimate mail server.',
    ],
    queries: [
      { tool: 'ESG', query: 'dmarc_result="fail" OR spf_result="fail" AND sender_domain="[TRUSTED_DOMAIN]"' },
    ],
    tools: ['Email Security Gateway (ESG)', 'Communication Tools'],
    escalation: 'Escalate if the spoofed domain is high-value (e.g., a bank or major vendor).',
  },
  {
    id: 'reply-chain-hijack',
    name: 'Reply Chain Hijack Detected',
    category: 'Email & Phishing',
    description: 'A malicious email was inserted into an existing, legitimate email conversation thread, often using a compromised external account.',
    causes: [
      'Compromise of an external partner\'s email account.',
      'Attacker attempting to leverage trust within an ongoing discussion.',
    ],
    actions: [
      'Step 1: **Identify Malicious Email.** Determine the specific email that contained the malicious link/attachment/request.',
      'Step 2: **Containment (Email).** Remove the malicious email from all inboxes.',
      'Step 3: **Contact Participants.** Notify all participants in the thread that the conversation was compromised.',
      'Step 4: **Block Indicators.** Block the sender IP and domain (if external) and notify the external partner of their compromise.',
    ],
    queries: [
      { tool: 'ESG', query: 'subject CONTAINS "RE:" AND attachment_hash IN (Malicious_IOCs)' },
    ],
    tools: ['Email Security Gateway (ESG)', 'Communication Tools'],
    escalation: 'High priority, as it leverages high trust levels.',
  },
  // --- NEW HIGH ALERT ---
  {
    id: 'vishing-reported',
    name: 'Vishing/Voice Phishing Attempt Reported',
    category: 'Email & Phishing',
    description: 'A user reported receiving a suspicious phone call (vishing) attempting to trick them into providing credentials, MFA codes, or installing remote access software.',
    causes: [
      'Social engineering attack targeting employees.',
      'Attacker using publicly available employee information.',
    ],
    actions: [
      'Step 1: **User Interview.** Immediately interview the user to gather details: phone number, caller ID, specific requests made, and if any information was provided.',
      'Step 2: **Check Logs.** Review the user\'s login and MFA logs for any concurrent suspicious activity during the time of the call.',
      'Step 3: **Containment.** If credentials or MFA codes were provided, immediately suspend the account and force a password reset.',
      'Step 4: **Block Indicators.** If a phone number is known, add it to internal block lists and notify the telecom provider.',
      'Step 5: **User Awareness.** Use the incident details to update security awareness training for all employees.',
    ],
    queries: [
      { tool: 'Communication Tools', query: 'search user="[USER]" AND keywords IN ("vishing", "phone scam")' },
    ],
    tools: ['Communication Tools', 'Identity Provider', 'Security Awareness Platform'],
    escalation: 'Escalate if the attacker successfully obtained credentials or if the target was a high-privilege user.',
  },

  // --- 5. Cloud Security Alerts (Total: 17) ---
  {
    id: 'unusual-cloud-api-calls',
    name: 'Unusual Cloud API Calls',
    category: 'Cloud Security',
    description: 'A user or service role is making API calls that are highly unusual for their baseline behavior (e.g., creating keys, modifying security groups, accessing resources in a new region).',
    causes: [
      'Compromised cloud credentials/access key.',
      'Insider threat abusing legitimate access.',
      'New automation script deployed without baseline update (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Identity.** Determine the IAM user or role making the suspicious calls and the source IP.',
      'Step 2: **Containment.** If unauthorized, immediately revoke the session token or access key used for the calls.',
      'Step 3: **Verify Legitimacy.** Contact the owner of the identity out-of-band to verify the activity. Check change management records.',
      'Step 4: **Audit Changes.** Review the specific API calls made (e.g., `CreateUser`, `AuthorizeSecurityGroupIngress`) and revert any unauthorized changes.',
      'Step 5: **Remediation.** If compromised, force a password rotation for the user and delete/rotate the compromised access key.',
    ],
    queries: [
      { tool: 'CloudTrail/Activity Log', query: 'eventName IN ("CreateAccessKey", "RunInstances") AND userAgent NOT IN ("Approved_Automation")' },
    ],
    tools: ['Cloud Provider Console (IAM)', 'Cloud Audit Logs', 'SIEM'],
    escalation: 'Escalate if the activity involves creating new administrative users or modifying network security to allow external access.',
  },
  {
    id: 'public-s3-bucket-exposure',
    name: 'Public S3 Bucket Exposure',
    category: 'Cloud Security',
    description: 'Detection of a cloud storage bucket configured for public read or write access, potentially exposing sensitive data.',
    causes: [
      'Misconfiguration during deployment (e.g., "Everyone" access granted).',
      'Automated script error or manual oversight.',
      'Lack of continuous cloud security posture management (CSPM).',
    ],
    actions: [
      'Step 1: **Verify Public Access.** Immediately confirm the public access status of the identified bucket using the cloud provider console.',
      'Step 2: **Containment.** Change the bucket policy immediately to restrict access to internal users only (or specific roles/IPs).',
      'Step 3: **Scope Assessment.** Determine what data was stored in the bucket and if it contained sensitive information (PII, IP).',
      'Step 4: **Audit Logs.** Review cloud access logs for the bucket to identify any unauthorized external access or downloads during the exposure window.',
      'Step 5: **Remediation.** If sensitive data was exposed, follow data breach notification procedures.',
      'Step 6: **Preventative Action.** Update Infrastructure as Code (IaC) templates and enforce CSPM policies to prevent recurrence.',
    ],
    queries: [
      { tool: 'AWS CloudTrail', query: 'eventName=PutBucketAcl AND requestParameters.acl="public-read"' },
      { tool: 'CSPM Tool', query: 'search resource_type="s3_bucket" AND public_access="true"' },
    ],
    tools: ['Cloud Provider Console (IAM/Storage)', 'CSPM Tool', 'Cloud Access Logs'],
    escalation: 'Escalate immediately if PII, financial data, or critical intellectual property was exposed.',
  },
  {
    id: 'new-root-user-login',
    name: 'New Root User Login',
    category: 'Cloud Security',
    description: 'A successful login by the cloud provider\'s root account, which should rarely, if ever, be used.',
    causes: [
      'Unauthorized access to the most privileged account.',
      'Legitimate, but unapproved, maintenance activity.',
    ],
    actions: [
      'Step 1: **Immediate Suspension.** Immediately invalidate the root user session and rotate the root user password and access keys.',
      'Step 2: **Identify Source.** Determine the source IP and user agent of the login.',
      'Step 3: **Verify Legitimacy.** Contact the designated owner of the root account out-of-band to verify the activity.',
      'Step 4: **Audit Activity.** Review all API calls made by the root user during the session for unauthorized changes (e.g., creating new IAM users, modifying billing).',
      'Step 5: **Remediation.** Ensure the root account is protected by strong MFA (preferably hardware) and stored securely. Document the policy violation.',
    ],
    queries: [
      { tool: 'CloudTrail/Activity Log', query: 'userIdentity.type="Root" AND eventName="ConsoleLogin" AND responseElements.ConsoleLogin="Success"' },
    ],
    tools: ['Cloud Provider Console (IAM)', 'Cloud Audit Logs'],
    escalation: 'CRITICAL. Escalate immediately. Root account compromise is the highest risk cloud incident.',
  },
  {
    id: 'iam-policy-modification',
    name: 'IAM Policy Modification (Granting Broad Access)',
    category: 'Cloud Security',
    description: 'A change was made to an IAM policy that grants overly permissive access (e.g., `*` resource or `Allow: *` action) to a user or role.',
    causes: [
      'Compromised account attempting to gain broad access.',
      'Developer error during deployment.',
    ],
    actions: [
      'Step 1: **Identify Policy and Changer.** Determine the policy name, the user/role affected, and the identity that made the change.',
      'Step 2: **Immediate Reversal.** Immediately revert the IAM policy to its previous, secure version.',
      'Step 3: **Audit Activity.** Review the activity of the identity that made the change for signs of compromise.',
      'Step 4: **Check for Exploitation.** Search logs for the affected user/role attempting to use the newly granted broad permissions.',
      'Step 5: **Remediation.** Enforce policy checks (e.g., SCPs, Guardrails) to prevent future broad policy deployments.',
    ],
    queries: [
      { tool: 'Cloud Audit Logs', query: 'eventName="PutRolePolicy" AND requestParameters.policyText CONTAINS "*:*" AND user NOT IN (approved_automation)' },
    ],
    tools: ['Cloud Provider Console (IAM)', 'Cloud Audit Logs', 'CSPM Tool'],
    escalation: 'High priority. Escalate if the change was unauthorized and the affected identity is high-risk.',
  },
  {
    id: 'unusual-resource-deletion',
    name: 'Unusual Resource Deletion Activity',
    category: 'Cloud Security',
    description: 'A user or service account is deleting critical cloud resources (e.g., databases, virtual machines, backups) outside of normal maintenance windows.',
    causes: [
      'Attacker performing destructive actions (e.g., ransomware follow-up).',
      'Insider threat attempting sabotage.',
      'Misconfigured automation script (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Identity and Resource.** Determine the identity performing the deletion and the resources targeted.',
      'Step 2: **Containment.** Immediately revoke the credentials/access key of the identity performing the deletion.',
      'Step 3: **Verify Legitimacy.** Check change management for approved maintenance.',
      'Step 4: **Restore Resources.** Initiate recovery procedures for deleted resources from backups.',
      'Step 5: **Forensic Analysis.** Investigate the identity for compromise or malicious intent.',
    ],
    queries: [
      { tool: 'Cloud Audit Logs', query: 'eventName IN ("DeleteDBInstance", "TerminateInstances") AND time_of_day NOT IN (maintenance_window)' },
    ],
    tools: ['Cloud Audit Logs', 'Cloud Console', 'Backup Management'],
    escalation: 'CRITICAL. Escalate immediately to IR and management.',
  },
  {
    id: 'cloud-metadata-access',
    name: 'Cloud Instance Metadata Service Access',
    category: 'Cloud Security',
    description: 'Detection of a process or application accessing the cloud instance metadata service (IMDS) to retrieve sensitive information like temporary credentials, often indicating SSRF or container escape.',
    causes: [
      'Vulnerable application exploited via Server-Side Request Forgery (SSRF).',
      'Container escape allowing access to the host metadata.',
    ],
    actions: [
      'Step 1: **Identify Instance and Process.** Determine the cloud instance and the process making the IMDS request.',
      'Step 2: **Immediate Isolation.** Isolate the affected cloud instance/container.',
      'Step 3: **Revoke Credentials.** If temporary credentials were retrieved, immediately revoke them.',
      'Step 4: **Analyze Application.** Review the application logs and code for SSRF vulnerabilities.',
      'Step 5: **Mitigation.** Enforce IMDSv2 (token-based access) to prevent unauthorized access.',
    ],
    queries: [
      { tool: 'Network/Host Logs', query: 'dest_ip="169.254.169.254" AND request_method="GET"' },
    ],
    tools: ['Cloud Console', 'Network Logs', 'Application Logs'],
    escalation: 'High priority. Escalate if temporary credentials were successfully retrieved and used.',
  },
  {
    id: 'new-vm-in-unusual-region',
    name: 'New VM Deployed in Unusual Region',
    category: 'Cloud Security',
    description: 'Deployment of a new virtual machine instance in a cloud region not typically used by the organization, often indicating attacker staging or resource abuse.',
    causes: [
      'Compromised credentials used to spin up resources for malicious purposes (e.g., crypto mining, C2).',
      'Misconfigured Infrastructure as Code (IaC) template (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Identity and Region.** Determine the identity that deployed the VM and the unusual region.',
      'Step 2: **Immediate Termination.** Immediately terminate the unauthorized VM instance.',
      'Step 3: **Audit Activity.** Review all activity of the deploying identity for signs of compromise.',
      'Step 4: **Remediation.** If compromised, revoke the credentials and enforce region restrictions via organizational policies (e.g., SCPs).',
    ],
    queries: [
      { tool: 'Cloud Audit Logs', query: 'eventName="RunInstances" AND region NOT IN (approved_regions)' },
    ],
    tools: ['Cloud Provider Console', 'Cloud Audit Logs'],
    escalation: 'High priority. Indicates resource abuse and potential billing fraud.',
  },
  {
    id: 'cloud-storage-anonymous-upload',
    name: 'Anonymous Upload to Cloud Storage',
    category: 'Cloud Security',
    description: 'An anonymous or unauthenticated user successfully uploaded a file to a cloud storage bucket, indicating a misconfigured policy allowing public write access.',
    causes: [
      'Misconfigured bucket policy allowing `s3:PutObject` for `*` principal.',
      'Automated script error.',
    ],
    actions: [
      'Step 1: **Verify Access.** Confirm the public write access status of the bucket.',
      'Step 2: **Immediate Containment.** Change the bucket policy immediately to deny public write access.',
      'Step 3: **Analyze Upload.** Review the uploaded file(s) for malicious content (e.g., malware, web shells).',
      'Step 4: **Audit Logs.** Review access logs to identify the source IP of the anonymous upload.',
      'Step 5: **Remediation.** Delete the unauthorized file(s) and enforce CSPM policies.',
    ],
    queries: [
      { tool: 'Cloud Audit Logs', query: 'eventName="PutObject" AND userIdentity.type="Anonymous"' },
    ],
    tools: ['Cloud Provider Console (Storage)', 'CSPM Tool'],
    escalation: 'High priority. Can lead to malware distribution or resource abuse.',
  },
  {
    id: 'security-group-ingress-all',
    name: 'Security Group Ingress to Anywhere (0.0.0.0/0)',
    category: 'Cloud Security',
    description: 'A security group or network access control list (NACL) was modified to allow inbound traffic from `0.0.0.0/0` (the entire internet) on a critical port (e.g., 22, 3389, 5432).',
    causes: [
      'Misconfiguration by a developer or administrator.',
      'Attacker modifying network controls for external access.',
    ],
    actions: [
      'Step 1: **Identify Change and Resource.** Determine the security group and the port exposed.',
      'Step 2: **Immediate Reversal.** Immediately revert the security group rule to restrict access to approved IPs only.',
      'Step 3: **Audit Logs.** Review network flow logs for the exposed resource to check for external connections during the exposure window.',
      'Step 4: **Investigate Changer.** Determine the identity that made the change and audit their activity.',
    ],
    queries: [
      { tool: 'Cloud Audit Logs', query: 'eventName IN ("AuthorizeSecurityGroupIngress", "UpdateNacl") AND requestParameters.cidr="0.0.0.0/0"' },
    ],
    tools: ['Cloud Provider Console (Networking)', 'Cloud Audit Logs'],
    escalation: 'CRITICAL. Exposes internal services to the internet.',
  },
  {
    id: 'api-key-exposed-github',
    name: 'Cloud API Key Exposed on GitHub',
    category: 'Cloud Security',
    description: 'A cloud provider API key (e.g., AWS Access Key, Azure Client Secret) belonging to the organization was detected in a public code repository (e.g., GitHub, GitLab).',
    causes: [
      'Developer accidentally committing secrets to public code.',
      'Compromised developer workstation.',
    ],
    actions: [
      'Step 1: **Immediate Revocation.** Immediately revoke the exposed API key in the cloud provider console.',
      'Step 2: **Audit Usage.** Review all activity performed by the key prior to revocation for signs of abuse.',
      'Step 3: **Code Remediation.** Work with the development team to remove the key from the repository history (if possible) and enforce secret scanning tools.',
      'Step 4: **User Training.** Notify the developer and provide training on secret management.',
    ],
    queries: [
      { tool: 'Threat Intelligence Platform', query: 'secret_type="AWS_Access_Key" AND repository_url CONTAINS "github.com"' },
    ],
    tools: ['Cloud Provider Console (IAM)', 'Secret Scanning Tools', 'Communication Tools'],
    escalation: 'CRITICAL. Exposed keys lead to immediate cloud compromise.',
  },
  {
    id: 'serverless-function-external-call',
    name: 'Serverless Function Unauthorized External Call',
    category: 'Cloud Security',
    description: 'A serverless function (e.g., AWS Lambda, Azure Function) made an outbound network connection to an external IP or domain not on the approved list.',
    causes: [
      'Compromised function code (e.g., dependency injection).',
      'Function being used as a proxy or C2 beacon.',
    ],
    actions: [
      'Step 1: **Identify Function and Destination.** Determine the function name and the external destination IP/domain.',
      'Step 2: **Immediate Containment.** Disable or delete the affected serverless function version.',
      'Step 3: **Analyze Code.** Review the function code and dependencies for malicious modifications.',
      'Step 4: **Remediation.** Redeploy a clean version of the function and enforce VPC/network controls to restrict outbound traffic.',
    ],
    queries: [
      { tool: 'Cloud Network Logs', query: 'src_resource="[FUNCTION_NAME]" AND dest_ip NOT IN (approved_endpoints)' },
    ],
    tools: ['Cloud Provider Console (Serverless)', 'Cloud Network Logs'],
    escalation: 'High priority. Indicates code compromise or resource abuse.',
  },
  {
    id: 'cloud-waf-rule-disabled',
    name: 'Critical Cloud WAF Rule Disabled',
    category: 'Cloud Security',
    description: 'A critical Web Application Firewall (WAF) rule or policy protecting a public-facing application was disabled or deleted without authorization.',
    causes: [
      'Attacker attempting to bypass security controls before launching an attack.',
      'Misconfigured deployment or maintenance activity (False Positive).',
    ],
    actions: [
      'Step 1: **Immediate Reversal.** Immediately re-enable the disabled WAF rule/policy.',
      'Step 2: **Identify Changer.** Determine the identity that made the change.',
      'Step 3: **Audit Application Logs.** Review application logs for exploitation attempts during the window the rule was disabled.',
      'Step 4: **Investigate Changer.** If unauthorized, suspend the changer account and audit their activity.',
    ],
    queries: [
      { tool: 'Cloud Audit Logs', query: 'eventName IN ("DeleteRule", "UpdateWebAcl") AND rule_name="[CRITICAL_RULE]"' },
    ],
    tools: ['Cloud Provider Console (WAF)', 'Cloud Audit Logs'],
    escalation: 'CRITICAL. Leaves the application vulnerable to immediate attack.',
  },
  {
    id: 'unusual-data-warehouse-query-volume',
    name: 'Unusual Data Warehouse Query Volume',
    category: 'Cloud Security',
    description: 'A user or service account executed an unusually high volume or complex type of query against a cloud data warehouse, potentially indicating data extraction.',
    causes: [
      'Insider threat attempting to extract large datasets.',
      'Compromised account running reconnaissance queries.',
    ],
    actions: [
      'Step 1: **Identify User and Query.** Determine the user and the specific queries executed.',
      'Step 2: **Immediate Suspension.** Suspend the user\'s access to the data warehouse.',
      'Step 3: **Audit Data Accessed.** Determine the sensitivity and volume of data returned by the queries.',
      'Step 4: **Verify Legitimacy.** Contact the user/manager out-of-band to verify the need for the queries.',
      'Step 5: **Remediation.** If malicious, follow the Insider Threat playbook.',
    ],
    queries: [
      { tool: 'Data Warehouse Logs', query: 'user="[USER]" AND query_count > 1000 OR data_scanned > 1TB' },
    ],
    tools: ['Data Warehouse Audit Logs', 'DLP System'],
    escalation: 'High priority. Data warehouses often hold the most sensitive data.',
  },
  {
    id: 'container-image-vulnerability',
    name: 'Container Image with Critical Vulnerability Deployed',
    category: 'Cloud Security',
    description: 'A container image containing a known critical or high-severity vulnerability was deployed to a production environment.',
    causes: [
      'Lack of continuous vulnerability scanning in the CI/CD pipeline.',
      'Emergency deployment bypassing security checks.',
    ],
    actions: [
      'Step 1: **Identify Image and Vulnerability.** Determine the image name and the specific CVE.',
      'Step 2: **Immediate Containment.** Immediately pull the vulnerable image from production and replace it with a patched version or a temporary clean image.',
      'Step 3: **Audit Deployment.** Determine who deployed the image and why security checks were bypassed.',
      'Step 4: **Remediation.** Update the CI/CD pipeline to fail builds containing critical vulnerabilities.',
    ],
    queries: [
      { tool: 'Container Security Scanner', query: 'image="[IMAGE_NAME]" AND severity="Critical" AND status="Deployed"' },
    ],
    tools: ['Container Orchestration Console', 'Vulnerability Scanner'],
    escalation: 'Escalate if the vulnerability is actively being exploited in the wild.',
  },
  // --- NEW CRITICAL ALERT ---
  {
    id: 'unauthorized-data-egress-cloud',
    name: 'Unauthorized Data Egress via Cloud Function',
    category: 'Cloud Security',
    description: 'A serverless function or container instance is observed transferring a large volume of data to an external, unapproved IP address or domain, bypassing traditional network controls.',
    causes: [
      'Compromised function code or container image.',
      'Attacker using cloud resources for data exfiltration.',
    ],
    actions: [
      'Step 1: **Identify Function and Destination.** Determine the function/resource ID and the external destination.',
      'Step 2: **Immediate Containment.** Disable or delete the affected function/resource immediately.',
      'Step 3: **Analyze Payload.** If possible, inspect the data flow to determine the sensitivity of the data being exfiltrated.',
      'Step 4: **Remediation.** Review the function code for malicious dependencies and enforce network policies (VPC/Service Endpoints) to restrict outbound traffic.',
    ],
    queries: [
      { tool: 'Cloud Network Logs', query: 'resource_type IN ("Lambda", "Container") AND bytes_out > 100MB AND dest_ip NOT IN (approved_endpoints)' },
    ],
    tools: ['Cloud Provider Console (Serverless/Networking)', 'DLP System'],
    escalation: 'CRITICAL. Confirmed data exfiltration using cloud resources.',
  },
  // --- NEW HIGH ALERT ---
  {
    id: 'cloud-storage-policy-change',
    name: 'Critical Cloud Storage Policy Change',
    category: 'Cloud Security',
    description: 'A policy governing a sensitive cloud storage bucket (e.g., containing backups or PII) was modified to reduce security controls (e.g., disabling encryption, removing MFA requirement).',
    causes: [
      'Compromised administrator account preparing for data theft or sabotage.',
      'Misconfigured automation script.',
    ],
    actions: [
      'Step 1: **Identify Changer and Policy.** Determine the identity that made the change and the specific policy modification.',
      'Step 2: **Immediate Reversal.** Immediately revert the policy change to restore security controls.',
      'Step 3: **Audit Activity.** Review all activity of the changer account immediately before and after the modification.',
      'Step 4: **Check for Follow-up.** Search logs for subsequent access attempts or data downloads on the affected bucket.',
      'Step 5: **Remediation.** If unauthorized, revoke the changer\'s credentials and enforce mandatory policy checks (e.g., bucket lock).',
    ],
    queries: [
      { tool: 'Cloud Audit Logs', query: 'eventName IN ("PutBucketPolicy", "PutBucketEncryption") AND requestParameters.status="Disabled"' },
    ],
    tools: ['Cloud Provider Console (Storage)', 'Cloud Audit Logs'],
    escalation: 'High priority. Indicates preparation for a major incident.',
  },
  // --- NEW MEDIUM ALERT ---
  {
    id: 'unused-access-key',
    name: 'Unused Access Key Older Than 90 Days',
    category: 'Cloud Security',
    description: 'An IAM access key has not been used for over 90 days, posing a risk if it is compromised and used by an attacker for persistence.',
    causes: [
      'Poor key lifecycle management.',
      'Key created for testing and forgotten.',
    ],
    actions: [
      'Step 1: **Identify Key and Owner.** Determine the key ID and the associated IAM user or service account.',
      'Step 2: **Contact Owner.** Contact the owner to verify if the key is still needed.',
      'Step 3: **Containment.** If not needed, immediately delete the access key. If needed, enforce rotation.',
      'Step 4: **Remediation.** Implement automated key rotation and deletion policies for unused keys.',
    ],
    queries: [
      { tool: 'IAM Console', query: 'AccessKeys | where LastUsedDate < 90 days AND Status="Active"' },
    ],
    tools: ['Cloud Provider Console (IAM)', 'CSPM Tool'],
    escalation: 'Medium priority. Focus on hygiene and risk reduction.',
  },

  // --- 6. Data & Insider Threat Alerts (Total: 10) ---
  {
    id: 'unauthorized-usb',
    name: 'Unauthorized USB Device Connected',
    category: 'Data & Insider Threat',
    description: 'A non-approved external storage device (USB drive) was connected to an endpoint, posing a risk of data exfiltration or malware introduction.',
    causes: [
      'Insider threat attempting to copy data.',
      'User negligence (using personal USB drive).',
      'Malware delivered via USB (e.g., BadUSB).',
    ],
    actions: [
      'Step 1: **Identify Host and User.** Determine the endpoint hostname and the logged-in user.',
      'Step 2: **Containment.** Use EDR to immediately block all read/write access to the connected USB device.',
      'Step 3: **Contact User.** Contact the user out-of-band to determine the purpose and nature of the device.',
      'Step 4: **Scan Device/Host.** If the device is unapproved, initiate a full malware scan on the host. If possible, scan the contents of the USB drive remotely.',
      'Step 5: **DLP Review.** Check DLP logs for any file copy attempts to the USB device during the connection window.',
      'Step 6: **Policy Enforcement.** If policy violation, document the incident and enforce disciplinary action/retraining.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="Device_Connection" AND device_type="USB_Storage" AND device_status="Unapproved"' },
    ],
    tools: ['EDR Console', 'DLP System', 'Asset Inventory'],
    escalation: 'Escalate if the user refuses to cooperate or if sensitive data transfer is confirmed.',
  },
  {
    id: 'privileged-user-data-access',
    name: 'Privileged User Data Access',
    category: 'Data & Insider Threat',
    description: 'A highly privileged user (e.g., system administrator) accessed a sensitive data repository (e.g., HR files, financial records) outside of their normal operational duties.',
    causes: [
      'Insider threat abusing legitimate access.',
      'Compromised privileged account.',
      'Legitimate, but undocumented, troubleshooting (False Positive).',
    ],
    actions: [
      'Step 1: **Identify User and Resource.** Determine the user, the time of access, and the specific sensitive resource accessed.',
      'Step 2: **Verify Legitimacy.** Contact the user\'s manager or the data owner out-of-band to verify if the access was authorized or necessary.',
      'Step 3: **Audit Access.** Review the full audit trail of the user\'s activity during the session, looking for data modification, deletion, or copying.',
      'Step 4: **Containment (If Malicious).** If unauthorized, immediately suspend the user\'s privileged access and investigate the account for compromise.',
      'Step 5: **Policy Enforcement.** If unauthorized but not malicious (e.g., curiosity), document the incident and initiate disciplinary action.',
    ],
    queries: [
      { tool: 'File/Share Audit Logs', query: 'user_group="Privileged_Admins" AND resource_path CONTAINS "Sensitive_Data"' },
    ],
    tools: ['File Audit Logs', 'DLP System', 'Identity Provider'],
    escalation: 'Escalate immediately if the user is confirmed to be acting maliciously or if the account is compromised.',
  },
  {
    id: 'mass-file-download',
    name: 'Mass File Download from Cloud Storage',
    category: 'Data & Insider Threat',
    description: 'A user downloaded an unusually large number of files or a high volume of data from a corporate cloud storage service (e.g., SharePoint, Google Drive).',
    causes: [
      'Insider threat preparing for departure or sabotage.',
      'Compromised account exfiltrating data.',
      'Legitimate synchronization or backup (False Positive).',
    ],
    actions: [
      'Step 1: **Identify User and Volume.** Determine the user account and the total volume/count of files downloaded.',
      'Step 2: **Containment.** Temporarily suspend the user\'s access to the cloud storage service.',
      'Step 3: **Verify Legitimacy.** Contact the user and their manager out-of-band to verify the activity.',
      'Step 4: **DLP Review.** Check DLP logs to see if the downloaded files contained sensitive tags (PII, IP).',
      'Step 5: **Remediation.** If unauthorized, perform a full forensic analysis and initiate disciplinary procedures.',
    ],
    queries: [
      { tool: 'Cloud Storage Logs', query: 'operation="Download" AND file_count > 500 OR total_size > 1GB' },
    ],
    tools: ['Cloud Storage Audit Logs', 'DLP System', 'Communication Tools'],
    escalation: 'Escalate if the user is high-risk or if sensitive data was downloaded.',
  },
  {
    id: 'printing-sensitive-documents',
    name: 'Printing of Sensitive Documents',
    category: 'Data & Insider Threat',
    description: 'A user printed a document classified as highly sensitive (e.g., financial reports, employee PII) outside of approved procedures.',
    causes: [
      'Insider threat attempting to exfiltrate data physically.',
      'User error or lack of training.',
    ],
    actions: [
      'Step 1: **Identify User and Document.** Determine the user, the printer used, and the classification of the document.',
      'Step 2: **Containment.** Temporarily suspend the user\'s printing privileges.',
      'Step 3: **Verify Legitimacy.** Contact the user and their manager to verify the need for the printout.',
      'Step 4: **DLP Review.** Review the DLP logs for the print job details.',
      'Step 5: **Remediation.** If unauthorized, document the incident and enforce policy/retraining. If malicious, engage physical security.',
    ],
    queries: [
      { tool: 'DLP/Print Logs', query: 'action="Print" AND data_classification="Highly Sensitive"' },
    ],
    tools: ['DLP System', 'Print Server Logs', 'Physical Security Team'],
    escalation: 'Escalate if the document is highly confidential or if the user is uncooperative.',
  },
  {
    id: 'unusual-database-query-volume',
    name: 'Unusual Database Query Volume',
    category: 'Data & Insider Threat',
    description: 'A user or application is executing an unusually high volume of queries or data extraction operations against a production database, potentially indicating data theft.',
    causes: [
      'Insider threat attempting to extract large amounts of data.',
      'Compromised application or SQL injection attack.',
    ],
    actions: [
      'Step 1: **Identify User and Database.** Determine the user/application and the database being queried.',
      'Step 2: **Containment.** Immediately suspend the user/application\'s access to the database.',
      'Step 3: **Audit Queries.** Review the specific queries executed and the volume of data returned.',
      'Step 4: **Remediation.** If malicious, force credential rotation and investigate the source host/application.',
    ],
    queries: [
      { tool: 'Database Audit Logs', query: 'user="[USER]" AND query_count > 10000 OR data_extracted > 1GB' },
    ],
    tools: ['Database Audit Logs', 'DLP System'],
    escalation: 'CRITICAL. Databases often hold PII and financial data.',
  },
  {
    id: 'source-code-access-unauthorized',
    name: 'Unauthorized Source Code Repository Access',
    category: 'Data & Insider Threat',
    description: 'A non-developer user or a user outside the approved team accessed a sensitive source code repository (e.g., Git, GitLab, GitHub).',
    causes: [
      'Insider threat attempting to steal intellectual property.',
      'Misconfigured access control list (ACL).',
    ],
    actions: [
      'Step 1: **Identify User and Repository.** Determine the user and the repository accessed.',
      'Step 2: **Immediate Reversal.** Immediately remove the unauthorized user\'s access rights.',
      'Step 3: **Audit Activity.** Review the user\'s activity within the repository (e.g., cloning, downloading).',
      'Step 4: **Policy Enforcement.** If unauthorized, document the incident and enforce stricter access controls.',
    ],
    queries: [
      { tool: 'Git Logs', query: 'operation="Clone" OR operation="Download" AND user NOT IN (approved_developers)' },
    ],
    tools: ['Source Code Management Logs', 'IAM Console'],
    escalation: 'High priority. Source code is critical intellectual property.',
  },
  {
    id: 'screenshot-activity-sensitive',
    name: 'Screenshot Activity on Sensitive Application',
    category: 'Data & Insider Threat',
    description: 'Detection of screen capture activity (e.g., using Snipping Tool, Print Screen) while a sensitive application (e.g., HR system, financial ledger) is open.',
    causes: [
      'Insider threat attempting to bypass DLP controls by capturing images.',
      'User documenting an error (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Host and Application.** Determine the host and the sensitive application open during the capture.',
      'Step 2: **Containment.** Isolate the host and suspend the user account.',
      'Step 3: **User Interview.** Contact the user and their manager to verify the purpose of the screenshots.',
      'Step 4: **Forensic Analysis.** Review the host for saved images or files containing sensitive data.',
    ],
    queries: [
      { tool: 'DLP/EDR', query: 'event_type="Screen_Capture" AND active_window IN ("HR_System", "Finance_App")' },
    ],
    tools: ['DLP System', 'EDR Console'],
    escalation: 'Escalate if the user is uncooperative or if sensitive data was captured.',
  },
  {
    id: 'file-access-after-termination-notice',
    name: 'File Access After Termination Notice',
    category: 'Data & Insider Threat',
    description: 'A user accessed critical or sensitive files immediately after receiving a termination or disciplinary notice.',
    causes: [
      'Disgruntled employee attempting sabotage or data theft.',
    ],
    actions: [
      'Step 1: **Immediate Suspension.** Immediately suspend all user access (network, email, cloud).',
      'Step 2: **Identify Files.** Determine the files accessed after the notice was given.',
      'Step 3: **Forensic Image.** Initiate a full forensic image of the user\'s endpoint and mailbox.',
      'Step 4: **Physical Security.** Engage physical security to escort the employee off-site if necessary.',
      'Step 5: **Legal Notification.** Notify the legal and HR teams immediately.',
    ],
    queries: [
      { tool: 'File Audit Logs', query: 'user="[USER]" AND timestamp > "[NOTICE_TIME]" AND resource_path CONTAINS "Critical_Data"' },
    ],
    tools: ['HR/Legal Team', 'Forensic Toolkit', 'IAM Console'],
    escalation: 'CRITICAL. High risk of sabotage or data theft.',
  },
  // --- NEW CRITICAL ALERT ---
  {
    id: 'mass-file-encryption-share',
    name: 'Mass File Encryption on Network Share',
    category: 'Data & Insider Threat',
    description: 'Detection of rapid, unauthorized encryption or modification of files across a shared network drive, strongly indicating active ransomware or destructive malware.',
    causes: [
      'Ransomware payload executing from a compromised endpoint with access to network shares.',
      'Insider threat attempting to destroy data.',
    ],
    actions: [
      'Step 1: **CRITICAL ISOLATION.** Immediately isolate the source host responsible for the file modifications from the network.',
      'Step 2: **Identify Scope.** Determine the extent of the damage and which shares are affected.',
      'Step 3: **Process Termination.** Use EDR to terminate the malicious process across all affected hosts.',
      'Step 4: **Snapshot/Backup.** Immediately take a snapshot of the affected shares and verify the integrity of recent backups.',
      'Step 5: **Engage IR.** Notify the Incident Response Team and management immediately.',
    ],
    queries: [
      { tool: 'File/Share Audit Logs', query: 'event_type="File_Write" AND file_extension IN (".lock", ".enc") | stats count by src_host | where count > 1000' },
    ],
    tools: ['EDR Console', 'File Server Management', 'Backup Management System'],
    escalation: 'CRITICAL. Confirmed active ransomware incident.',
  },
  // --- NEW MEDIUM ALERT ---
  {
    id: 'large-internal-file-transfer',
    name: 'Large Internal File Transfer Between Unrelated Departments',
    category: 'Data & Insider Threat',
    description: 'A large volume of data was transferred between two internal hosts belonging to departments that do not typically collaborate (e.g., HR server to Marketing workstation).',
    causes: [
      'Internal reconnaissance or data staging by a compromised account.',
      'Misconfigured synchronization tool (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Destination.** Determine the source host, destination host, and the user account involved.',
      'Step 2: **Verify Legitimacy.** Contact the user and their manager out-of-band to verify the transfer purpose.',
      'Step 3: **Audit Data.** Review the file names and types transferred for sensitivity.',
      'Step 4: **Containment (If Malicious).** If unauthorized, isolate the source host and suspend the user account.',
    ],
    queries: [
      { tool: 'NetFlow/SIEM', query: 'src_department="HR" AND dest_department="Marketing" AND traffic_volume > 500MB' },
    ],
    tools: ['NetFlow Analyzer', 'File Audit Logs', 'Communication Tools'],
    escalation: 'Escalate if sensitive data was transferred or if the user is uncooperative.',
  },

  // --- 7. Threat Intelligence & External Alerts (Total: 5) ---
  {
    id: 'c2-communication',
    name: 'Communication with C2 Server',
    category: 'Threat Intelligence & External',
    description: 'An internal host is communicating with an external IP or domain identified as a known Command and Control (C2) server by threat intelligence feeds.',
    causes: [
      'Active malware infection on the internal host.',
      'Compromised system receiving instructions from an attacker.',
    ],
    actions: [
      'Step 1: **Validate IOC.** Confirm the external IP/domain is still listed as a high-confidence C2 server in multiple threat feeds.',
      'Step 2: **Identify Source.** Determine the internal source host (IP and hostname) and the specific process initiating the connection.',
      'Step 3: **Containment.** Immediately isolate the source host from the network.',
      'Step 4: **Perimeter Block.** Block the C2 IP/domain at the firewall/proxy.',
      'Step 5: **Forensic Analysis.** Perform a deep forensic analysis on the isolated host to identify the malware, persistence, and data collected.',
      'Step 6: **IOC Search.** Search the entire environment (SIEM, EDR) for the C2 IP, domain, and any associated file hashes.',
    ],
    queries: [
      { tool: 'SIEM', query: 'index=network dest_ip="[C2_IP]" AND action="Allowed"' },
    ],
    tools: ['Threat Intelligence Platform', 'SIEM', 'EDR', 'Firewall'],
    escalation: 'High priority. Escalate immediately, as this confirms an active, post-exploitation phase.',
  },
  {
    id: 'domain-squatting-alert',
    name: 'Domain Squatting/Typosquatting Alert',
    category: 'Threat Intelligence & External',
    description: 'A newly registered domain closely resembling a corporate domain (typosquatting) was detected, often used for phishing or brand abuse.',
    causes: [
      'Threat actor preparing a phishing campaign against employees or customers.',
      'Brand protection monitoring system alert.',
    ],
    actions: [
      'Step 1: **Verify Domain.** Confirm the domain registration details and its similarity to the corporate brand.',
      'Step 2: **Analyze Content.** Check if the domain is hosting malicious content (e.g., fake login page, malware).',
      'Step 3: **Block Indicators.** Block the domain at the perimeter proxy/DNS filter to prevent internal access.',
      'Step 4: **Legal Notification.** Notify the legal and brand protection teams for potential takedown procedures.',
      'Step 5: **Proactive Search.** Search email logs for any inbound emails originating from the suspicious domain.',
    ],
    queries: [
      { tool: 'Threat Intelligence Platform', query: 'domain_name CONTAINS "corpname" AND registration_date="[RECENT]"' },
    ],
    tools: ['Threat Intelligence Platform', 'Legal Team', 'Email Security Gateway'],
    escalation: 'Escalate if the domain is actively being used for phishing or malware distribution.',
  },
  {
    id: 'new-phishing-kit-detected',
    name: 'New Phishing Kit Targeting Brand Detected',
    category: 'Threat Intelligence & External',
    description: 'Threat intelligence detected a new phishing kit or campaign specifically targeting the organization\'s brand, often hosted on the dark web or public paste sites.',
    causes: [
      'Threat actor preparing a large-scale phishing attack.',
      'Brand protection monitoring system alert.',
    ],
    actions: [
      'Step 1: **Analyze Kit.** Review the kit details (e.g., login page template, target credentials).',
      'Step 2: **Proactive Search.** Search email and network logs for any early signs of the campaign (e.g., test emails, initial link clicks).',
      'Step 3: **Legal Notification.** Notify the legal and brand protection teams for takedown procedures.',
      'Step 4: **User Awareness.** Prepare an internal communication to warn users about the specific phishing theme/template.',
    ],
    queries: [
      { tool: 'Threat Intelligence Platform', query: 'brand="[ORG_NAME]" AND type="Phishing_Kit" AND status="New"' },
    ],
    tools: ['Threat Intelligence Platform', 'Legal Team', 'Communication Tools'],
    escalation: 'Escalate if the kit is highly sophisticated or widely distributed.',
  },
  {
    id: 'vulnerability-exploit-in-wild',
    name: 'Vulnerability Exploit Detected in Wild',
    category: 'Threat Intelligence & External',
    description: 'Threat intelligence confirms active exploitation of a critical vulnerability (CVE) that is known to exist within the organization\'s environment.',
    causes: [
      'Zero-day or recently patched vulnerability being actively targeted.',
      'Lack of timely patching.',
    ],
    actions: [
      'Step 1: **Verify Exposure.** Confirm which internal assets are vulnerable to the CVE.',
      'Step 2: **Immediate Patching.** Initiate emergency patching procedures for all exposed assets.',
      'Step 3: **Proactive Search.** Search SIEM/EDR logs for IOCs associated with the exploit (e.g., specific file drops, command execution).',
      'Step 4: **Containment.** If exploitation is detected, isolate the affected host and follow the appropriate Malware/Lateral Movement playbook.',
    ],
    queries: [
      { tool: 'Vulnerability Scanner', query: 'cve="[CRITICAL_CVE]" AND status="Unpatched"' },
    ],
    tools: ['Threat Intelligence Platform', 'Vulnerability Scanner', 'Patch Management'],
    escalation: 'CRITICAL. Requires immediate, coordinated response between SOC and IT/DevOps.',
  },
  // --- NEW MEDIUM ALERT ---
  {
    id: 'internal-software-cve',
    name: 'New Vulnerability Disclosure for Internal Software',
    category: 'Threat Intelligence & External',
    description: 'A new high-severity vulnerability (CVE) was disclosed for a specific software version known to be running internally, requiring immediate assessment.',
    causes: [
      'Vendor disclosure of a critical flaw.',
      'Internal asset inventory matching a newly published CVE.',
    ],
    actions: [
      'Step 1: **Verify Exposure.** Use the vulnerability scanner and asset inventory to confirm all instances of the vulnerable software.',
      'Step 2: **Assess Risk.** Determine if the vulnerability is remotely exploitable and if public exploit code exists.',
      'Step 3: **Mitigation.** If immediate patching is not possible, apply compensating controls (e.g., WAF rules, network segmentation) to reduce exposure.',
      'Step 4: **Patch Planning.** Coordinate with IT/DevOps to schedule emergency patching or upgrade procedures.',
    ],
    queries: [
      { tool: 'Vulnerability Scanner', query: 'software_name="[SOFTWARE]" AND cve_severity="High"' },
    ],
    tools: ['Vulnerability Scanner', 'Asset Inventory', 'Patch Management'],
    escalation: 'Escalate if the vulnerability is actively exploited in the wild or affects critical infrastructure.',
  },

  // --- 8. SIEM & System Alerts (Total: 4) ---
  {
    id: 'detection-rule-modified',
    name: 'Detection Rule Modified or Disabled',
    category: 'SIEM & System Alerts',
    description: 'A critical security detection rule (e.g., in SIEM, EDR, or Firewall) was modified, deleted, or disabled, potentially blinding the security team.',
    causes: [
      'Malicious actor attempting to cover their tracks (Attack on Logging).',
      'Unauthorized administrative action.',
      'Legitimate maintenance or tuning without proper change control (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Change.** Determine the specific rule modified, the user/account that made the change, and the time.',
      'Step 2: **Revert Change.** Immediately revert the rule to its previous, secure state.',
      'Step 3: **Verify Change Control.** Check the change management system for an approved ticket.',
      'Step 4: **Audit Activity.** If unauthorized, review the activity of the user/account that made the change immediately before and after the modification for signs of compromise.',
      'Step 5: **Backfill Logs.** If the rule was disabled for a period, ensure logs for that period are reviewed manually for missed threats.',
    ],
    queries: [
      { tool: 'SIEM Audit Logs', query: 'operation="Rule_Modification" OR operation="Rule_Deletion" AND rule_name="[CRITICAL_RULE]"' },
    ],
    tools: ['SIEM Audit Logs', 'Change Management System', 'Identity Provider'],
    escalation: 'Escalate if the change was unauthorized and performed by a compromised account.',
  },
  {
    id: 'log-source-failure',
    name: 'Log Source Failure/Data Loss Detected',
    category: 'SIEM & System Alerts',
    description: 'A critical log source (e.g., Domain Controller, Firewall, EDR) stopped sending data to the SIEM, creating a blind spot.',
    causes: [
      'Attacker disabling logging to evade detection.',
      'Network connectivity issue or log forwarder failure.',
      'System maintenance (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Time.** Determine the specific log source and the time logging ceased.',
      'Step 2: **Verify Legitimacy.** Check change management for approved maintenance on the source.',
      'Step 3: **Restore Logging.** Attempt to remotely restart the log forwarder service or fix the network connection.',
      'Step 4: **Audit Source.** If logging was intentionally disabled, investigate the source system for signs of compromise during the blind period.',
      'Step 5: **Backfill Logs.** If possible, retrieve and ingest the missed logs manually.',
    ],
    queries: [
      { tool: 'SIEM Health Monitor', query: 'log_source="[CRITICAL_SOURCE]" AND status="Down"' },
    ],
    tools: ['SIEM Health Monitor', 'System Administration Tools', 'Change Management System'],
    escalation: 'CRITICAL. Escalate immediately if the source is a Domain Controller or core security device.',
  },
  {
    id: 'time-drift-critical-server',
    name: 'Time Drift Detected on Critical Server',
    category: 'SIEM & System Alerts',
    description: 'Significant time drift detected on a critical server (e.g., Domain Controller, database server), which can disrupt Kerberos authentication and log correlation.',
    causes: [
      'Attacker tampering with system time to evade time-based detections.',
      'Hardware clock failure or NTP synchronization issue.',
    ],
    actions: [
      'Step 1: **Verify Drift.** Confirm the magnitude of the time drift.',
      'Step 2: **Immediate Correction.** Immediately synchronize the server time with the authoritative NTP source.',
      'Step 3: **Audit Logs.** Review system logs for unauthorized time modification attempts (Event ID 4616).',
      'Step 4: **Check Authentication.** Monitor Kerberos and other time-sensitive authentication logs for immediate failures/successes after correction.',
    ],
    queries: [
      { tool: 'System Monitor', query: 'hostname="[CRITICAL_SERVER]" AND time_drift > 5 minutes' },
    ],
    tools: ['System Administration Tools', 'SIEM'],
    escalation: 'High priority if tampering is suspected or if authentication is failing.',
  },
  // --- NEW MEDIUM ALERT ---
  {
    id: 'high-system-errors',
    name: 'High Rate of Non-Critical System Errors',
    category: 'SIEM & System Alerts',
    description: 'A sudden spike in non-critical system errors (e.g., application crashes, failed service restarts) across multiple endpoints, potentially indicating a widespread software conflict or pre-attack reconnaissance.',
    causes: [
      'Recent software deployment or patch failure.',
      'Attacker attempting to crash or destabilize security services.',
      'Widespread system instability.',
    ],
    actions: [
      'Step 1: **Identify Common Factor.** Determine the common application or service generating the errors and the time the spike began.',
      'Step 2: **Verify Legitimacy.** Check recent change management records for related deployments.',
      'Step 3: **Analyze Logs.** Review detailed logs on a sample of affected hosts for signs of malicious process activity preceding the errors.',
      'Step 4: **Mitigation.** If benign, roll back the recent change. If malicious, isolate affected hosts and follow the appropriate malware playbook.',
    ],
    queries: [
      { tool: 'SIEM', query: 'event_level="Error" AND event_id IN (1000, 1001) | stats count by hostname | where count > 50' },
    ],
    tools: ['SIEM/Log Analytics', 'System Administration Tools', 'Change Management System'],
    escalation: 'Escalate if the errors are impacting critical business applications or security services.',
  },

  // --- 9. Incident Response / Automation Triggers (Total: 3) ---
  {
    id: 'automated-containment-triggered',
    name: 'Automated Containment Triggered',
    category: 'Incident Response / Automation Triggers',
    description: 'A Security Orchestration, Automation, and Response (SOAR) playbook successfully executed an automated containment action (e.g., host isolation, account suspension).',
    causes: [
      'High-confidence alert triggered the SOAR playbook.',
      'Misconfigured SOAR rule leading to unnecessary containment (False Positive).',
    ],
    actions: [
      'Step 1: **Verify Trigger.** Review the original alert that triggered the automation (e.g., Ransomware Behavior, C2 Communication).',
      'Step 2: **Confirm Containment.** Verify that the automated action (e.g., host isolation) was successful and complete.',
      'Step 3: **Manual Triage.** Perform manual triage on the contained asset to confirm the threat and prevent false positives from escalating.',
      'Step 4: **Proceed with Playbook.** If confirmed malicious, continue with the manual steps of the original alert\'s playbook (e.g., forensic analysis, eradication).',
      'Step 5: **Document and Tune.** Document the success/failure of the automation and tune the SOAR rule if necessary.',
    ],
    queries: [
      { tool: 'SOAR Logs', query: 'playbook_name="Containment_Host_Isolation" AND status="Success"' },
    ],
    tools: ['SOAR Platform', 'SIEM', 'EDR Console'],
    escalation: 'Escalate if the automated containment failed or if the contained asset is a critical production system.',
  },
  {
    id: 'quarantine-bypass-attempt',
    name: 'Quarantine Bypass Attempt',
    category: 'Incident Response / Automation Triggers',
    description: 'A host or user attempted to bypass or disable an automated containment measure (e.g., re-enabling network access after isolation, restoring a quarantined file).',
    causes: [
      'Attacker actively fighting containment measures.',
      'User attempting to restore a legitimate file (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Action.** Determine the host/user and the specific containment measure being bypassed.',
      'Step 2: **Re-enforce Containment.** Immediately re-apply the containment measure (e.g., re-isolate the host, re-suspend the account).',
      'Step 3: **Manual Intervention.** Switch to manual containment methods that are harder to bypass (e.g., physical network disconnect).',
      'Step 4: **Forensic Analysis.** Investigate the host for tools or scripts used to bypass the security controls.',
      'Step 5: **Remediation.** If malicious, re-image the host and investigate the user account for compromise.',
    ],
    queries: [
      { tool: 'EDR/SOAR Logs', query: 'event_type="Containment_Failure" OR event_type="Network_Rejoin_Attempt"' },
    ],
    tools: ['EDR Console', 'SOAR Platform', 'Network Administration Tools'],
    escalation: 'CRITICAL. Escalate immediately, as the attacker is actively engaged and resisting defense.',
  },
  {
    id: 'ir-team-access-granted',
    name: 'IR Team Emergency Access Granted (Break-Glass)',
    category: 'Incident Response / Automation Triggers',
    description: 'The automated "break-glass" procedure was triggered, granting elevated, temporary access to the Incident Response team or a specific administrator.',
    causes: [
      'Legitimate high-severity incident requiring immediate privileged access.',
      'Unauthorized trigger or abuse of the break-glass mechanism (False Positive/Insider Threat).',
    ],
    actions: [
      'Step 1: **Verify Authorization.** Confirm the break-glass access was authorized by the required management personnel.',
      'Step 2: **Monitor Activity.** Continuously monitor all actions taken by the break-glass account, logging all commands and access attempts.',
      'Step 3: **Time Limit.** Ensure the temporary access is automatically revoked after the defined time limit (e.g., 4 hours).',
      'Step 4: **Post-Incident Audit.** After revocation, perform a full audit of the break-glass account\'s activity to ensure no abuse occurred.',
    ],
    queries: [
      { tool: 'IAM/SOAR Logs', query: 'event_type="Break_Glass_Activation" AND user="[IR_USER]"' },
    ],
    tools: ['IAM Console', 'SOAR Platform', 'SIEM'],
    escalation: 'Escalate if the access was unauthorized or if the account performs actions outside the scope of the incident.',
  },
];

export const categories: AlertCategory[] = [
  'Authentication & Access', 
  'Network & Firewall', 
  'Endpoint & Malware', 
  'Email & Phishing', 
  'Cloud Security', 
  'Data & Insider Threat', 
  'Threat Intelligence & External', 
  'SIEM & System Alerts', 
  'Incident Response / Automation Triggers'
];
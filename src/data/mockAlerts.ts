import { AlertPlaybook, AlertCategory } from "@/types/alert";

export const mockAlerts: AlertPlaybook[] = [
  // --- 1. Authentication & Access Alerts (Total: 10) ---
  {
    id: 'brute-force',
    name: 'Brute Force Attack Detected',
    category: 'Authentication & Access',
    description: 'A high volume of failed login attempts targeting a single or multiple accounts over a short period.',
    causes: [
      'Weak passwords being targeted.',
      'Automated scripts or bots attempting credential stuffing.',
      'Misconfigured rate limiting or account lockout policies.',
    ],
    actions: [
      'Step 1: **Verify the Alert.** Confirm the volume and rate of failed logins in the SIEM/Log Analytics tool.',
      'Step 2: **Identify Targets.** Determine the source IP address(es) and the specific user account(s) being targeted.',
      'Step 3: **Check for Success.** Search logs immediately to see if any login attempts from the source IP were successful during the attack window.',
      'Step 4: **Containment (Source).** If the source IP is external and malicious, block it temporarily at the perimeter firewall or WAF.',
      'Step 5: **Containment (Account).** If a specific user account was successfully compromised, immediately disable or suspend the account.',
      'Step 6: **Mitigation.** Force a password reset for all targeted user accounts, successful or not, and enforce Multi-Factor Authentication (MFA).',
    ],
    queries: [
      { tool: 'SIEM', query: 'index=auth status=failure | stats count by src_ip, user | where count > 50 | sort -count' },
    ],
    tools: ['SIEM/Log Analytics', 'Firewall/WAF', 'Identity Provider (IdP) Management Console'],
    escalation: 'Escalate if successful login is confirmed, or if the attack source cannot be blocked and persists.',
  },
  {
    id: 'impossible-travel',
    name: 'Impossible Travel Detected',
    category: 'Authentication & Access',
    description: 'A single user successfully logging in from two geographically distant locations within an impossible time frame, strongly indicating a compromised account.',
    causes: [
      'Stolen credentials used by an attacker in a different region.',
      'VPN usage or proxy hopping (False Positive).',
    ],
    actions: [
      'Step 1: **Immediate Suspension.** Immediately suspend the user account and invalidate all active sessions.',
      'Step 2: **Contact User.** Contact the user via an out-of-band method (phone, internal chat) to verify the recent login activity.',
      'Step 3: **Analyze Login Chain.** Review the full login history for the user, noting IPs, devices, and MFA status for both suspicious logins.',
      'Step 4: **Check for Post-Login Activity.** Review logs for immediate actions taken after the second (malicious) login (e.g., mailbox rule changes, data access).',
      'Step 5: **Remediation.** If confirmed malicious, force a password reset, ensure MFA is enabled, and perform a full endpoint scan on the user\'s primary device.',
    ],
    queries: [
      { tool: 'Cloud Identity Logs', query: 'LoginEvents | where TimeDifference < 1 hour and Distance > 5000 km' },
    ],
    tools: ['Identity Provider Logs', 'Communication Tools', 'EDR'],
    escalation: 'Escalate if the account is high-privilege or if data access/modification occurred after the second login.',
  },
  {
    id: 'suspicious-admin-creation',
    name: 'Suspicious Admin Account Creation',
    category: 'Authentication & Access',
    description: 'A new administrative or highly privileged account was created outside of standard change control procedures.',
    causes: [
      'Compromised administrator account used to create a backdoor account.',
      'Misconfigured automation script.',
    ],
    actions: [
      'Step 1: **Identify Creator.** Determine the user or service account that created the new administrative account.',
      'Step 2: **Verify Change Control.** Check the change management system for an approved ticket corresponding to this creation time.',
      'Step 3: **Containment.** If unauthorized, immediately disable the newly created administrative account.',
      'Step 4: **Investigate Creator.** If the creator account was compromised, immediately suspend it and follow the Compromised Account playbook.',
      'Step 5: **Audit Permissions.** Review the permissions granted to the new account and ensure no other unauthorized changes were made to IAM policies.',
    ],
    queries: [
      { tool: 'AD/IAM Logs', query: 'EventID=4720 AND TargetUserName="*Admin*" AND CallerUserName!="Approved_Admins"' },
    ],
    tools: ['Active Directory/IAM Console', 'Change Management System', 'SIEM'],
    escalation: 'High priority. Escalate immediately if the creator account was compromised.',
  },
  {
    id: 'failed-mfa-login',
    name: 'Failed MFA Login in Cloud Console',
    category: 'Authentication & Access',
    description: 'Multiple failed attempts to satisfy the Multi-Factor Authentication requirement, often following a successful password entry, indicating an MFA bypass attempt (e.g., push bombing).',
    causes: [
      'Attacker possessing valid credentials attempting to bypass MFA.',
      'User error or device malfunction (False Positive).',
      'MFA push bombing attack.',
    ],
    actions: [
      'Step 1: **Identify User and Source.** Determine the user account and the source IP address attempting the login.',
      'Step 2: **Contact User.** Contact the user out-of-band to verify if they are currently attempting to log in and receiving MFA prompts.',
      'Step 3: **Containment.** If unauthorized, immediately block the source IP and temporarily disable the user\'s MFA method (e.g., revoke session tokens).',
      'Step 4: **Review MFA Logs.** Check the MFA provider logs for the type of failure (e.g., denied push, incorrect code).',
      'Step 5: **Remediation.** If confirmed malicious, force a password reset and enroll the user in a stronger MFA method (e.g., FIDO2 key instead of push notification).',
    ],
    queries: [
      { tool: 'Cloud Identity Logs', query: 'LoginEvents | where ResultType == 500121 and FailureReason contains "MFA"' },
    ],
    tools: ['Identity Provider Logs', 'MFA Management Console', 'Communication Tools'],
    escalation: 'Escalate if the targeted user is high-privilege or if the attack persists after initial containment.',
  },
  {
    id: 'successful-login-new-location',
    name: 'Successful Login from New Location',
    category: 'Authentication & Access',
    description: 'A user successfully logged in from a geographic location or network segment never before seen for that account.',
    causes: [
      'User traveling or working remotely (False Positive).',
      'Compromised credentials used by an attacker.',
      'New VPN endpoint or proxy usage.',
    ],
    actions: [
      'Step 1: **Verify Location.** Check the geolocation data for the new IP address.',
      'Step 2: **Contact User.** Contact the user out-of-band to confirm if they initiated the login from that location.',
      'Step 3: **Check Device/Agent Health.** If the login is confirmed, ensure the endpoint security agent is healthy and running.',
      'Step 4: **Containment (If Malicious).** If unauthorized, immediately suspend the account, invalidate the session, and force a password reset.',
      'Step 5: **Audit Activity.** Review post-login activity (e.g., file access, email forwarding rules) for signs of compromise.',
    ],
    queries: [
      { tool: 'Identity Logs', query: 'LoginEvents | where user="[USER]" and geo_location NOT IN (baseline_locations)' },
    ],
    tools: ['Identity Provider Logs', 'Communication Tools', 'GeoIP Database'],
    escalation: 'Escalate if the user cannot be reached or if post-login malicious activity is detected.',
  },
  {
    id: 'account-lockout-storm',
    name: 'Account Lockout Storm',
    category: 'Authentication & Access',
    description: 'A large number of user accounts are being locked out simultaneously or in rapid succession, often indicating a password spray attack or misconfigured service.',
    causes: [
      'Password spray attack targeting many users with common passwords.',
      'Misconfigured service account attempting to authenticate with an expired password.',
      'Internal network issue causing authentication failures.',
    ],
    actions: [
      'Step 1: **Identify Source.** Determine the source IP address(es) causing the lockouts.',
      'Step 2: **Containment (Source).** Block the source IP at the firewall/NAC if external and malicious.',
      'Step 3: **Check Service Accounts.** If the source is internal, check if a service account is involved and temporarily disable it if necessary.',
      'Step 4: **Analyze Password Attempts.** Review logs for the password being used in the failed attempts to confirm a spray attack.',
      'Step 5: **Remediation.** If a spray attack is confirmed, force password resets for all targeted accounts and review password policies.',
    ],
    queries: [
      { tool: 'AD/IAM Logs', query: 'EventID=4740 | stats count by src_ip, user | where count > 100' },
    ],
    tools: ['Active Directory/IAM Console', 'SIEM', 'Firewall/NAC'],
    escalation: 'Escalate if the lockout storm impacts critical business functions or if the source cannot be contained.',
  },
  {
    id: 'credential-dumping-attempt',
    name: 'Credential Dumping Attempt',
    category: 'Authentication & Access',
    description: 'Detection of tools or processes (e.g., Mimikatz, LSASS access) attempting to extract credentials from memory or local storage on an endpoint.',
    causes: [
      'Post-exploitation activity by an attacker who has gained initial access.',
      'Malware attempting to harvest credentials for lateral movement.',
    ],
    actions: [
      'Step 1: **Immediate Isolation.** Immediately isolate the affected host from the network.',
      'Step 2: **Identify Process.** Determine the process name and command line arguments used for the dumping attempt.',
      'Step 3: **Capture Memory.** Capture a memory dump of the host for forensic analysis.',
      'Step 4: **Check for Lateral Movement.** Search logs for the compromised user account attempting to log into other systems immediately after the dump attempt.',
      'Step 5: **Remediation.** Force a password reset for the logged-in user and re-image the host.',
    ],
    queries: [
      { tool: 'EDR', query: 'process_name="lsass.exe" AND access_type="Read_Memory" AND caller_process NOT IN (approved_list)' },
    ],
    tools: ['EDR Console', 'Memory Forensic Tools', 'SIEM'],
    escalation: 'High priority. Escalate if the attempt was successful and lateral movement is detected.',
  },
  {
    id: 'suspicious-login-tor',
    name: 'Suspicious Login from Tor/VPN Exit Node',
    category: 'Authentication & Access',
    description: 'A successful login originating from a known high-risk IP address associated with Tor, public VPN exit nodes, or known malicious proxies.',
    causes: [
      'Attacker masking their true location using anonymity services.',
      'User legitimately using a VPN (False Positive).',
    ],
    actions: [
      'Step 1: **Verify Source.** Confirm the source IP is listed on a high-risk threat intelligence feed.',
      'Step 2: **Immediate Suspension.** Immediately suspend the user account and invalidate the session.',
      'Step 3: **Contact User.** Contact the user out-of-band to verify if they initiated the login.',
      'Step 4: **Audit Activity.** Review all activity performed during the suspicious session (e.g., data access, configuration changes).',
      'Step 5: **Remediation.** If malicious, force a password reset and ensure MFA is enforced. Block the source IP at the perimeter.',
    ],
    queries: [
      { tool: 'Identity Logs', query: 'LoginEvents | where geo_ip IN (Tor_Exit_Nodes)' },
    ],
    tools: ['Identity Provider Logs', 'Threat Intelligence Feeds', 'Communication Tools'],
    escalation: 'Escalate if the user is high-privilege or if unauthorized activity occurred.',
  },
  {
    id: 'privilege-escalation',
    name: 'Privilege Escalation Detected',
    category: 'Authentication & Access',
    description: 'A standard user account successfully gained administrative or system-level privileges on an endpoint or server.',
    causes: [
      'Exploitation of a local vulnerability (e.g., kernel bug, misconfigured service).',
      'Misconfigured system permissions allowing unauthorized privilege changes.',
    ],
    actions: [
      'Step 1: **Identify Host and User.** Determine the host and the user account that escalated privileges.',
      'Step 2: **Immediate Isolation.** Isolate the affected host from the network.',
      'Step 3: **Analyze Method.** Determine the exact method or tool used for the escalation (e.g., specific exploit, system utility).',
      'Step 4: **Check for Follow-up.** Review logs for immediate post-escalation activity (e.g., lateral movement, credential dumping).',
      'Step 5: **Remediation.** Revert the privilege change, patch the vulnerability, and re-image the host.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="Privilege_Change" AND new_privilege="System" AND old_privilege="User"' },
    ],
    tools: ['EDR Console', 'Vulnerability Scanner', 'Patch Management'],
    escalation: 'High priority. Escalate if the host is critical or if the escalation was successful.',
  },
  {
    id: 'new-user-high-privilege-group',
    name: 'New User Added to High-Privilege Group',
    category: 'Authentication & Access',
    description: 'A user account was added to a sensitive group (e.g., Domain Admins, Global Administrators) without proper change control.',
    causes: [
      'Compromised administrator account making unauthorized changes.',
      'Misconfigured automation or provisioning system.',
    ],
    actions: [
      'Step 1: **Identify Changer and Target.** Determine the user who made the change and the user who was added to the group.',
      'Step 2: **Verify Change Control.** Check the change management system for an approved ticket.',
      'Step 3: **Containment.** If unauthorized, immediately remove the user from the high-privilege group.',
      'Step 4: **Investigate Changer.** If the changer account was compromised, suspend it and follow the Compromised Account playbook.',
      'Step 5: **Audit Activity.** Review all activity of the newly privileged user since the change occurred.',
    ],
    queries: [
      { tool: 'AD/IAM Logs', query: 'EventID=4728 AND TargetGroupName="Domain Admins"' },
    ],
    tools: ['Active Directory/IAM Console', 'Change Management System', 'SIEM'],
    escalation: 'High priority. Escalate immediately if the change was unauthorized.',
  },

  // --- 2. Network & Firewall Alerts (Total: 8) ---
  {
    id: 'dns-tunneling',
    name: 'DNS Tunneling Detected',
    category: 'Network & Firewall',
    description: 'Detection of data being covertly transmitted over the DNS protocol, often characterized by unusually large or frequent DNS queries to a specific external server.',
    causes: [
      'Compromised internal host.',
      'Use of a DNS tunneling tool (e.g., Iodine, Dnscat2).',
      'Attacker bypassing traditional firewall rules.',
    ],
    actions: [
      'Step 1: **Verify Alert.** Confirm the alert by checking the volume and length of DNS queries from the source IP. Look for non-standard characters (high entropy) in the query names.',
      'Step 2: **Identify Source.** Determine the hostname and user associated with the source IP address.',
      'Step 3: **Containment.** Immediately isolate the source host from the network to stop data exfiltration.',
      'Step 4: **Perimeter Block.** Block the external destination DNS server IP and domain at the firewall and DNS filter.',
      'Step 5: **Forensic Analysis.** Analyze the isolated host for the presence of DNS tunneling software or malware that initiated the connection.',
      'Step 6: **Remediation.** If malware is found, follow the Malware Eradication playbook. If a legitimate tool was misused, enforce policy.',
    ],
    queries: [
      { tool: 'DNS Logs', query: 'query_length > 100 AND query_count > 500 | group by src_ip, query_domain' },
    ],
    tools: ['DNS Server Logs', 'SIEM/Log Analytics', 'EDR', 'Firewall/IPS'],
    escalation: 'Escalate if the host is a critical server or if confirmed sensitive data was exfiltrated.',
  },
  {
    id: 'data-exfiltration-attempt',
    name: 'Data Exfiltration Attempt',
    category: 'Network & Firewall',
    description: 'Detection of unusually large outbound data transfers to an external, non-corporate destination, often using encrypted or non-standard protocols.',
    causes: [
      'Insider threat attempting to steal data.',
      'Malware communicating with a C2 server to upload stolen data.',
      'Misconfigured backup or synchronization service (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Destination.** Determine the source host, user, and the external destination IP/domain receiving the data.',
      'Step 2: **Containment.** Immediately isolate the source host from the network.',
      'Step 3: **Verify Legitimacy.** Contact the user/owner out-of-band to verify the transfer. Check change management for approved large transfers.',
      'Step 4: **DLP Review.** Check DLP logs to see if the transferred data was tagged as sensitive (PII, IP).',
      'Step 5: **Perimeter Block.** Block the destination IP/domain at the firewall/proxy.',
      'Step 6: **Forensic Analysis.** If malicious, perform a forensic analysis on the source host to identify the method and scope of data collection.',
    ],
    queries: [
      { tool: 'NetFlow/Firewall', query: 'traffic_outbound > 1GB AND dest_ip NOT IN (corporate_destinations) | top src_ip' },
    ],
    tools: ['NetFlow Analyzer', 'DLP System', 'Firewall Logs', 'EDR'],
    escalation: 'CRITICAL. Escalate immediately if sensitive data exfiltration is confirmed.',
  },
  {
    id: 'port-scan-detected',
    name: 'Port Scan Detected',
    category: 'Network & Firewall',
    description: 'A host is rapidly scanning a range of IP addresses or ports on the network, indicating reconnaissance activity.',
    causes: [
      'Attacker mapping the internal network.',
      'Vulnerability scanner or penetration testing tool (False Positive).',
      'Misconfigured network monitoring tool.',
    ],
    actions: [
      'Step 1: **Identify Scanner and Target.** Determine the source IP performing the scan and the target IP range.',
      'Step 2: **Verify Legitimacy.** Check if the source IP belongs to an approved security tool or team (e.g., vulnerability scanner).',
      'Step 3: **Containment.** If unauthorized, block the source IP at the internal firewall or network access control (NAC) layer.',
      'Step 4: **Check for Follow-up Activity.** Review logs for any immediate connection attempts or exploitation attempts following the scan.',
      'Step 5: **Forensic Analysis.** If the source is an internal host, isolate it and check for malware or unauthorized tools.',
    ],
    queries: [
      { tool: 'IPS/Firewall Logs', query: 'event_type="Port_Scan" | group by src_ip, dest_ip_range' },
    ],
    tools: ['IPS/Firewall Console', 'NAC', 'Asset Inventory'],
    escalation: 'Escalate if the scan is followed by successful exploitation attempts.',
  },
  {
    id: 'connection-to-malicious-ip',
    name: 'Connection to Known Malicious IP',
    category: 'Network & Firewall',
    description: 'An internal host initiated a connection to an external IP address identified as malicious (e.g., C2, malware distribution) by threat intelligence.',
    causes: [
      'Active malware infection on the internal host.',
      'User accidentally browsing a malicious website.',
    ],
    actions: [
      'Step 1: **Validate IOC.** Confirm the external IP is still listed as malicious in threat feeds.',
      'Step 2: **Identify Source Host.** Determine the internal source IP, hostname, and the process that initiated the connection.',
      'Step 3: **Containment.** Immediately isolate the source host from the network.',
      'Step 4: **Perimeter Block.** Block the malicious external IP at the firewall/proxy.',
      'Step 5: **Forensic Analysis.** Perform a deep scan on the isolated host to identify the malware or root cause of the connection.',
      'Step 6: **IOC Search.** Search the entire environment (SIEM, EDR) for the malicious IP and any associated file hashes.',
    ],
    queries: [
      { tool: 'Proxy/Firewall Logs', query: 'dest_ip="[MALICIOUS_IP]" AND action="Allowed"' },
    ],
    tools: ['Threat Intelligence Platform', 'Firewall/Proxy', 'EDR'],
    escalation: 'High priority. Escalate if the connection resulted in a successful data transfer or payload download.',
  },
  {
    id: 'large-outbound-icmp',
    name: 'Large Volume of Outbound ICMP Traffic',
    category: 'Network & Firewall',
    description: 'Detection of unusually high ICMP (ping) traffic volume originating from an internal host, potentially indicating network mapping or data exfiltration (ICMP tunneling).',
    causes: [
      'Attacker performing network reconnaissance.',
      'ICMP tunneling malware attempting to exfiltrate data.',
      'Misconfigured network monitoring tool (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Destination.** Determine the source host and the destination IP(s) receiving the ICMP traffic.',
      'Step 2: **Containment.** Immediately isolate the source host from the network.',
      'Step 3: **Analyze Payload.** If possible, inspect the ICMP packets for non-standard data payloads (indicative of tunneling).',
      'Step 4: **Forensic Analysis.** Analyze the isolated host for ICMP tunneling tools or malware.',
      'Step 5: **Remediation.** Block outbound ICMP traffic to external networks unless explicitly required.',
    ],
    queries: [
      { tool: 'NetFlow/Firewall', query: 'protocol="ICMP" AND traffic_outbound > 10000 | top src_ip' },
    ],
    tools: ['NetFlow Analyzer', 'Firewall/IPS', 'EDR'],
    escalation: 'Escalate if ICMP tunneling is confirmed or if the source is a critical server.',
  },
  {
    id: 'internal-host-scanning',
    name: 'Internal Host Scanning Internal Network',
    category: 'Network & Firewall',
    description: 'An internal host is performing rapid port scanning against other internal hosts, indicating potential compromise and lateral movement reconnaissance.',
    causes: [
      'Compromised host running a network scanner (e.g., Nmap).',
      'Worm or self-propagating malware.',
      'Legitimate vulnerability scanner running outside of schedule (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Scanner and Targets.** Determine the source IP and the range of internal IPs being scanned.',
      'Step 2: **Immediate Isolation.** Isolate the source host from the network.',
      'Step 3: **Verify Legitimacy.** Check the asset inventory to confirm if the host is an approved scanner.',
      'Step 4: **Forensic Analysis.** Analyze the isolated host for unauthorized scanning tools or malware.',
      'Step 5: **Check for Exploitation.** Review logs on the target hosts for any immediate connection attempts or exploitation attempts following the scan.',
    ],
    queries: [
      { tool: 'IPS/Firewall Logs', query: 'event_type="Internal_Port_Scan" | group by src_ip' },
    ],
    tools: ['IPS/Firewall Console', 'EDR', 'Asset Inventory'],
    escalation: 'Escalate if the scanning host is a user endpoint or if exploitation attempts follow the scan.',
  },
  {
    id: 'unauthorized-external-rdp',
    name: 'Unauthorized External RDP/SSH Connection',
    category: 'Network & Firewall',
    description: 'A successful inbound RDP (3389) or SSH (22) connection from an external IP address that is not on the approved access list.',
    causes: [
      'Attacker exploiting a weak password or vulnerability on an exposed service.',
      'Misconfigured firewall rule allowing external access.',
    ],
    actions: [
      'Step 1: **Identify Source and Target.** Determine the external source IP and the internal server/host accessed.',
      'Step 2: **Immediate Block.** Block the source IP at the perimeter firewall.',
      'Step 3: **Terminate Session.** Immediately terminate the RDP/SSH session on the target host.',
      'Step 4: **Audit Activity.** Review the session logs on the target host for commands executed or files accessed.',
      'Step 5: **Remediation.** Disable external RDP/SSH access unless absolutely necessary and enforce strong MFA for all remote access.',
    ],
    queries: [
      { tool: 'Firewall Logs', query: 'dest_port IN (22, 3389) AND src_ip NOT IN (approved_external_ips)' },
    ],
    tools: ['Firewall Console', 'Server Logs', 'Identity Provider'],
    escalation: 'CRITICAL. Escalate immediately, especially if the target is a domain controller or critical server.',
  },
  {
    id: 'high-bandwidth-uncategorized',
    name: 'High Bandwidth Usage to Uncategorized Domain',
    category: 'Network & Firewall',
    description: 'A host is sending or receiving a large volume of data to a domain that is not classified by the web proxy or DNS filter, often used by new C2 infrastructure.',
    causes: [
      'Malware communicating with a newly registered C2 server.',
      'User accessing a legitimate, but new, cloud service (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Domain.** Determine the source host and the uncategorized domain/IP.',
      'Step 2: **Containment.** Temporarily block the domain/IP at the proxy/firewall.',
      'Step 3: **Analyze Domain.** Use external tools (e.g., VirusTotal, WHOIS) to analyze the domain reputation and registration date.',
      'Step 4: **Forensic Analysis.** Analyze the source host to determine the process initiating the connection.',
      'Step 5: **Remediation.** If malicious, follow the Malware Eradication playbook and add the domain to the threat intelligence feed.',
    ],
    queries: [
      { tool: 'Proxy Logs', query: 'category="Uncategorized" AND bytes_sent > 100MB | top src_ip' },
    ],
    tools: ['Web Proxy Logs', 'Threat Intelligence Tools', 'EDR'],
    escalation: 'Escalate if the domain is confirmed malicious or if data exfiltration is suspected.',
  },

  // --- 3. Endpoint & Malware Alerts (Total: 10) ---
  {
    id: 'ransomware-behavior',
    name: 'Ransomware Behavior Detected',
    category: 'Endpoint & Malware',
    description: 'Detection of suspicious file encryption, mass file renaming, or deletion activity characteristic of ransomware.',
    causes: [
      'Successful execution of a ransomware payload.',
      'User opening a malicious document or clicking a link.',
    ],
    actions: [
      'Step 1: **Immediate Isolation.** Immediately isolate the affected host(s) from the network. Do NOT shut down the machine.',
      'Step 2: **Identify Scope.** Determine the initial point of infection and how many files/shares have been accessed or encrypted.',
      'Step 3: **Process Termination.** Use EDR to terminate the malicious encryption process across all affected hosts.',
      'Step 4: **IOC Extraction.** Extract file hashes, process names, and any ransom notes for threat intelligence.',
      'Step 5: **Engage IR.** Notify the Incident Response Team and management immediately due to the high impact.',
      'Step 6: **Backup Verification.** Verify the integrity and availability of recent backups for recovery.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="File_Modification" AND file_extension IN (".lock", ".encrypted") | top hostname' },
    ],
    tools: ['EDR Console', 'Backup Management System', 'Forensic Toolkit'],
    escalation: 'CRITICAL. Engage Crisis Management Team immediately.',
  },
  {
    id: 'fileless-malware',
    name: 'Fileless Malware Activity',
    category: 'Endpoint & Malware',
    description: 'Detection of malicious activity executed entirely in memory or via legitimate system tools (e.g., PowerShell, WMI) without dropping a traditional executable file.',
    causes: [
      'Exploitation of a vulnerability leading to in-memory payload execution.',
      'Use of living-off-the-land binaries (LOLBAS) by an attacker.',
    ],
    actions: [
      'Step 1: **Capture Memory.** Immediately capture a memory dump of the affected host before isolation (if possible) to preserve volatile data.',
      'Step 2: **Isolate Host.** Isolate the affected endpoint from the network.',
      'Step 3: **Analyze Process Tree.** Review the process tree in the EDR to identify the parent process that launched the suspicious script (e.g., PowerShell, wmic).',
      'Step 4: **Identify Persistence.** Check registry keys (Run keys), WMI event subscriptions, and scheduled tasks for persistence mechanisms.',
      'Step 5: **IOC Extraction.** Extract any encoded commands or scripts found in the process arguments for decoding and analysis.',
      'Step 6: **Remediation.** Re-image the host, as fileless malware can be difficult to fully eradicate without a clean OS install.',
    ],
    queries: [
      { tool: 'EDR', query: 'process_name="powershell.exe" AND command_line CONTAINS "EncodedCommand"' },
    ],
    tools: ['EDR Console', 'Memory Forensic Tools', 'SIEM'],
    escalation: 'Escalate immediately, as fileless attacks indicate a sophisticated and active threat actor.',
  },
  {
    id: 'suspicious-process-lolbas',
    name: 'Suspicious Process Execution (LOLBAS)',
    category: 'Endpoint & Malware',
    description: 'Detection of a legitimate system utility (e.g., certutil, bitsadmin, mshta) being executed with suspicious command-line arguments, often used for downloading malware or persistence.',
    causes: [
      'Attacker using Living Off the Land Binaries (LOLBAS) to evade detection.',
      'Malware payload executing via a trusted process.',
    ],
    actions: [
      'Step 1: **Identify Process and Arguments.** Determine the exact utility used (e.g., `certutil.exe`) and the full command line arguments, looking for external URLs or unusual file paths.',
      'Step 2: **Isolate Host.** Immediately isolate the affected endpoint from the network.',
      'Step 3: **Check Parent Process.** Review the process tree to identify the parent process that launched the suspicious utility (e.g., a browser, a document reader).',
      'Step 4: **Analyze Network Connections.** Check network logs for connections made by the utility to external IPs/domains mentioned in the arguments.',
      'Step 5: **IOC Extraction.** Extract any downloaded files or scripts for sandbox analysis.',
      'Step 6: **Remediation.** If malicious, follow the Malware Eradication playbook, focusing on persistence removal and re-imaging.',
    ],
    queries: [
      { tool: 'EDR', query: 'process_name IN ("certutil.exe", "bitsadmin.exe") AND command_line CONTAINS "urlcache"' },
    ],
    tools: ['EDR Console', 'Network Logs', 'Sandbox Analysis'],
    escalation: 'Escalate if the process was used to download and execute a secondary payload.',
  },
  {
    id: 'persistence-mechanism-detected',
    name: 'Persistence Mechanism Detected',
    category: 'Endpoint & Malware',
    description: 'Detection of unauthorized modifications to system startup locations, such as new registry Run keys, WMI event subscriptions, or scheduled tasks.',
    causes: [
      'Malware attempting to survive a reboot.',
      'Attacker establishing long-term access.',
      'Misconfigured legitimate application (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Mechanism.** Determine the exact persistence method (e.g., specific registry key, scheduled task name, WMI filter).',
      'Step 2: **Isolate Host.** Immediately isolate the affected endpoint.',
      'Step 3: **Remove Persistence.** Delete the unauthorized registry key, scheduled task, or WMI subscription.',
      'Step 4: **Identify Payload.** Determine the file or command being executed by the persistence mechanism and analyze it for malicious intent.',
      'Step 5: **Root Cause Analysis.** Investigate how the persistence was created (e.g., which process, user, or vulnerability was exploited).',
      'Step 6: **Remediation.** If malicious, follow the Malware Eradication playbook and re-image the host.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="Registry_Modification" AND key_path CONTAINS "Run" AND process_name NOT IN (approved_list)' },
    ],
    tools: ['EDR Console', 'Registry Editor (Forensic)', 'SIEM'],
    escalation: 'Escalate if the persistence mechanism is tied to a high-privilege account or critical server.',
  },
  {
    id: 'unauthorized-powershell',
    name: 'Unauthorized PowerShell Command',
    category: 'Endpoint & Malware',
    description: 'Execution of a highly suspicious or encoded PowerShell command, often used for reconnaissance, downloading payloads, or lateral movement.',
    causes: [
      'Attacker using PowerShell for post-exploitation.',
      'Malware executing via a script.',
      'Legitimate administrative script running outside of approved parameters (False Positive).',
    ],
    actions: [
      'Step 1: **Capture Command Line.** Capture the full, decoded command line arguments.',
      'Step 2: **Isolate Host.** Immediately isolate the affected endpoint.',
      'Step 3: **Analyze Script.** Decode and analyze the script content for malicious functions (e.g., network connections, credential dumping).',
      'Step 4: **Check Parent Process.** Determine the parent process that launched PowerShell (e.g., a browser, a document).',
      'Step 5: **IOC Extraction.** Extract any external IPs, domains, or file hashes mentioned in the script.',
      'Step 6: **Remediation.** If malicious, follow the Malware Eradication playbook and enforce stricter PowerShell logging policies.',
    ],
    queries: [
      { tool: 'EDR', query: 'process_name="powershell.exe" AND command_line CONTAINS ("-EncodedCommand" OR "IEX")' },
    ],
    tools: ['EDR Console', 'PowerShell Transcription Logs', 'Sandbox Analysis'],
    escalation: 'Escalate if the command was used for credential theft or lateral movement.',
  },
  {
    id: 'suspicious-child-office',
    name: 'Suspicious Child Process of Office Application',
    category: 'Endpoint & Malware',
    description: 'A Microsoft Office application (Word, Excel) spawned an unusual child process like PowerShell, cmd.exe, or a browser, often indicating a macro-based attack.',
    causes: [
      'Malicious macro execution in a document.',
      'Exploitation of an Office vulnerability.',
    ],
    actions: [
      'Step 1: **Identify Host and User.** Determine the host and user who opened the document.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Analyze Document.** Retrieve the original document (if possible) and analyze the macro code or embedded objects.',
      'Step 4: **Process Termination.** Terminate the suspicious child process and the parent Office application.',
      'Step 5: **IOC Search.** Search the environment for the document hash and any downloaded files.',
      'Step 6: **Remediation.** Delete the malicious document and re-image the host.',
    ],
    queries: [
      { tool: 'EDR', query: 'parent_process IN ("winword.exe", "excel.exe") AND child_process IN ("powershell.exe", "cmd.exe")' },
    ],
    tools: ['EDR Console', 'Email Security Gateway', 'Sandbox Analysis'],
    escalation: 'Escalate if the child process successfully downloaded and executed a payload.',
  },
  {
    id: 'wmi-persistence',
    name: 'WMI Persistence Mechanism',
    category: 'Endpoint & Malware',
    description: 'Detection of a new WMI Event Filter or Consumer being created, a common technique for fileless persistence and execution.',
    causes: [
      'Attacker establishing a hidden persistence mechanism.',
      'Advanced fileless malware.',
    ],
    actions: [
      'Step 1: **Identify Host and Mechanism.** Determine the host and the specific WMI filter/consumer created.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Remove Persistence.** Use WMI tools to immediately delete the unauthorized filter and consumer.',
      'Step 4: **Analyze Payload.** Determine the command or script that the WMI mechanism was set to execute.',
      'Step 5: **Root Cause Analysis.** Investigate the process that created the WMI object.',
      'Step 6: **Remediation.** Re-image the host to ensure complete removal of the threat.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="WMI_Modification" AND operation="Create" AND user NOT IN (approved_admins)' },
    ],
    tools: ['EDR Console', 'WMI Management Tools', 'SIEM'],
    escalation: 'High priority. WMI persistence is a strong indicator of a skilled attacker.',
  },
  {
    id: 'antivirus-service-stopped',
    name: 'Antivirus/EDR Service Stopped',
    category: 'Endpoint & Malware',
    description: 'A critical security service (Antivirus, EDR agent) was stopped, disabled, or tampered with on an endpoint.',
    causes: [
      'Attacker attempting to disable security controls before executing malware.',
      'Malware payload specifically targeting security software.',
      'System instability (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Host and User.** Determine the host and the user/process that stopped the service.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Restart Service.** Attempt to remotely restart the security service. If it fails, proceed with caution.',
      'Step 4: **Forensic Analysis.** Analyze the host for tools used to tamper with the service (e.g., `sc.exe`, registry changes).',
      'Step 5: **IOC Search.** Search the environment for any malware executed during the window the service was down.',
      'Step 6: **Remediation.** Re-image the host if tampering is confirmed.',
    ],
    queries: [
      { tool: 'EDR/SIEM', query: 'event_type="Service_Stop" AND service_name IN ("EDR_Agent", "AV_Service")' },
    ],
    tools: ['EDR Console', 'SIEM', 'Service Management Console'],
    escalation: 'CRITICAL. Escalate immediately, as the host is currently unprotected.',
  },
  {
    id: 'new-executable-temp-dir',
    name: 'New Executable in Temp Directory',
    category: 'Endpoint & Malware',
    description: 'A new executable file (.exe, .dll) was created and executed from a temporary or user profile directory (e.g., AppData, Temp).',
    causes: [
      'Malware dropping a payload after initial infection.',
      'Browser download or legitimate installer (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Host and File.** Determine the host, file path, and file hash.',
      'Step 2: **Immediate Isolation.** Isolate the affected host.',
      'Step 3: **Analyze File.** Submit the file hash to a sandbox or threat intelligence platform for analysis.',
      'Step 4: **Check Parent Process.** Determine the parent process that created and executed the file (e.g., a browser, an email client).',
      'Step 5: **Remediation.** Delete the malicious file and re-image the host if confirmed malicious.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="File_Creation" AND file_path CONTAINS ("AppData", "Temp") AND file_extension IN (".exe", ".dll")' },
    ],
    tools: ['EDR Console', 'Sandbox Analysis', 'Threat Intelligence'],
    escalation: 'Escalate if the file is confirmed malicious and executed successfully.',
  },
  {
    id: 'lateral-movement-attempt',
    name: 'Lateral Movement Attempt (PsExec/WMI)',
    category: 'Endpoint & Malware',
    description: 'Detection of tools like PsExec, WMI, or RDP being used to execute commands or establish sessions on a remote internal host from a non-administrative source.',
    causes: [
      'Attacker using stolen credentials to move across the network.',
      'Compromised user account attempting to access unauthorized resources.',
    ],
    actions: [
      'Step 1: **Identify Source and Target.** Determine the source host initiating the connection and the target host.',
      'Step 2: **Immediate Isolation.** Isolate both the source and target hosts.',
      'Step 3: **Analyze Credentials.** Determine which user credentials were used for the lateral movement attempt.',
      'Step 4: **Remediation.** Force a password reset for the compromised user account and perform forensic analysis on both hosts.',
      'Step 5: **Mitigation.** Restrict the use of administrative tools like PsExec to approved administrative jump boxes.',
    ],
    queries: [
      { tool: 'EDR/SIEM', query: 'process_name="psexec.exe" OR process_name="wmic.exe" AND remote_connection="True"' },
    ],
    tools: ['EDR Console', 'SIEM', 'Identity Provider'],
    escalation: 'CRITICAL. Escalate immediately, as this indicates network compromise.',
  },

  // --- 4. Email & Phishing Alerts (Total: 6) ---
  {
    id: 'malicious-attachment',
    name: 'Malicious Attachment Detected',
    category: 'Email & Phishing',
    description: 'An email containing an attachment identified as malware (e.g., executable, macro-enabled document) was delivered to a user inbox.',
    causes: [
      'Email gateway failed to detect the malicious payload.',
      'Zero-day malware variant.',
    ],
    actions: [
      'Step 1: **Identify IOCs.** Extract the file hash and file name of the malicious attachment.',
      'Step 2: **Containment (Email).** Use the Email Security Gateway (ESG) to search for and immediately remove the email from all user inboxes.',
      'Step 3: **Check Execution.** Search EDR/SIEM logs for the file hash to see if the attachment was downloaded or executed by any user.',
      'Step 4: **Containment (Endpoint).** If execution is confirmed, immediately isolate the affected endpoint and follow the Malware playbook.',
      'Step 5: **Block Indicators.** Add the file hash and sender domain to perimeter block lists.',
      'Step 6: **User Notification.** Notify the affected user(s) and provide targeted training.',
    ],
    queries: [
      { tool: 'ESG', query: 'attachment_hash="[MALICIOUS_HASH]" AND delivery_status="Delivered"' },
      { tool: 'EDR', query: 'file_hash="[MALICIOUS_HASH]" AND event_type="Process_Creation"' },
    ],
    tools: ['Email Security Gateway (ESG)', 'EDR', 'SIEM'],
    escalation: 'Escalate if execution is confirmed or if the attachment bypassed multiple security layers.',
  },
  {
    id: 'phishing-email-detected',
    name: 'Phishing Email Detected',
    category: 'Email & Phishing',
    description: 'An email reported by a user or flagged by the system containing suspicious links, requests for credentials, or social engineering tactics.',
    causes: [
      'Targeted spear phishing campaign.',
      'Mass phishing attempt.',
      'User error in reporting (False Positive).',
    ],
    actions: [
      'Step 1: **Analyze Headers.** Review email headers to verify the true sender and origin IP.',
      'Step 2: **Containment (Email).** Immediately remove the email from all user inboxes using the ESG.',
      'Step 3: **Analyze Links/Attachments.** Sandbox any links or attachments to determine malicious intent and extract IOCs.',
      'Step 4: **Check for User Interaction.** Determine if the recipient clicked the link, opened the attachment, or replied with sensitive information.',
      'Step 5: **Remediation.** If credentials were entered, force an immediate password reset and check for signs of account compromise (Impossible Travel, mailbox rules).',
      'Step 6: **Block Indicators.** Block the sender domain, sender IP, and any malicious URLs at the perimeter.',
    ],
    queries: [
      { tool: 'ESG', query: 'subject="[PHISHING_SUBJECT]" OR sender_ip="[PHISHING_IP]"' },
    ],
    tools: ['Email Security Gateway (ESG)', 'Sandbox Analysis', 'Identity Provider'],
    escalation: 'Escalate if the email is part of a targeted campaign or if a high-privilege user interacted with it.',
  },
  {
    id: 'compromised-mailbox-detected',
    name: 'Compromised Mailbox Detected',
    category: 'Email & Phishing',
    description: 'Detection of suspicious activity within a user\'s mailbox, such as mass email sending, creation of forwarding rules, or unusual access patterns.',
    causes: [
      'Stolen credentials used by an attacker.',
      'Session token theft.',
      'Internal user abusing access.',
    ],
    actions: [
      'Step 1: **Immediate Suspension.** Immediately suspend the user account and invalidate all active sessions.',
      'Step 2: **Identify Malicious Rules.** Check the mailbox for unauthorized forwarding rules, delegation changes, or retention policy modifications and remove them.',
      'Step 3: **Audit Sent Items.** Review the Sent Items folder for unauthorized emails, especially those sent internally or containing sensitive data.',
      'Step 4: **Identify Source.** Determine the source IP and client used for the malicious access.',
      'Step 5: **Remediation.** Force a password reset, ensure MFA is enabled, and notify all recipients of the malicious emails.',
    ],
    queries: [
      { tool: 'Mail Audit Logs', query: 'operation="New-InboxRule" AND rule_name NOT IN (approved_rules)' },
    ],
    tools: ['Mail Server Audit Logs', 'Identity Provider', 'SIEM'],
    escalation: 'Escalate if the mailbox belongs to an executive or if the account was used to launch a widespread internal phishing campaign.',
  },
  {
    id: 'ceo-fraud-bec',
    name: 'CEO Fraud / Business Email Compromise (BEC)',
    category: 'Email & Phishing',
    description: 'An email impersonating an executive (CEO, CFO) requesting an urgent wire transfer, gift card purchase, or sensitive data transfer.',
    causes: [
      'Social engineering attack targeting finance or HR personnel.',
      'Compromised external vendor email account.',
    ],
    actions: [
      'Step 1: **Verify Transaction.** Immediately contact the finance/target team via phone or internal chat to halt any requested transaction.',
      'Step 2: **Containment (Email).** Remove the email from all user inboxes using the ESG.',
      'Step 3: **Analyze Headers.** Review headers to confirm the spoofing technique (e.g., display name spoofing, lookalike domain).',
      'Step 4: **User Interview.** Interview the recipient to understand their interaction and if any funds were transferred.',
      'Step 5: **Remediation.** If funds were transferred, immediately contact the bank for recall procedures. Block the sender domain/IP.',
    ],
    queries: [
      { tool: 'ESG', query: 'sender_name IN ("CEO Name", "CFO Name") AND keywords IN ("wire transfer", "urgent payment")' },
    ],
    tools: ['Email Security Gateway (ESG)', 'Finance Team', 'Communication Tools'],
    escalation: 'CRITICAL. Escalate immediately to management and legal if financial loss is involved.',
  },
  {
    id: 'mass-email-deletion',
    name: 'Mass Email Deletion by User',
    category: 'Email & Phishing',
    description: 'A user account is deleting a large volume of emails from their inbox or sent items in a short period, often indicating a compromise or cover-up attempt.',
    causes: [
      'Attacker attempting to hide malicious activity (e.g., C2 communication, phishing emails).',
      'User attempting to destroy evidence (Insider Threat).',
    ],
    actions: [
      'Step 1: **Immediate Suspension.** Immediately suspend the user account and invalidate all active sessions.',
      'Step 2: **Restore Emails.** Use mail server tools to restore the deleted emails from backup or retention archives.',
      'Step 3: **Audit Activity.** Review the restored emails and the user\'s login history for signs of compromise (Impossible Travel, new IPs).',
      'Step 4: **Forensic Analysis.** If insider threat is suspected, preserve the endpoint and mailbox for forensic review.',
      'Step 5: **Remediation.** Force a password reset and ensure MFA is enabled.',
    ],
    queries: [
      { tool: 'Mail Audit Logs', query: 'operation="HardDelete" AND item_count > 50' },
    ],
    tools: ['Mail Server Audit Logs', 'Identity Provider', 'Forensic Toolkit'],
    escalation: 'Escalate if the user is high-privilege or if the deleted emails contain evidence of a larger breach.',
  },
  {
    id: 'suspicious-mailbox-delegation',
    name: 'Suspicious Mailbox Delegation Change',
    category: 'Email & Phishing',
    description: 'A user granted delegate access or full access permissions to their mailbox to another user or external address without authorization.',
    causes: [
      'Compromised account granting access to an attacker.',
      'Insider threat setting up a monitoring mechanism.',
    ],
    actions: [
      'Step 1: **Identify Changer and Delegate.** Determine the user who made the change and the delegate recipient.',
      'Step 2: **Immediate Reversal.** Immediately remove the unauthorized delegation/access rights.',
      'Step 3: **Contact User.** Contact the mailbox owner out-of-band to verify the change.',
      'Step 4: **Audit Delegate Activity.** Review the delegate\'s access logs for any unauthorized reading or sending of emails.',
      'Step 5: **Remediation.** If unauthorized, force a password reset for the mailbox owner and investigate the changer account.',
    ],
    queries: [
      { tool: 'Mail Audit Logs', query: 'operation IN ("Add-MailboxPermission", "Add-RecipientPermission") AND delegate_user NOT IN (approved_list)' },
    ],
    tools: ['Mail Server Audit Logs', 'Identity Provider'],
    escalation: 'Escalate if the mailbox belongs to an executive or legal team member.',
  },

  // --- 5. Cloud Security Alerts (Total: 6) ---
  {
    id: 'unusual-cloud-api-calls',
    name: 'Unusual Cloud API Calls',
    category: 'Cloud Security',
    description: 'A user or service role is making API calls that are highly unusual for their baseline behavior (e.g., creating keys, modifying security groups, accessing resources in a new region).',
    causes: [
      'Compromised cloud credentials/access key.',
      'Insider threat abusing legitimate access.',
      'New automation script deployed without baseline update (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Identity.** Determine the IAM user or role making the suspicious calls and the source IP.',
      'Step 2: **Containment.** If unauthorized, immediately revoke the session token or access key used for the calls.',
      'Step 3: **Verify Legitimacy.** Contact the owner of the identity out-of-band to verify the activity. Check change management records.',
      'Step 4: **Audit Changes.** Review the specific API calls made (e.g., `CreateUser`, `AuthorizeSecurityGroupIngress`) and revert any unauthorized changes.',
      'Step 5: **Remediation.** If compromised, force a password rotation for the user and delete/rotate the compromised access key.',
    ],
    queries: [
      { tool: 'CloudTrail/Activity Log', query: 'eventName IN ("CreateAccessKey", "RunInstances") AND userAgent NOT IN ("Approved_Automation")' },
    ],
    tools: ['Cloud Provider Console (IAM)', 'Cloud Audit Logs', 'SIEM'],
    escalation: 'Escalate if the activity involves creating new administrative users or modifying network security to allow external access.',
  },
  {
    id: 'public-s3-bucket-exposure',
    name: 'Public S3 Bucket Exposure',
    category: 'Cloud Security',
    description: 'Detection of a cloud storage bucket configured for public read or write access, potentially exposing sensitive data.',
    causes: [
      'Misconfiguration during deployment (e.g., "Everyone" access granted).',
      'Automated script error or manual oversight.',
      'Lack of continuous cloud security posture management (CSPM).',
    ],
    actions: [
      'Step 1: **Verify Public Access.** Immediately confirm the public access status of the identified bucket using the cloud provider console.',
      'Step 2: **Containment.** Change the bucket policy immediately to restrict access to internal users only (or specific roles/IPs).',
      'Step 3: **Scope Assessment.** Determine what data was stored in the bucket and if it contained sensitive information (PII, IP).',
      'Step 4: **Audit Logs.** Review cloud access logs for the bucket to identify any unauthorized external access or downloads during the exposure window.',
      'Step 5: **Remediation.** If sensitive data was exposed, follow data breach notification procedures.',
      'Step 6: **Preventative Action.** Update Infrastructure as Code (IaC) templates and enforce CSPM policies to prevent recurrence.',
    ],
    queries: [
      { tool: 'AWS CloudTrail', query: 'eventName=PutBucketAcl AND requestParameters.acl="public-read"' },
      { tool: 'CSPM Tool', query: 'search resource_type="s3_bucket" AND public_access="true"' },
    ],
    tools: ['Cloud Provider Console (IAM/Storage)', 'CSPM Tool', 'Cloud Access Logs'],
    escalation: 'Escalate immediately if PII, financial data, or critical intellectual property was exposed.',
  },
  {
    id: 'new-root-user-login',
    name: 'New Root User Login',
    category: 'Cloud Security',
    description: 'A successful login by the cloud provider\'s root account, which should rarely, if ever, be used.',
    causes: [
      'Unauthorized access to the most privileged account.',
      'Legitimate, but unapproved, maintenance activity.',
    ],
    actions: [
      'Step 1: **Immediate Suspension.** Immediately invalidate the root user session and rotate the root user password and access keys.',
      'Step 2: **Identify Source.** Determine the source IP and user agent of the login.',
      'Step 3: **Verify Legitimacy.** Contact the designated owner of the root account out-of-band to verify the activity.',
      'Step 4: **Audit Activity.** Review all API calls made by the root user during the session for unauthorized changes (e.g., creating new IAM users, modifying billing).',
      'Step 5: **Remediation.** Ensure the root account is protected by strong MFA (preferably hardware) and stored securely. Document the policy violation.',
    ],
    queries: [
      { tool: 'CloudTrail/Activity Log', query: 'userIdentity.type="Root" AND eventName="ConsoleLogin" AND responseElements.ConsoleLogin="Success"' },
    ],
    tools: ['Cloud Provider Console (IAM)', 'Cloud Audit Logs'],
    escalation: 'CRITICAL. Escalate immediately. Root account compromise is the highest risk cloud incident.',
  },
  {
    id: 'iam-policy-modification',
    name: 'IAM Policy Modification (Granting Broad Access)',
    category: 'Cloud Security',
    description: 'A change was made to an IAM policy that grants overly permissive access (e.g., `*` resource or `Allow: *` action) to a user or role.',
    causes: [
      'Compromised account attempting to gain broad access.',
      'Developer error during deployment.',
    ],
    actions: [
      'Step 1: **Identify Policy and Changer.** Determine the policy name, the user/role affected, and the identity that made the change.',
      'Step 2: **Immediate Reversal.** Immediately revert the IAM policy to its previous, secure version.',
      'Step 3: **Audit Activity.** Review the activity of the identity that made the change for signs of compromise.',
      'Step 4: **Check for Exploitation.** Search logs for the affected user/role attempting to use the newly granted broad permissions.',
      'Step 5: **Remediation.** Enforce policy checks (e.g., SCPs, Guardrails) to prevent future broad policy deployments.',
    ],
    queries: [
      { tool: 'Cloud Audit Logs', query: 'eventName="PutRolePolicy" AND requestParameters.policyText CONTAINS "*:*" AND user NOT IN (approved_automation)' },
    ],
    tools: ['Cloud Provider Console (IAM)', 'Cloud Audit Logs', 'CSPM Tool'],
    escalation: 'High priority. Escalate if the change was unauthorized and the affected identity is high-risk.',
  },
  {
    id: 'unusual-resource-deletion',
    name: 'Unusual Resource Deletion Activity',
    category: 'Cloud Security',
    description: 'A user or service account is deleting critical cloud resources (e.g., databases, virtual machines, backups) outside of normal maintenance windows.',
    causes: [
      'Attacker performing destructive actions (e.g., ransomware follow-up).',
      'Insider threat attempting sabotage.',
      'Misconfigured automation script (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Identity and Resource.** Determine the identity performing the deletion and the resources targeted.',
      'Step 2: **Containment.** Immediately revoke the credentials/access key of the identity performing the deletion.',
      'Step 3: **Verify Legitimacy.** Check change management for approved maintenance.',
      'Step 4: **Restore Resources.** Initiate recovery procedures for deleted resources from backups.',
      'Step 5: **Forensic Analysis.** Investigate the identity for compromise or malicious intent.',
    ],
    queries: [
      { tool: 'Cloud Audit Logs', query: 'eventName IN ("DeleteDBInstance", "TerminateInstances") AND time_of_day NOT IN (maintenance_window)' },
    ],
    tools: ['Cloud Audit Logs', 'Cloud Console', 'Backup Management'],
    escalation: 'CRITICAL. Escalate immediately to IR and management.',
  },
  {
    id: 'cloud-metadata-access',
    name: 'Cloud Instance Metadata Service Access',
    category: 'Cloud Security',
    description: 'Detection of a process or application accessing the cloud instance metadata service (IMDS) to retrieve sensitive information like temporary credentials, often indicating SSRF or container escape.',
    causes: [
      'Vulnerable application exploited via Server-Side Request Forgery (SSRF).',
      'Container escape allowing access to the host metadata.',
    ],
    actions: [
      'Step 1: **Identify Instance and Process.** Determine the cloud instance and the process making the IMDS request.',
      'Step 2: **Immediate Isolation.** Isolate the affected cloud instance/container.',
      'Step 3: **Revoke Credentials.** If temporary credentials were retrieved, immediately revoke them.',
      'Step 4: **Analyze Application.** Review the application logs and code for SSRF vulnerabilities.',
      'Step 5: **Mitigation.** Enforce IMDSv2 (token-based access) to prevent unauthorized access.',
    ],
    queries: [
      { tool: 'Network/Host Logs', query: 'dest_ip="169.254.169.254" AND request_method="GET"' },
    ],
    tools: ['Cloud Console', 'Network Logs', 'Application Logs'],
    escalation: 'High priority. Escalate if temporary credentials were successfully retrieved and used.',
  },

  // --- 6. Data & Insider Threat Alerts (Total: 4) ---
  {
    id: 'unauthorized-usb',
    name: 'Unauthorized USB Device Connected',
    category: 'Data & Insider Threat',
    description: 'A non-approved external storage device (USB drive) was connected to an endpoint, posing a risk of data exfiltration or malware introduction.',
    causes: [
      'Insider threat attempting to copy data.',
      'User negligence (using personal USB drive).',
      'Malware delivered via USB (e.g., BadUSB).',
    ],
    actions: [
      'Step 1: **Identify Host and User.** Determine the endpoint hostname and the logged-in user.',
      'Step 2: **Containment.** Use EDR to immediately block all read/write access to the connected USB device.',
      'Step 3: **Contact User.** Contact the user out-of-band to determine the purpose and nature of the device.',
      'Step 4: **Scan Device/Host.** If the device is unapproved, initiate a full malware scan on the host. If possible, scan the contents of the USB drive remotely.',
      'Step 5: **DLP Review.** Check DLP logs for any file copy attempts to the USB device during the connection window.',
      'Step 6: **Policy Enforcement.** If policy violation, document the incident and enforce disciplinary action/retraining.',
    ],
    queries: [
      { tool: 'EDR', query: 'event_type="Device_Connection" AND device_type="USB_Storage" AND device_status="Unapproved"' },
    ],
    tools: ['EDR Console', 'DLP System', 'Asset Inventory'],
    escalation: 'Escalate if the user refuses to cooperate or if sensitive data transfer is confirmed.',
  },
  {
    id: 'privileged-user-data-access',
    name: 'Privileged User Data Access',
    category: 'Data & Insider Threat',
    description: 'A highly privileged user (e.g., system administrator) accessed a sensitive data repository (e.g., HR files, financial records) outside of their normal operational duties.',
    causes: [
      'Insider threat abusing legitimate access.',
      'Compromised privileged account.',
      'Legitimate, but undocumented, troubleshooting (False Positive).',
    ],
    actions: [
      'Step 1: **Identify User and Resource.** Determine the user, the time of access, and the specific sensitive resource accessed.',
      'Step 2: **Verify Legitimacy.** Contact the user\'s manager or the data owner out-of-band to verify if the access was authorized or necessary.',
      'Step 3: **Audit Access.** Review the full audit trail of the user\'s activity during the session, looking for data modification, deletion, or copying.',
      'Step 4: **Containment (If Malicious).** If unauthorized, immediately suspend the user\'s privileged access and investigate the account for compromise.',
      'Step 5: **Policy Enforcement.** If unauthorized but not malicious (e.g., curiosity), document the incident and initiate disciplinary action.',
    ],
    queries: [
      { tool: 'File/Share Audit Logs', query: 'user_group="Privileged_Admins" AND resource_path CONTAINS "Sensitive_Data"' },
    ],
    tools: ['File Audit Logs', 'DLP System', 'Identity Provider'],
    escalation: 'Escalate immediately if the user is confirmed to be acting maliciously or if the account is compromised.',
  },
  {
    id: 'mass-file-download',
    name: 'Mass File Download from Cloud Storage',
    category: 'Data & Insider Threat',
    description: 'A user downloaded an unusually large number of files or a high volume of data from a corporate cloud storage service (e.g., SharePoint, Google Drive).',
    causes: [
      'Insider threat preparing for departure or sabotage.',
      'Compromised account exfiltrating data.',
      'Legitimate synchronization or backup (False Positive).',
    ],
    actions: [
      'Step 1: **Identify User and Volume.** Determine the user account and the total volume/count of files downloaded.',
      'Step 2: **Containment.** Temporarily suspend the user\'s access to the cloud storage service.',
      'Step 3: **Verify Legitimacy.** Contact the user and their manager out-of-band to verify the activity.',
      'Step 4: **DLP Review.** Check DLP logs to see if the downloaded files contained sensitive tags (PII, IP).',
      'Step 5: **Remediation.** If unauthorized, perform a full forensic analysis and initiate disciplinary procedures.',
    ],
    queries: [
      { tool: 'Cloud Storage Logs', query: 'operation="Download" AND file_count > 500 OR total_size > 1GB' },
    ],
    tools: ['Cloud Storage Audit Logs', 'DLP System', 'Communication Tools'],
    escalation: 'Escalate if the user is high-risk or if sensitive data was downloaded.',
  },
  {
    id: 'printing-sensitive-documents',
    name: 'Printing of Sensitive Documents',
    category: 'Data & Insider Threat',
    description: 'A user printed a document classified as highly sensitive (e.g., financial reports, employee PII) outside of approved procedures.',
    causes: [
      'Insider threat attempting to exfiltrate data physically.',
      'User error or lack of training.',
    ],
    actions: [
      'Step 1: **Identify User and Document.** Determine the user, the printer used, and the classification of the document.',
      'Step 2: **Containment.** Temporarily suspend the user\'s printing privileges.',
      'Step 3: **Verify Legitimacy.** Contact the user and their manager to verify the need for the printout.',
      'Step 4: **DLP Review.** Review the DLP logs for the print job details.',
      'Step 5: **Remediation.** If unauthorized, document the incident and enforce policy/retraining. If malicious, engage physical security.',
    ],
    queries: [
      { tool: 'DLP/Print Logs', query: 'action="Print" AND data_classification="Highly Sensitive"' },
    ],
    tools: ['DLP System', 'Print Server Logs', 'Physical Security Team'],
    escalation: 'Escalate if the document is highly confidential or if the user is uncooperative.',
  },

  // --- 7. Threat Intelligence & External Alerts (Total: 2) ---
  {
    id: 'c2-communication',
    name: 'Communication with C2 Server',
    category: 'Threat Intelligence & External',
    description: 'An internal host is communicating with an external IP or domain identified as a known Command and Control (C2) server by threat intelligence feeds.',
    causes: [
      'Active malware infection on the internal host.',
      'Compromised system receiving instructions from an attacker.',
    ],
    actions: [
      'Step 1: **Validate IOC.** Confirm the external IP/domain is still listed as a high-confidence C2 server in multiple threat feeds.',
      'Step 2: **Identify Source.** Determine the internal source host (IP and hostname) and the specific process initiating the connection.',
      'Step 3: **Containment.** Immediately isolate the source host from the network.',
      'Step 4: **Perimeter Block.** Block the C2 IP/domain at the firewall/proxy.',
      'Step 5: **Forensic Analysis.** Perform a deep forensic analysis on the isolated host to identify the malware, persistence, and data collected.',
      'Step 6: **IOC Search.** Search the entire environment (SIEM, EDR) for the C2 IP, domain, and any associated file hashes.',
    ],
    queries: [
      { tool: 'SIEM', query: 'index=network dest_ip="[C2_IP]" AND action="Allowed"' },
    ],
    tools: ['Threat Intelligence Platform', 'SIEM', 'EDR', 'Firewall'],
    escalation: 'High priority. Escalate immediately, as this confirms an active, post-exploitation phase.',
  },
  {
    id: 'domain-squatting-alert',
    name: 'Domain Squatting/Typosquatting Alert',
    category: 'Threat Intelligence & External',
    description: 'A newly registered domain closely resembling a corporate domain (typosquatting) was detected, often used for phishing or brand abuse.',
    causes: [
      'Threat actor preparing a phishing campaign against employees or customers.',
      'Brand protection monitoring system alert.',
    ],
    actions: [
      'Step 1: **Verify Domain.** Confirm the domain registration details and its similarity to the corporate brand.',
      'Step 2: **Analyze Content.** Check if the domain is hosting malicious content (e.g., fake login page, malware).',
      'Step 3: **Block Indicators.** Block the domain at the perimeter proxy/DNS filter to prevent internal access.',
      'Step 4: **Legal Notification.** Notify the legal and brand protection teams for potential takedown procedures.',
      'Step 5: **Proactive Search.** Search email logs for any inbound emails originating from the suspicious domain.',
    ],
    queries: [
      { tool: 'Threat Intelligence Platform', query: 'domain_name CONTAINS "corpname" AND registration_date="[RECENT]"' },
    ],
    tools: ['Threat Intelligence Platform', 'Legal Team', 'Email Security Gateway'],
    escalation: 'Escalate if the domain is actively being used for phishing or malware distribution.',
  },

  // --- 8. SIEM & System Alerts (Total: 2) ---
  {
    id: 'detection-rule-modified',
    name: 'Detection Rule Modified or Disabled',
    category: 'SIEM & System Alerts',
    description: 'A critical security detection rule (e.g., in SIEM, EDR, or Firewall) was modified, deleted, or disabled, potentially blinding the security team.',
    causes: [
      'Malicious actor attempting to cover their tracks (Attack on Logging).',
      'Unauthorized administrative action.',
      'Legitimate maintenance or tuning without proper change control (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Change.** Determine the specific rule modified, the user/account that made the change, and the time.',
      'Step 2: **Revert Change.** Immediately revert the rule to its previous, secure state.',
      'Step 3: **Verify Change Control.** Check the change management system for an approved ticket.',
      'Step 4: **Audit Activity.** If unauthorized, review the activity of the user/account that made the change immediately before and after the modification for signs of compromise.',
      'Step 5: **Backfill Logs.** If the rule was disabled for a period, ensure logs for that period are reviewed manually for missed threats.',
    ],
    queries: [
      { tool: 'SIEM Audit Logs', query: 'operation="Rule_Modification" OR operation="Rule_Deletion" AND rule_name="[CRITICAL_RULE]"' },
    ],
    tools: ['SIEM Audit Logs', 'Change Management System', 'Identity Provider'],
    escalation: 'Escalate if the change was unauthorized and performed by a compromised account.',
  },
  {
    id: 'log-source-failure',
    name: 'Log Source Failure/Data Loss Detected',
    category: 'SIEM & System Alerts',
    description: 'A critical log source (e.g., Domain Controller, Firewall, EDR) stopped sending data to the SIEM, creating a blind spot.',
    causes: [
      'Attacker disabling logging to evade detection.',
      'Network connectivity issue or log forwarder failure.',
      'System maintenance (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Time.** Determine the specific log source and the time logging ceased.',
      'Step 2: **Verify Legitimacy.** Check change management for approved maintenance on the source.',
      'Step 3: **Restore Logging.** Attempt to remotely restart the log forwarder service or fix the network connection.',
      'Step 4: **Audit Source.** If logging was intentionally disabled, investigate the source system for signs of compromise during the blind period.',
      'Step 5: **Backfill Logs.** If possible, retrieve and ingest the missed logs manually.',
    ],
    queries: [
      { tool: 'SIEM Health Monitor', query: 'log_source="[CRITICAL_SOURCE]" AND status="Down"' },
    ],
    tools: ['SIEM Health Monitor', 'System Administration Tools', 'Change Management System'],
    escalation: 'CRITICAL. Escalate immediately if the source is a Domain Controller or core security device.',
  },

  // --- 9. Incident Response / Automation Triggers (Total: 2) ---
  {
    id: 'automated-containment-triggered',
    name: 'Automated Containment Triggered',
    category: 'Incident Response / Automation Triggers',
    description: 'A Security Orchestration, Automation, and Response (SOAR) playbook successfully executed an automated containment action (e.g., host isolation, account suspension).',
    causes: [
      'High-confidence alert triggered the SOAR playbook.',
      'Misconfigured SOAR rule leading to unnecessary containment (False Positive).',
    ],
    actions: [
      'Step 1: **Verify Trigger.** Review the original alert that triggered the automation (e.g., Ransomware Behavior, C2 Communication).',
      'Step 2: **Confirm Containment.** Verify that the automated action (e.g., host isolation) was successful and complete.',
      'Step 3: **Manual Triage.** Perform manual triage on the contained asset to confirm the threat and prevent false positives from escalating.',
      'Step 4: **Proceed with Playbook.** If confirmed malicious, continue with the manual steps of the original alert\'s playbook (e.g., forensic analysis, eradication).',
      'Step 5: **Document and Tune.** Document the success/failure of the automation and tune the SOAR rule if necessary.',
    ],
    queries: [
      { tool: 'SOAR Logs', query: 'playbook_name="Containment_Host_Isolation" AND status="Success"' },
    ],
    tools: ['SOAR Platform', 'SIEM', 'EDR Console'],
    escalation: 'Escalate if the automated containment failed or if the contained asset is a critical production system.',
  },
  {
    id: 'quarantine-bypass-attempt',
    name: 'Quarantine Bypass Attempt',
    category: 'Incident Response / Automation Triggers',
    description: 'A host or user attempted to bypass or disable an automated containment measure (e.g., re-enabling network access after isolation, restoring a quarantined file).',
    causes: [
      'Attacker actively fighting containment measures.',
      'User attempting to restore a legitimate file (False Positive).',
    ],
    actions: [
      'Step 1: **Identify Source and Action.** Determine the host/user and the specific containment measure being bypassed.',
      'Step 2: **Re-enforce Containment.** Immediately re-apply the containment measure (e.g., re-isolate the host, re-suspend the account).',
      'Step 3: **Manual Intervention.** Switch to manual containment methods that are harder to bypass (e.g., physical network disconnect).',
      'Step 4: **Forensic Analysis.** Investigate the host for tools or scripts used to bypass the security controls.',
      'Step 5: **Remediation.** If malicious, re-image the host and investigate the user account for compromise.',
    ],
    queries: [
      { tool: 'EDR/SOAR Logs', query: 'event_type="Containment_Failure" OR event_type="Network_Rejoin_Attempt"' },
    ],
    tools: ['EDR Console', 'SOAR Platform', 'Network Administration Tools'],
    escalation: 'CRITICAL. Escalate immediately, as the attacker is actively engaged and resisting defense.',
  },
];

export const categories: AlertCategory[] = [
  'Authentication & Access', 
  'Network & Firewall', 
  'Endpoint & Malware', 
  'Email & Phishing', 
  'Cloud Security', 
  'Data & Insider Threat', 
  'Threat Intelligence & External', 
  'SIEM & System Alerts', 
  'Incident Response / Automation Triggers'
];